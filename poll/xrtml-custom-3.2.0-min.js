try{delete window.xRTML}catch(e){window.xRTML=undefined}(function(b,a){(function(c,g){var f=function(k,h){if(!h){h=function(){}}if(k.length===0){return h()}var i=0;var j=[];var l=function(){k[i](function(m){j[i]=m;if(++i==k.length){if(h){h.apply(j,j)}}else{l()}})};l()};var d=function(k,h){if(!h){h=function(){}}if(k.length===0){return h()}var m=0;var i=0;var j=[];var l=function(){k[m]((function(n){return function(o){j[n]=o;if(++i==k.length){if(h){h.apply(j,j)}return}}})(m));if(++m!=k.length){l()}};l()};c.series=f;c.parallel=d})(b.Async=b.Async||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,g){var d={bind:function(h,i){if(h.bind){h.bind(i)}else{for(var j in i){if(h.addEventListener){h.addEventListener(j,i[j],false)}else{h.attachEvent?h.attachEvent("on"+j,i[j]):h[j]=i[j]}}}},unbind:function(h,i){if(h.unbind){h.unbind(i)}else{for(var j in i){if(h.removeEventListener){h.removeEventListener(j,i[j],false)}else{if(h.detachEvent){h.detachEvent("on"+j,i[j])}else{if(h[j]){delete h[j]}}}}}}},f={bind:function(h){for(var i in h){if(typeof h[i]==="function"){if(!this.listeners[i]){this.listeners[i]=[]}this.listeners[i].push(h[i])}}},unbind:function(h){for(var m in h){if(this.listeners[m] instanceof Array){var l=this.listeners[m];for(var j=0,k=l.length;j<k;j++){if(l[j]===h[m]){l.splice(j,1);break}}}}},fire:function(j){var h;for(var o in j){h={type:o,target:this};for(var l in j[o]){var n=j[o][l];h[l]=n}if(this.listeners[h.type] instanceof Array){var m=new Array();for(var k=0;k<this.listeners[h.type].length;k++){m.push((function(i,p){return function(q){p.call(i,h);q()}})(this,this.listeners[h.type][k]))}b.Async.parallel(m)}}}};c.bind=d.bind;c.unbind=d.unbind;c.extend=function(i){if(!i.listeners){i.listeners={}}for(var h in f){i[h]=f[h]}}})(b.Event=b.Event||{})})(window.xRTML=window.xRTML||{});(function(a){(function(c,b){c.Event.extend(c);c.version="3.2.0";c.lastestBuild="22-03-2013 14:08:59";c.domLoaded=function(){return(document.readyState=="loaded"||document.readyState=="complete")};c.isReady=false;c.isLoaded=false;c.ready=function(d){!c.isReady?c.bind({ready:d}):d()};c.load=function(d){!c.isLoaded?c.bind({load:d}):d()}})(a.xRTML=a.xRTML||{})})(window);(function(b,a){(function(au,ar){var aq,p,A,ao,al,C=b.document,B=C.documentElement,F=("sizcache"+Math.random()).replace(".",""),D=0,an=[].slice,V=[].push,ap="undefined",K=false,n=true,r="(?:[-\\w]|[^\\x00-\\xa0]|\\\\.)",at="[\\x20\\t\\n\\r\\f]",S="([*^$|!~]?={1})",L="(?:-?[#_a-zA-Z]{1}[-\\w]*|[^\\x00-\\xa0]+|\\\\.+)",m="\\["+at+"*("+r+"+)"+at+"*(?:"+S+at+"*(?:(['\"])(.*?)\\3|("+L+"+)|)|)"+at+"*\\]",U=":("+r+"+)(?:\\(([\"']?)([^()]*|.*)\\2\\))?",T=":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)",u=at+"*([\\x20\\t\\n\\r\\f>+~])"+at+"*",Z=new RegExp("^"+at+"*,"+at+"*"),Y=new RegExp("^"+u),aj=new RegExp("("+m.replace("3","4")+"|"+U.replace("2","8")+"|\\\\[>+~]|[^\\x20\\t\\n\\r\\f>+~]|\\\\.)+|"+u,"g"),ai=new RegExp("^"+at),ag=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,ah=/^[\x20\t\n\r\f]*[+~][\x20\t\n\r\f]*$/,aa=/:not\($/,af=/(-?)(\d*)(?:n([+\-]?\d*))?/,ae=/\D/,ac=/h\d/i,ad=/input|select|textarea|button/i,W=/^\+|[\x20\t\n\r\f]*/g,X=/\\(?!\\)/g,ab=/([^,\\\[\]]+|\[[^\[]*\]|\([^\(]*\)|\\.)+/g,Q={ID:new RegExp("^#("+r+"+)"),CLASS:new RegExp("^\\.("+r+"+)"),NAME:new RegExp("^\\[name=['\"]?("+r+"+)['\"]?\\]"),TAG:new RegExp("^("+r.replace("[-","[-\\*")+"+)"),ATTR:new RegExp("^"+m),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+at+"*(even|odd|(?:[+\\-]?\\d+|(?:[+\\-]?\\d*)?n"+at+"*(?:[+\\-]"+at+"*\\d+)?))"+at+"*\\))?","i"),POS:new RegExp(T,"ig"),globalPOS:new RegExp(T,"i")},t={},o=[],w={},q=[],N=function(av){av.sizzleFilter=true;return av},z=function(av){return function(aw){return aw.nodeName.toLowerCase()==="input"&&aw.type===av}},y=function(av){return function(aw){var ax=aw.nodeName.toLowerCase();return(ax==="input"||ax==="button")&&aw.type===av}},f=function(ax){var ay=false,av=C.createElement("div");try{ay=ax(av)}catch(aw){}av=null;return ay},g=f(function(av){av.innerHTML="<select></select>";var aw=typeof av.lastChild.getAttribute("multiple");return aw!=="boolean"&&aw!=="string"}),h,l=f(function(av){av.id=F+0;av.innerHTML="<a name='"+F+"'/><div name='"+F+"'/>";B.insertBefore(av,B.firstChild);var aw=C.getElementsByName&&C.getElementsByName(F).length===2+C.getElementsByName(F+0).length;h=!C.getElementById(F);B.removeChild(av);return aw}),j=f(function(av){av.appendChild(C.createComment(""));return av.getElementsByTagName("*").length===0}),i=f(function(av){av.innerHTML="<a href='#'></a>";return av.firstChild&&typeof av.firstChild.getAttribute!==ap&&av.firstChild.getAttribute("href")==="#"}),k=f(function(av){av.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!av.getElementsByClassName||av.getElementsByClassName("e").length===0){return false}av.lastChild.className="e";return av.getElementsByClassName("e").length!==1});var am=function(aC,av,aA,aB){aA=aA||[];av=av||C;var ay,aw,aD,ax,az=av.nodeType;if(az!==1&&az!==9){return[]}if(!aC||typeof aC!=="string"){return aA}aD=M(av);if(!aD&&!aB){if((ay=ag.exec(aC))){if((ax=ay[1])){if(az===9){aw=av.getElementById(ax);if(aw&&aw.parentNode){if(aw.id===ax){aA.push(aw);return aA}}else{return aA}}else{if(av.ownerDocument&&(aw=av.ownerDocument.getElementById(ax))&&x(av,aw)&&aw.id===ax){aA.push(aw);return aA}}}else{if(ay[2]){V.apply(aA,an.call(av.getElementsByTagName(aC),0));return aA}else{if((ax=ay[3])&&k&&av.getElementsByClassName){V.apply(aA,an.call(av.getElementsByClassName(ax),0));return aA}}}}}return ak(aC,av,aA,aB,aD)};var G=am.selectors={cacheLength:50,match:Q,order:["ID","TAG"],attrHandle:{},createPseudo:N,find:{ID:h?function(aw,av,ay){if(typeof av.getElementById!==ap&&!ay){var ax=av.getElementById(aw);return ax&&ax.parentNode?[ax]:[]}}:function(aw,av,ay){if(typeof av.getElementById!==ap&&!ay){var ax=av.getElementById(aw);return ax?ax.id===aw||typeof ax.getAttributeNode!==ap&&ax.getAttributeNode("id").value===aw?[ax]:ar:[]}},TAG:j?function(aw,av){if(typeof av.getElementsByTagName!==ap){return av.getElementsByTagName(aw)}}:function(az,av){var ay=av.getElementsByTagName(az);if(az==="*"){var aw,aA=[],ax=0;for(;(aw=ay[ax]);ax++){if(aw.nodeType===1){aA.push(aw)}}ay=aA}return ay}},relative:{">":{dir:"parentNode",firstMatch:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",firstMatch:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(av){av[1]=av[1].replace(X,"");av[3]=(av[4]||av[5]||"").replace(X,"");if(av[2]==="~="){av[3]=" "+av[3]+" "}return av.slice(0,4)},CHILD:function(av){av[1]=av[1].toLowerCase();if(av[1]==="nth"){if(!av[2]){am.error(av[0])}av[2]=av[2].replace(W,"");var aw=af.exec(av[2]==="even"&&"2n"||av[2]==="odd"&&"2n+1"||!ae.test(av[2])&&"0n+"+av[2]||av[2]);av[2]=+(aw[1]+(aw[2]||1));av[3]=+aw[3]}else{if(av[2]){am.error(av[0])}}return av},PSEUDO:function(av){return Q.CHILD.test(av[0])?null:av}},filter:{ID:h?function(av){av=av.replace(X,"");return function(aw){return aw.getAttribute("id")===av}}:function(av){av=av.replace(X,"");return function(aw){var ax=typeof aw.getAttributeNode!==ap&&aw.getAttributeNode("id");return ax&&ax.value===av}},TAG:function(av){if(av==="*"){return function(){return true}}av=av.replace(X,"").toLowerCase();return function(aw){return aw.nodeName&&aw.nodeName.toLowerCase()===av}},CLASS:function(av){var aw=t[av];if(!aw){aw=t[av]=new RegExp("(^|"+at+")"+av+"("+at+"|$)");o.push(av);if(o.length>G.cacheLength){delete t[o.shift()]}}return function(ax){return aw.test(ax.className||ax.getAttribute("class")||"")}},ATTR:function(aw,ax,av){if(!ax){return function(ay){return am.attr(ay,aw)!=null}}return function(ay){var az=am.attr(ay,aw),aA=az+"";if(az==null){return ax==="!="}switch(ax){case"=":return aA===av;case"!=":return aA!==av;case"^=":return av&&aA.indexOf(av)===0;case"*=":return av&&aA.indexOf(av)>-1;case"$=":return av&&aA.substr(aA.length-av.length)===av;case"~=":return(" "+aA+" ").indexOf(av)>-1;case"|=":return aA===av||aA.substr(0,av.length+1)===av+"-"}}},CHILD:function(ay,aw,ax){if(ay==="nth"){var av=D++;return function(aB){var aD,aA,az=0,aC=aB;if(aw===1&&ax===0){return true}aD=aB.parentNode;if(aD&&(aD[F]!==av||!aB.sizset)){for(aC=aD.firstChild;aC;aC=aC.nextSibling){if(aC.nodeType===1){aC.sizset=++az;if(aC===aB){break}}}aD[F]=av}aA=aB.sizset-ax;if(aw===0){return aA===0}else{return(aA%aw===0&&aA/aw>=0)}}}return function(az){var aA=az;switch(ay){case"only":case"first":while((aA=aA.previousSibling)){if(aA.nodeType===1){return false}}if(ay==="first"){return true}aA=az;case"last":while((aA=aA.nextSibling)){if(aA.nodeType===1){return false}}return true}}},PSEUDO:function(az,ay,av,aw,aA){var ax=G.pseudos[az]||G.pseudos[az.toLowerCase()];if(!ax){am.error("unsupported pseudo: "+az)}if(!ax.sizzleFilter){return ax}return ax(av,aw,aA)}},pseudos:{not:N(function(ax,av,ay){var aw=v(ax,av,ay);return function(az){return !aw(az)}}),enabled:function(av){return av.disabled===false},disabled:function(av){return av.disabled===true},checked:function(av){var aw=av.nodeName.toLowerCase();return(aw==="input"&&!!av.checked)||(aw==="option"&&!!av.selected)},selected:function(av){if(av.parentNode){av.parentNode.selectedIndex}return av.selected===true},parent:function(av){return !!av.firstChild},empty:function(av){return !av.firstChild},contains:N(function(av){return function(aw){return(aw.textContent||aw.innerText||H(aw)).indexOf(av)>-1}}),has:N(function(av){return function(aw){return !!am(av,aw).length}}),header:function(av){return ac.test(av.nodeName)},text:function(aw){var av=aw.getAttribute("type"),ax=aw.type;return aw.nodeName.toLowerCase()==="input"&&"text"===ax&&(av===null||av.toLowerCase()===ax)},radio:z("radio"),checkbox:z("checkbox"),file:z("file"),password:z("password"),image:z("image"),submit:y("submit"),reset:y("reset"),button:function(av){var aw=av.nodeName.toLowerCase();return aw==="input"&&"button"===av.type||aw==="button"},input:function(av){return ad.test(av.nodeName)},focus:function(aw){var av=aw.ownerDocument;return aw===av.activeElement&&(!av.hasFocus||av.hasFocus())&&!!(aw.type||aw.href)},active:function(av){return av===av.ownerDocument.activeElement}},setFilters:{first:function(aw,av,ax){return ax?aw.slice(1):[aw[0]]},last:function(ax,av,ay){var aw=ax.pop();return ay?ax:[aw]},even:function(aw,av,az){var aA=[],ax=az?1:0,ay=aw.length;for(;ax<ay;ax=ax+2){aA.push(aw[ax])}return aA},odd:function(aw,av,az){var aA=[],ax=az?0:1,ay=aw.length;for(;ax<ay;ax=ax+2){aA.push(aw[ax])}return aA},lt:function(aw,av,ax){return ax?aw.slice(+av):aw.slice(0,+av)},gt:function(aw,av,ax){return ax?aw.slice(0,+av+1):aw.slice(+av+1)},eq:function(ax,av,ay){var aw=ax.splice(+av,1);return ay?ax:aw}}};G.setFilters.nth=G.setFilters.eq;G.filters=G.pseudos;if(!i){G.attrHandle={href:function(av){return av.getAttribute("href",2)},type:function(av){return av.getAttribute("type")}}}if(l){G.order.push("NAME");G.find.NAME=function(aw,av){if(typeof av.getElementsByName!==ap){return av.getElementsByName(aw)}}}if(k){G.order.splice(1,0,"CLASS");G.find.CLASS=function(av,aw,ax){if(typeof aw.getElementsByClassName!==ap&&!ax){return aw.getElementsByClassName(av)}}}try{an.call(B.childNodes,0)[0].nodeType}catch(E){an=function(aw){var av,ax=[];for(;(av=this[aw]);aw++){ax.push(av)}return ax}}var M=am.isXML=function(aw){var av=aw&&(aw.ownerDocument||aw).documentElement;return av?av.nodeName!=="HTML":false};var x=am.contains=B.compareDocumentPosition?function(av,aw){return !!(av.compareDocumentPosition(aw)&16)}:B.contains?function(av,ax){var aw=av.nodeType===9?av.documentElement:av,ay=ax.parentNode;return av===ay||!!(ay&&ay.nodeType===1&&aw.contains&&aw.contains(ay))}:function(av,aw){while((aw=aw.parentNode)){if(aw===av){return true}}return false};var H=am.getText=function(av){var ax,az="",aw=0,ay=av.nodeType;if(ay){if(ay===1||ay===9||ay===11){if(typeof av.textContent==="string"){return av.textContent}else{for(av=av.firstChild;av;av=av.nextSibling){az+=H(av)}}}else{if(ay===3||ay===4){return av.nodeValue}}}else{for(;(ax=av[aw]);aw++){az+=H(ax)}}return az};am.attr=function(aw,ax){var ay=M(aw);if(!ay){ax=ax.toLowerCase()}if(G.attrHandle[ax]){return G.attrHandle[ax](aw)}if(g||ay){return aw.getAttribute(ax)}var av=(aw.attributes||{})[ax];return av?typeof aw[ax]==="boolean"?aw[ax]?ax:null:av.specified?av.value:null:null};am.error=function(av){throw new Error("Syntax error, unrecognized expression: "+av)};[0,0].sort(function(){return(n=0)});if(B.compareDocumentPosition){ao=function(av,aw){if(av===aw){K=true;return 0}return(!av.compareDocumentPosition||!aw.compareDocumentPosition?av.compareDocumentPosition:av.compareDocumentPosition(aw)&4)?-1:1}}else{ao=function(av,az){if(av===az){K=true;return 0}else{if(av.sourceIndex&&az.sourceIndex){return av.sourceIndex-az.sourceIndex}}var aw,aA,ax=[],aB=[],ay=av.parentNode,aC=az.parentNode,aD=ay;if(ay===aC){return al(av,az)}else{if(!ay){return -1}else{if(!aC){return 1}}}while(aD){ax.unshift(aD);aD=aD.parentNode}aD=aC;while(aD){aB.unshift(aD);aD=aD.parentNode}aw=ax.length;aA=aB.length;for(var aE=0;aE<aw&&aE<aA;aE++){if(ax[aE]!==aB[aE]){return al(ax[aE],aB[aE])}}return aE===aw?al(av,aB[aE],-1):al(ax[aE],az,1)};al=function(av,aw,ay){if(av===aw){return ay}var ax=av.nextSibling;while(ax){if(ax===aw){return -1}ax=ax.nextSibling}return 1}}am.uniqueSort=function(ax){var av,aw=1;if(ao){K=n;ax.sort(ao);if(K){for(;(av=ax[aw]);aw++){if(av===ax[aw-1]){ax.splice(aw--,1)}}}}return ax};function R(aA,av,ay,az){for(var aw=0,ax=av.length;aw<ax;aw++){am(aA,av[aw],ay,az)}}function J(aC,az,av,aw,aB,ay){var aA=[],ax=G.setFilters[az.toLowerCase()];if(!ax){am.error(az)}if(aC){R(aC,aw,aA,aB)}else{aA=aB}return aA.length?ax(aA,av,ay):[]}function I(aL,aw,aG,aK){var aD,aE,av,aH,ay,ax,aF,aB,az=aL.match(ab),aA=0,aC=az.length,aI=Q.POS,aJ=new RegExp("^"+Q.POS.source+"(?!"+at+")","i"),aM=function(){for(var aN=1,aO=arguments.length-2;aN<aO;aN++){if(arguments[aN]===ar){aD[aN]=ar}}};for(;aA<aC;aA++){aI.exec("");aL=az[aA].replace(ai,"");aH=[];av=0;ay=aK||null;while((aD=aI.exec(aL))){aB=aD.index+aD[0].length;if(aB>av){aF=aL.slice(av,aD.index);if(aD.length>1){aD[0].replace(aJ,aM)}av=aB;ax=[aw];if((aE=aa.test(aF))){aF=aF.replace(aa,"").replace(Y,"$&*")}if(Y.test(aF)){ax=ay||[aw];ay=aK}ay=J(aF,aD[1],aD[2],ax,ay,aE)}if(aI.lastIndex===aD.index){aI.lastIndex++}}if(ay){aH=aH.concat(ay);if((aF=aL.slice(av))&&aF!==")"){R(aF,aH,aG,aK)}else{V.apply(aG,aH)}}else{am(aL,aw,aG,aK)}}return aC===1?aG:am.uniqueSort(aG)}(function(){var ax,aw,ay,av=function(az,aA,aB){if((aw=az.exec(ax))&&(!aA||!G.preFilter[aA]||(aw=G.preFilter[aA](aw,aB)))){ax=ax.slice(aw[0].length)}return aw};aq=function(aD,aA,aF){ax=aD;ay=[];var aE,aC,az=!aF&&aA!==C,aB=[ay];if(az){ax=" "+ax}while(ax){aC=false;if(av(Z)){aB.push(ay=[]);if(az){ax=" "+ax}}if(av(Y)){ay.push({part:aw.pop(),captures:aw});aC=true}for(aE in G.filter){if(av(Q[aE],aE,aF)){aw.shift();ay.push({part:aE,captures:aw});aC=true}}if(!aC){am.error(aD)}}return aB}})();function c(aA,av,aw){var ax=av.dir,az=av.firstMatch,ay=D++;if(!aA){aA=function(aB){return aB===aw}}return az?function(aC,aB){while((aC=aC[ax])){if(aC.nodeType===1){return aA(aC,aB)?aC:false}}}:function(aF,aD){var aB,aE=ay+"."+A,aC=aE+"."+p;while((aF=aF[ax])){if(aF.nodeType===1){if((aB=aF[F])===aC){return false}else{if(typeof aB==="string"&&aB.indexOf(aE)===0){if(aF.sizset){return aF}}else{aF[F]=aC;if(aA(aF,aD)){aF.sizset=true;return aF}aF.sizset=false}}}}}}function d(aw,av){return aw?function(ay,ax){var az=av(ay,ax);return az&&aw(az===true?ay:az,ax)}:av}function P(az,av,aA){var ay,ax,aw=0;for(;(ay=az[aw]);aw++){if(G.relative[ay.part]){ax=c(ax,G.relative[ay.part],av)}else{ay.captures.push(av,aA);ax=d(ax,G.filter[ay.part].apply(null,ay.captures))}}return ax}function O(av){return function(ax,aw){var az,ay=0;for(;(az=av[ay]);ay++){if(az(ax,aw)){return true}}return false}}var v=am.compile=function(az,aw,aB){var aA,ax,ay,av=w[az];if(av&&av.context===aw){av.dirruns++;return av}ax=aq(az,aw,aB);for(ay=0;(aA=ax[ay]);ay++){ax[ay]=P(aA,aw,aB)}av=w[az]=O(ax);av.context=aw;av.runs=av.dirruns=0;q.push(az);if(q.length>G.cacheLength){delete w[q.shift()]}return av};am.matches=function(aw,av){return am(aw,null,null,av)};am.matchesSelector=function(av,aw){return am(aw,null,null,[av]).length>0};var ak=function(aJ,av,aH,aI,aN){var ay,aE,aA,aC,ax,aK,aG,aM,aD,az,aF,aB=(aD=aJ.match(ab))&&aD.length===1,aL=aJ.match(aj),aw=av.nodeType;if(Q.POS.test(aJ)){return I(aJ,av,aH,aI)}if(!aI&&aB&&aL.length>1&&aw===9&&!aN&&(aD=Q.ID.exec(aL[0]))){av=G.find.ID(aD[1],av,aN)[0];aJ=aJ.slice(aL.shift().length)}if(av){if(aI){ay=an.call(aI,0)}else{if(aB){az=(aL.length>=1&&ah.test(aL[0])&&av.parentNode)||av;aF=aL.pop().split(":not");aK=aF[0];for(aA=0,aC=G.order.length;aA<aC;aA++){aM=G.order[aA];if((aD=Q[aM].exec(aK))){ay=G.find[aM]((aD[1]||"").replace(X,""),az,aN);if(ay!=null){break}}}if(ay&&!aF[1]){aG=aJ.length-aK.length;aJ=aJ.slice(0,aG)+aJ.slice(aG).replace(Q[aM],"");if(!aJ){V.apply(aH,an.call(ay,0));return aH}}}if(!ay){ay=G.find.TAG("*",av)}}if(aJ&&(aE=v(aJ,av,aN))){A=aE.dirruns;for(aA=0;(ax=ay[aA]);aA++){p=aE.runs++;if(aE(ax,av)){aH.push(ax)}}}}return aH};if(C.querySelectorAll){(function(){var av,ax=ak,aC=/[^\\],/g,aD=/^[\x20\t\n\r\f]*[+~]/,ay=/'/g,az=/\=[\x20\t\n\r\f]*([^'"\]]*)[\x20\t\n\r\f]*\]/g,aB=[],aA=[":active"],aw=B.matchesSelector||B.mozMatchesSelector||B.webkitMatchesSelector||B.oMatchesSelector||B.msMatchesSelector;f(function(aE){aE.innerHTML="<select><option selected></option></select>";if(!aE.querySelectorAll("[selected]").length){aB.push("\\["+at+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)")}if(!aE.querySelectorAll(":checked").length){aB.push(":checked")}});f(function(aE){aE.innerHTML="<p test=''></p>";if(aE.querySelectorAll("[test^='']").length){aB.push("[*^$]="+at+"*(?:\"\"|'')")}aE.innerHTML="<input type='hidden'>";if(!aE.querySelectorAll(":enabled").length){aB.push(":enabled",":disabled")}});aB=aB.length&&new RegExp(aB.join("|"));ak=function(aO,aE,aM,aN,aP){if(!aN&&!aP&&(!aB||!aB.test(aO))){if(aE.nodeType===9){try{V.apply(aM,an.call(aE.querySelectorAll(aO),0));return aM}catch(aK){}}else{if(aE.nodeType===1&&aE.nodeName.toLowerCase()!=="object"){var aF,aI=aE,aH=aE.getAttribute("id"),aG=aH||F,aJ=aE.parentNode,aL=aD.test(aO);if(aH){aG=aG.replace(ay,"\\$&")}else{aE.setAttribute("id",aG)}if(aL&&aJ){aE=aJ}try{if(aE){aG="[id='"+aG+"'] ";aF=aG+aO.replace(aC,"$&"+aG);V.apply(aM,an.call(aE.querySelectorAll(aF),0));return aM}}catch(aK){}finally{if(!aH){aI.removeAttribute("id")}}}}}return ax(aO,aE,aM,aN,aP)};if(aw){f(function(aE){av=aw.call(aE,"div");try{aw.call(aE,"[test!='']:sizzle");aA.push(G.match.PSEUDO)}catch(aF){}});aA=new RegExp(aA.join("|"));am.matchesSelector=function(aF,aG){aG=aG.replace(az,"='$1']");if(!M(aF)&&!aA.test(aG)&&(!aB||!aB.test(aG))){try{var aH=aw.call(aF,aG);if(aH||av||aF.document&&aF.document.nodeType!==11){return aH}}catch(aE){}}return am(aG,null,null,[aF]).length>0}}})()}au.Sizzle=am})(b.xRTML=b.xRTML||{})})(window);(function(xRTML,undefined){(function(JSON,undefined){(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}())})(xRTML.JSON=xRTML.JSON||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(d,k){var j="xrtml:",c=function(m){return !m.getAttribute("version")||m.getAttribute("version")===b.version},g=function(m){var p=m.getElementsByTagName(j+"connection"),o=[];for(var q=0;q<p.length;++q){if(c(p[q])){var n=p[q];o.push(new l(n));p[q].parentNode.removeChild(p[q--])}}return o},h=function(m){var r=m.getElementsByTagName(j+"storage"),q=[];for(var n=0,o=r.length;n<o;n++){if(c(r[n])){var p=r[n];q.push({id:p.getAttribute("id"),baseurl:p.getAttribute("baseurl"),type:p.getAttribute("type"),connectionid:p.getAttribute("connectionid"),sessionid:p.getAttribute("sessionid"),onready:p.getAttribute("onready")?new Function("event","return "+p.getAttribute("onready")+"(event);"):null,onsession:p.getAttribute("onsession")?new Function("event","return "+p.getAttribute("onsession")+"(event);"):null,onexception:p.getAttribute("onexception")?new Function("event","event","return "+p.getAttribute("onexception")+"(event);"):null});document.getElementsByTagName(j+"storages")[0].removeChild(r[n--])}}return q},f=function(){var n=document,m=document.getElementsByTagName(j+"config");if(m.length==0){return null}if(m.length==1){m=m[0];n=window.attachEvent?document:m}else{throw"xRTML requires a configuration tag per page."}return{debug:b.Common.Converter.toBoolean(m.getAttribute("debug")),logLevel:m.getAttribute("loglevel"),xrtmlActive:b.Common.Converter.toBoolean(m.getAttribute("xrtmlactive")),throwErrors:b.Common.Converter.toBoolean(m.getAttribute("throwerrors")),connectionAttempts:b.Common.Converter.toNumber(m.getAttribute("connectionattempts")),connectionTimeout:b.Common.Converter.toNumber(m.getAttribute("connectiontimeout")),remoteTrace:b.Common.Converter.toBoolean(m.getAttribute("remotetrace")),ortcUrl:m.getAttribute("ortcurl"),ortcLibrary:m.getAttribute("ortclibrary"),connections:g(n),storages:h(n)}},l=function(q,r){var m,n;if(q.attributes){for(var o=0;o<q.attributes.length;++o){m=q.attributes[o];if(m.specified){this[m.nodeName.toLowerCase()]=m.nodeValue}}}if(q.children.length!=0){for(var p=0;p<q.children.length;++p){n=q.children[p],childName=window.addEventListener?n.nodeName.split(":")[1].toLowerCase():n.nodeName.toLowerCase();if(!r){this[childName]=[];new l(n,this[childName])}else{if(n.attributes&&n.attributes.length==1&&n.attributes[0].nodeName=="value"){r.push(n.attributes[0].nodeValue)}else{r.push(new l(n))}if(n.children){new l(n,r)}}}}},i=function(){var q,r=[],o=b.TagManager.getClasses();for(var n=0;n<o.length;++n){q=document.getElementsByTagName(j+o[n]);for(var m=0;m<q.length;++m){var p=q[m];if(!window.addEventListener&&p.scopeName.toLowerCase()!="xrtml"){continue}if(c(p)){var t=new l(p);t.name=o[n];r.push(t);document.body.removeChild(q[m--])}}}return r};b.Event.extend(d);d.read=function(){var m=f();if(m){m.attribute=function(o){return b.Common.Object.insensitiveGetter(this,o)};this.fire({configLoad:{config:m}})}var n=i();if(n.length!=0){this.fire({tagsLoad:{tags:n}})}}})(b.DomParser=b.DomParser||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,g){var f=false,d=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;c.extend=function(k){var h=this.prototype;f=true;var l=new this();f=false;for(var j in k){l[j]=typeof k[j]=="function"&&typeof h[j]=="function"&&d.test(k[j])?(function(n,m){return function(){var p=this._super;this._super=h[n];var o=m.apply(this,arguments);this._super=p;return o}})(j,k[j]):k[j]}function i(){if(!f&&this.init){this.init.apply(this,arguments)}}i.prototype=l;i.prototype.constructor=i;i.extend=arguments.callee;return i}})(b.Class=b.Class||function(){})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,f){var d="";b.Event.extend(c);c.logLevels={error:0,warn:1,info:2};c.debug=false;c.logLevel=2;c.connectionAttempts=5;c.connectionTimeout=10000;c.remoteTrace=false;c.heartbeatActive=false;c.heartbeatFails=3;c.heartbeatTime=25;c.ortcLibrary=function(h,g){if(arguments.length!=0){d=h;b.Common.DOM.loadScript({url:h,callback:g})}return d};b.DomParser.bind({configLoad:function(h){var g=h.config;c.debug=g.attribute("debug")?g.attribute("debug"):c.debug;c.logLevel=g.attribute("logLevel")?g.attribute("logLevel"):c.logLevel;c.connectionAttempts=g.attribute("connectionAttempts")?g.attribute("connectionAttempts"):c.connectionAttempts;c.connectionTimeout=g.attribute("connectionTimeout")?g.attribute("connectionTimeout"):c.connectionTimeout;c.remoteTrace=g.attribute("remoteTrace")?g.attribute("remoteTrace"):c.remoteTrace;c.heartbeatActive=g.attribute("heartbeatActive")?g.attribute("heartbeatActive"):c.heartbeatActive;c.heartbeatFails=g.attribute("heartbeatFails")?g.attribute("heartbeatFails"):c.heartbeatFails;c.heartbeatTime=g.attribute("heartbeatTime")?g.attribute("heartbeatTime"):c.heartbeatTime;for(var j=0;j<g.connections.length;++j){b.ConnectionManager.create(g.connections[j])}for(var j=0;j<g.storages.length;++j){b.StorageManager.create(g.storages[j])}}})})(b.Config=b.Config||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,f){var d=(function(){if(typeof console!=="undefined"){return console}var g={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}};return g})();c.log=function(g){if(b.Config.debug===true){d.log(g)}};c.debug=function(g){if(b.Config.debug===true){d.debug?d.debug(g):d.log(g)}};c.info=function(g){if(b.Config.debug===true){d.info?d.info(g):d.log(g)}};c.warn=function(g){if(b.Config.debug===true){d.warn?d.warn(g):d.log(g)}};c.error=function(g){if(b.Config.debug===true){d.error?d.error(g):d.log(g)}if(b.Config.remoteTrace===true){this.fire({error:{error:g}})}};b.Event.extend(c)})(b.Console=b.Console||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,g){var d={uiEffects:{blind:true,bounce:true,clip:true,drop:true,explode:true,fade:true,fold:true,highlight:true,puff:true,pulsate:true,scale:true,shake:true,size:true,slide:true,transfer:true},cssPropsMapping:{"padding-top":"paddingTop"},checkIfEffectFunctionAvailable:function(i){var h=(jQuery&&jQuery.fn&&((typeof jQuery.fn[i]).toLowerCase()=="function"))||(jQuery&&jQuery.effects&&((typeof jQuery.effects[i]).toLowerCase()=="function"));if(!h){b.Error.raise({code:b.Error.Codes.MISSING_LIBRARY,info:{library:"jQuery",module:i,className:"xRTML.Effect.Manager (internal class, no docs available)",methodName:"checkIfEffectFunctionAvailable (internal method, no docs available)"}})}},callJQueryEffect:function(h){b.Console.debug("jQuery effect: Running "+h.effectName+" on element "+h.element.id+" with options "+b.JSON.stringify(h.effectOptions)+" and properties: "+b.JSON.stringify(h.effectProperties));this.checkIfEffectFunctionAvailable(h.effectName);try{if(this.uiEffects[h.effectName]){jQuery.fn.effect.call(jQuery(h.element),h.effectName,h.effectOptions,h.effectSpeed,h.effectCallback)}else{jQuery.fn[h.effectName].call(jQuery(h.element),h.effectProperties,h.effectOptions)}}catch(i){b.Error.raise({code:b.Error.Codes.UNEXPECTED,info:{message:i.message,className:"xRTML.Effect.Manager (internal class, no docs available)",methodName:"callJQueryEffect (internal method, no docs available)"}})}},buildReverseEffectProperties:function(h){var i={};for(var k in h.properties){var j=b.Common.Object.insensitiveGetter(h.element.style,k.replace("-",""));if(!j||j==""){j=b.Common.DOM.getStyle({element:h.element,rule:k})}i[k]=j}return i},cloneJQueryOptions:function(i){var h={};for(prop in i){h[prop]=i[prop]}return h}},f={runEffects:function(h){if(this.effects){if(typeof h.stopCurrent=="undefined"||h.stopCurrent){d.checkIfEffectFunctionAvailable("animate");jQuery(h.element).stop(false,true)}for(var k=0;k<this.effects.length;k++){try{var l=d.cloneJQueryOptions(typeof this.effects[k].options=="object"?this.effects[k].options:b.JSON.parse(this.effects[k].options)),m=typeof this.effects[k].properties=="object"?this.effects[k].properties:b.JSON.parse(this.effects[k].properties),n=d.buildReverseEffectProperties({properties:m,element:h.element})}catch(j){b.Error.raise({code:b.Error.Codes.JSON_PARSE,info:{message:j.message,className:"xRTML.Effect.Provider (internal class, no docs available)",methodName:"runEffects"}})}d.callJQueryEffect({element:h.element,effectName:this.effects[k].name,effectOptions:l,effectProperties:m,effectSpeed:this.effects[k].speed,effectCallback:this.effects[k].callback?(typeof this.effects[k].callback=="function"?this.effects[k].callback:new Function("","return "+this.effects[k].callback+"();")):null,revert:this.effects[k].revert});if(this.effects[k].revert){d.callJQueryEffect({element:h.element,effectName:this.effects[k].name,effectOptions:l,effectProperties:n,effectSpeed:this.effects[k].speed,effectCallback:null,revert:false})}}}}};c.extend=function(i){for(var h in f){i[h]=f[h]}}})(b.Effect=b.Effect||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,f){b.Event.extend(c);c.raise=function(g){var h=new c.XRTMLError(g);new window.Error().stack?b.Console.error(h):d(h);return h};c.XRTMLError=function(g){var h=!!g.code?g.code:b.Error.Codes.UNEXPECTED;this.name=h.type;var i=!!g.info?g.info:{};i.className=!!i.className?i.className:(!!g.target?(!!g.target.name?g.target.name:Object.prototype.toString.call(g.target)):"Unknown");i.id=!!i.id?i.id:(!!g.target?g.target.id:"Unknown");i.message=!!i.message?i.message:g.message;i.arguments=g.arguments;this.message=b.Common.String.template(h.message,i);this.type=h.type;this.target=g.target;this.info=i;c.fire({exception:{error:this}})};c.XRTMLError.prototype=window.Error.prototype;c.Codes={MANDATORY_PROPERTY:{type:"ValidationError",message:"The property {property} is required for a {className} with the id {id}."},INVALID_PROPERTY:{type:"ValidationError",message:"The property {property} of a {className} with the id {id} has the wrong type. The appropriate type would be {validType}."},CONNECTION_INACTIVE:{type:"ConnectionError",message:"Tried to perform an operation on Connection {id} which is not active."},CONNECTION_EXCEPTION:{type:"ConnectionError",message:"An unexpected problem occured on the Connection {id}. {message}"},CONNECTION_NOT_FOUND:{type:"ConnectionError",message:"Unable to find a Connection with the specified id: {id}."},CONNECTION_PROCESS:{type:"ConnectionError",message:"An error ocurred while processing the message {xRTMLMessage} arrived at Connection {id}. {message}"},CONNECTION_ADAPT:{type:"ConnectionError",message:"An error ocurred while adapting the message {originalMessage} arrived at Connection {id}. {message}"},CONNECTION_DUPLICATE:{type:"ConnectionError",message:"Connection with id {id} already exists."},ORTC_NOT_FOUND:{type:"ORTCError",message:"Unable to obtain the ORTC library from the address specified."},ORTC_UNAVAILABLE:{type:"ORTCError",message:"Connection {id}: ORTC client is not created yet."},ORTC_DISCONNECTED:{type:"ORTCError",message:"Connection {id}: Disconnect not possible. ORTC client is not connected."},ORTC_EXCEPTION:{type:"ORTCError",message:"An unexpected problem occured on the Connection {id}. {message}"},TAG_NOT_CREATED:{type:"TagError",message:"A problem occured while trying to create a {className} Tag with id {id}. {message}"},TAG_INACTIVE:{type:"TagError",message:"Tried to perform an action on a {className} with {id} which is not active."},TAG_UNREGISTERED:{type:"TagError",message:"The specified Tag does not exist in the registered tags namespace."},TAG_INVALID_CONFIG:{type:"TagError",message:"Unable to register a Tag with the specified configuration. {message}"},TAG_ABSTRACT:{type:"TagError",message:"The specified tag {tag} should not be instantiated."},TAG_ACTION_UNDEFINED:{type:"TagError",message:"Tried to perform an action {action} which is not defined on a {className} with id {id}."},TAG_NOT_FOUND:{type:"TagError",message:"Unable to find a Tag with the specified id: {id}."},TAG_PROCESS:{type:"TagError",message:"An error ocurred while processing the arrived message on a {className} with id {id}. {message}"},INVALID_MESSAGE:{type:"MessageError",message:"Tried to create a message with invalid properties. {message}"},TRIGGER_UNREGISTERED:{type:"MessageError",message:"A message arrived containing a trigger which is not registered by any Tag."},STORAGE_CONNECTION_UNAVAILABLE:{type:"StorageError",message:"The Remote Storage component for a {className} provider with id {id} could not find a connection with connectionId: {connectionId}"},STORAGE_UNAVAILABLE:{type:"StorageError",message:"The Remote Storage component for a {className} provider with id {id} is not available."},STORAGE_SESSION:{type:"StorageError",message:"The Remote Storage component for a {className} provider with id {id} was not able to get a session. {message}"},STORAGE_ACTION_UNDEFINED:{type:"StorageError",message:"Tried to perform an action which is not defined on a {className} with id {id}."},STORAGE_PERMISSIONS:{type:"StorageError",message:"Tried to perform an action for which the {className} with id {id} does not have the necessary permissions. Were the right channel permissions set on the server-side?"},STORAGE_OPERATION_TIMEOUT:{type:"StorageError",message:"The Storage operation with the id: {opId} was not completed whithin the expected timeout: {timeout}"},STORAGE_CALLBACK_FAILURE:{type:"StorageError",message:"The Storage operation with the id: {opId} callback has failed. {message}"},REQUEST_FAILURE:{type:"RequestError",message:"An error occured while calling the specified address. {message}"},REQUEST_UNAVAILABLE:{type:"RequestError",message:"Unable to obtain a response from the specified address."},REQUEST_UNSUPPORTED:{type:"RequestError",message:"This browser does not support XMLHttpRequest neither XDomainRequest."},JSON_PARSE:{type:"ParseError",message:"Unable to parse the specified String according to JSON specification rules. {message}"},DOM_PARSE:{type:"ParseError",message:"Unable to parse an XRTML DOM Node. "},MISSING_ARGUMENT:{type:"MethodError",message:"A method {methodName} was called but the required argument {argument} was undefined."},INVALID_ARGUMENT:{type:"MethodError",message:"The method {methodName} was called but the argument {argument} was of an invalid type. The expected type was {expectedType}"},UNEXPECTED:{type:"UnexpectedError",message:"An unexpected error occured. Cause error message is: {message}"},FATAL:{type:"FatalError",message:"A critical error occured. The error message is: {message}"},INVALID_DOM_ATTRIBUTE:{type:"InvalidDomAttribute",message:"An error occured when trying to retrive an unexisting attribute: {attribute}"},TEMPLATING:{type:"TemplateError",message:"An error occured when trying to apply bindings to a template. The cause is: {message}"},TEMPLATING_EFFECTS:{type:"TemplateError",message:"An error occured when trying to run effects binded in a template. Are the effects configured in the tag? The error cause is: {message}"},UNEXPECTEDMEDIA:{type:"UnexpectedMediaError",message:"An error occurred when trying to operate on media. The cause is: {message}"},UNEXPECTEDEVENT:{type:"UnexpectedEventError",message:'An error occurred when trying to process the "{eventType}" event handler. The cause is: {message}'},MISSING_LIBRARY:{type:"MissingLibrary",message:"A required library {library} {module} is not available. Please import this library."}};var d=function(h){var i=[];i.push(h.name+": "+h.message+"\n");function g(j,k,n,q){var m=[];for(var l=0;l<n;l++){m.push(" ")}var o=m.join("");if(q<9){for(var p in j){if(j.hasOwnProperty(p)&&p!="name"&&p!="message"){if(typeof j[p]==="string"||typeof j[p]==="number"||typeof j[p]==="boolean"){k.push((o+p+": "+j[p])+"\n")}else{if(b.Common.Object.isObject(j[p])){k.push(o+p+": \n");g(j[p],k,n+4,q+1)}else{if(b.Common.Array.isArray(j[p])){k.push(o+p+": \n");for(var l=0;l<j[p].length;l++){g(j[p],k,n+4,q+1)}}}}}}}else{k.push(o+j.toString()+"\n")}}g(h,i,0,1);b.Console.error(i.join(""))}})(b.Error=b.Error||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,g){f.contains=function(h){var k=h.items;for(var j=0,l=k.length;j<l;j++){if(b.Common.Object.equals({o1:k[j],o2:h.obj})){return true}}return false};f.isArray=function(h){return Object.prototype.toString.call(h)==="[object Array]"}})(b.Common.Array=b.Common.Array||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,g){f.equals=function(h){return b.JSON.stringify(h.o1)===b.JSON.stringify(h.o2)};f.isObject=function(h){return""+h=="[object Object]"};f.insensitiveGetter=function(h,j){for(var i in h){if(h.hasOwnProperty&&h.hasOwnProperty(i)&&(j+"").toLowerCase()==(i+"").toLowerCase()){return h[i];break}}};f.keys=window.Object.keys||function(j){var i=[],h;for(h in j){if(window.Object.prototype.hasOwnProperty.call(j,h)){i.push(h)}}return i}})(b.Common.Object=b.Common.Object||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,g){f.trim=function(h){return typeof window.String.prototype.trim=="function"?h.trim():h.replace(/^\s+|\s+/g,"")};f.template=function(j,k){for(var h in k){var i=new RegExp("\\{"+h+"\\}","gm");j=j.replace(i,k[h])}return j}})(b.Common.String=b.Common.String||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,h){var g=function(j,i){var k=document.createElement("script");k.type="text/javascript";if(k.readyState){k.onreadystatechange=function(){if(k.readyState=="loaded"||k.readyState=="complete"){k.onreadystatechange=null;i.apply(this,arguments)}}}else{k.onload=function(){i.apply(this,arguments)}}k.src=j;document.getElementsByTagName("head")[0].appendChild(k)};f.loadScript=function(i){g(i.url,i.callback)};f.loadScripts=function(j,l){if(b.Common.Array.isArray(j)){var k=[];for(var m=0;m<j.length;m++){(function(i){k.push(function(n){g(i,function(){n()})})})(j[m])}b.Async.parallel(k,function(){l()})}else{g(j,l)}};f.getStyle=function(i){if(document.defaultView&&document.defaultView.getComputedStyle){return document.defaultView.getComputedStyle(i.element,"").getPropertyValue(i.rule)}if(i.element.currentStyle){var j=i.rule.replace(/\-(\w)/g,function(l,k){return k.toUpperCase()});return i.element.currentStyle[j]}return""}})(b.Common.DOM=b.Common.DOM||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(g,i){g.post=function(l){l.method="POST";h(l)};g.get=function(l){l.method="GET";if(l.data!="undefined"){var p=l.url,m=l.data;p+=p.indexOf("?")==-1?"?":"&";for(var n in l.data){var o=m[n];if(typeof o!="object"&&typeof o!="boolean"){p+=n+"="+o+"&"}}if(p.lastIndexOf("&")==p.length-1){p=p.slice(0,-1)}l.url=p}h(l)};var h=function(l){var m=f(l).create(l.method.toLowerCase(),l.url,b.Common.Function.proxy(function(o,n,p){if(typeof n!="undefined"&&n!=null){if(l.error){l.error(n)}}else{if(l.success){l.success(o)}}if(l.complete){l.complete(o,n,p)}},this),l.async,l.headers);m.send(l.data?l.data:null)},f=function(l){if(window.XMLHttpRequest&&(!l.crossDomain||"withCredentials" in k().getNativeObject())){return k()}else{if(window.XDomainRequest){return j()}else{b.Error.raise({code:b.Error.Codes.REQUEST_UNSUPPORTED,info:{className:"xRTML.Common.Request",methodName:"getRequestType (internal method, no docs available)"}})}}},k=function(){return{getNativeObject:function(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(l){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(l){}try{return ActiveXObject("Microsoft.XMLHTTP")}catch(l){}}}b.Error.raise({code:b.Error.Codes.REQUEST_UNSUPPORTED,info:{className:"xRTML.Common.Request.XHR (internal class, no docs available)",methodName:"getNativeObject (internal method, no docs available)"}})},create:function(o,r,m,l,n){var q=this;q.xhr=this.getNativeObject();q.callback=m;o=o.toUpperCase();q.xhr.onreadystatechange=function(){try{if(this.readyState==4){if(this.status==200){q.callback(this.responseText,null,this.status)}else{if(this.status==0){q.callback(null,"The status code is 0 which likely means that the server is unavailable.",this.status)}else{q.callback(null,this.responseText,this.status)}}}}catch(t){b.Console.error(t)}};q.xhr.open(o,r,!!l?l:true);if(n){for(var p in n){q.xhr.setRequestHeader(p,n[p])}}else{q.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");q.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")}return q},send:function(l){if(l&&typeof(l)!="string"){l=b.JSON.stringify(l)}b.Console.debug("Performing request with payload: "+l);this.xhr.send(l)}}},j=function(){return{create:function(o,q,m,l){var p=this;p.xdr=new XDomainRequest();p.callback=m;o=o.toUpperCase();p.xdr.onload=function(){try{p.callback(p.xdr.responseText)}catch(r){b.Error.raise({code:b.Error.Codes.UNEXPECTED,info:{message:r.message,className:"xRTML.Common.Request.XDR (internal class, no docs available)",methodName:"onload (internal method, no docs available)"}})}};p.xdr.onerror=function(){try{p.callback(null,p.xdr.responseText)}catch(r){b.Error.raise({code:b.Error.Codes.UNEXPECTED,info:{message:r.message,className:"xRTML.Common.Request.XDR (internal class, no docs available)",methodName:"onerror (internal method, no docs available)"}})}};p.xdr.open(o,q,!!l?l:true);try{p.xdr.contentType="text/plain"}catch(n){}return p},send:function(l){var m=this;function n(o){if(o&&typeof(o)!="string"){o=b.JSON.stringify(o)}b.Console.debug("Performing request with payload: "+o);m.xdr.send(o);if(m.xdrTimeout){clearTimeout(m.xdrTimeout);m.xdrTimeout=i}}if(m.xdrReady){n(l)}else{m.xdrTimeout=setTimeout(function(){n(l)},200)}}}}})(b.Common.Request=b.Common.Request||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,g){f.setCookie=function(h){var i=h.name+"="+escape(h.value);if(h.expires){i+="; expires="+h.expires.toGMTString()}if(h.path){i+="; path="+escape(h.path)}else{i+="; path=/"}if(h.domain){i+="; domain="+escape(h.domain)}if(h.secure){i+="; secure"}document.cookie=i};f.getCookie=function(h){var i=document.cookie.match("(^|;) ?"+h.name+"=([^;]*)(;|$)");if(i){return(unescape(i[2]))}return g};f.deleteCookie=function(h){h.value="";h.expires=new Date("Thu, 01 Jan 1970 00:00:01 GMT");f.setCookie(h)}})(b.Common.Cookie=b.Common.Cookie||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(g,f){g.validateRequired=function(h){if(!h.target[h.prop]&&h.target[h.prop]!=0||(b.Common.Array.isArray(h.target[h.prop])&&h.target[h.prop].length<=0)){b.Error.raise({code:b.Error.Codes.MANDATORY_PROPERTY,target:h.target,info:{property:h.prop}})}}})(b.Common.Validator=b.Common.Validator||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,g){f.toBoolean=function(h){return typeof h==="undefined"?h:(/^true|1|yes$/i).test(h)};f.toNumber=function(h){if(typeof h==="undefined"){return h}if(typeof h=="number"){return h}if(typeof h=="string"){return b.Common.String.trim(h)==""?0:window.Number(h)}};f.toDate=function(k){var j=k.split(" "),h=j[0].split("-"),i=j[1].split(":");return new Date(parseInt(h[2]),parseInt(h[1])-1,parseInt(h[0]),parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),0)}})(b.Common.Converter=b.Common.Converter||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(h,g){var f=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};h.guidGenerator=function(){return(f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f())};h.idGenerator=function(){return(f()+f())}})(b.Common.Util=b.Common.Util||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){(function(f,g){f.proxy=function(i,h){if(typeof i==="function"&&typeof h==="object"){return function(){return i.apply(h,arguments)}}};f.parse=function(k){if(typeof k=="function"){return k}if(typeof k!="string"){return null}var h="",j="return "+k+"(";if(arguments.length!=1){for(var l=1;l<arguments.length;++l){h+=arguments[l]+","}h=h.substring(0,h.length-1)}j+=h+");";return new window.Function(h,j)};f.paramNames=function(h){var i=h.toString();return i.match(/\(.*?\)/)[0].replace(/[()]/gi,"").replace(/\s/gi,"").split(",")}})(b.Common.Function=b.Common.Function||{})})(b.Common=b.Common||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,h){var d={},f=function(i){for(var j in d){if(d[j].id===i){return d[j]}}return h},g={add:function(i){var j=i.connection.id;if(!this.bConnections[j]){this.bConnections[j]=[];i.connection.bind({connect:this.send})}this.bConnections[j].push(i.message)},bConnections:{},send:function(k){var m=g.bConnections[k.target.id],j=k.target;for(var l=0;l<m.length;++l){j.send(m[l])}j.unbind({connect:g.send});g.bConnections[k.target.id]=h}};c.create=function(i){i.attribute=function(j){return b.Common.Object.insensitiveGetter(this,j)};return this.add(new this.Connection(i))};c.add=function(i){if(this.getById(i.id)){throw new b.Error({code:b.Error.Codes.CONNECTION_DUPLICATE,target:i})}this.Connections.push(i.id);this.fire({connectionCreate:{connection:i}});d[i.internalId]=i;i.bind({xrtmlMessage:function(j){c.fire({xrtmlMessage:{connection:j.target,channel:j.channel,message:j.message}})},message:function(j){c.fire({message:{connection:j.target,channel:j.channel,message:j.message}})}});i.bind({dispose:function(m){var j=m.target.internalId,l=d[j];d[j]=null;delete d[j];for(var n=0,k=c.Connections,o=k.length;n<o;n++){if(k[n]===m.target.id){k.splice(n,1);break}}c.fire({connectionDispose:{connection:m.target}})}});return i};c.getById=function(i){return d[i]||f(i)};c.dispose=function(j){var i=this.getById(j);if(i){i.dispose()}else{b.Console.warn("ConnectionManager: Connection "+j+" was not found.")}};c.addChannel=function(i){var j=this.getById(i.connectionId);if(typeof j==="undefined"){j=this.getConnectionById(i.connectionId);if(j===null){b.Error.raise({code:b.Error.Codes.CONNECTION_NOT_FOUND,target:this,info:{className:"xRTML.ConnectionManager",methodName:"addChannel"}})}}j.createChannel(i)};c.sendMessage=function(l){var j=null;for(var k=0;k<l.connections.length;++k){j=this.getById(l.connections[k]);if(j){if(j.isConnected()){j.send(l)}else{g.add({connection:j,message:{channel:l.channel,content:l.content,sendOnly:l.sendOnly}});b.Console.debug("ConnectionManager: Connection with id "+l.connections[k]+" is not connected. Buffering message:");b.Console.debug(l)}}else{b.Error.raise({code:b.Error.Codes.CONNECTION_NOT_FOUND,target:this,info:{className:"xRTML.ConnectionManager",methodName:"sendMessage"}})}}};c.Connections=[];b.Event.extend(c)})(b.ConnectionManager=b.ConnectionManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){c.Connection=function(g){var m=null,f=true;b.Event.extend(this);this.internalId=b.Common.Util.guidGenerator();this.id=g.attribute("id")||this.internalId;this.appKey=g.attribute("appKey");this.authToken=g.attribute("authToken");this.sendRetries=parseInt(g.attribute("sendRetries"))||5;this.sendInterval=parseInt(g.attribute("sendInterval"))||1000;this.timeout=g.attribute("timeout")||b.Config.connectionTimeout;this.connectAttempts=g.attribute("connectAttempts")||b.Config.connectionAttempts;this.connectionAttemptsCounter=0;this.autoConnect=typeof g.attribute("autoConnect")=="undefined"?true:b.Common.Converter.toBoolean(g.attribute("autoConnect"));this.metadata=g.attribute("metadata");this.serverType=g.attribute("serverType")||"IbtRealTimeSJ";this.url=g.attribute("url")||b.Console.error("Connection "+this.id+": ORTC Server URL must be set.");this.isCluster=typeof g.attribute("isCluster")=="undefined"?true:b.Common.Converter.toBoolean(g.attribute("isCluster"));this.announcementSubChannel=g.attribute("announcementSubChannel");this.heartbeatActive=typeof g.attribute("heartbeatActive")=="undefined"?b.Config.heartbeatActive:b.Common.Converter.toBoolean(g.attribute("heartbeatActive"));this.heartbeatFails=typeof g.attribute("heartbeatFails")=="undefined"?b.Config.heartbeatFails:b.Common.Converter.toBoolean(g.attribute("heartbeatFails"));this.heartbeatTime=typeof g.attribute("heartbeatTime")=="undefined"?b.Config.heartbeatTime:b.Common.Converter.toBoolean(g.attribute("heartbeatTime"));this.channels={};var p=b.Common.Function.parse,n=b.Common.Function.proxy;this.messageAdapter=p(g.attribute("messageAdapter"),"message");this.bind({create:p(g.attribute("onCreate"),"e"),connect:p(g.attribute("onConnect"),"e"),channelCreate:p(g.attribute("onChannelCreate"),"e"),disconnect:p(g.attribute("onDisconnect"),"e"),subscribe:p(g.attribute("onSubscribe"),"e"),unsubscribe:p(g.attribute("onUnsubscribe"),"e"),exception:p(g.attribute("onException"),"e"),reconnect:p(g.attribute("onReconnect"),"e"),reconnecting:p(g.attribute("onReconnecting"),"e"),message:p(g.attribute("onMessage"),"e"),dispose:p(g.attribute("onDispose"),"e"),xrtmlMessage:p(g.attribute("onXrtmlMessage"),"e")});var l=n(function(q,i,r){this.process({channel:i,message:r})},this),k=function(i){m=i.createClient();m.setId(this.internalId);m.setConnectionTimeout(this.timeout);m.setConnectionMetadata(typeof this.metadata=="object"?b.JSON.stringify(this.metadata):this.metadata);if(typeof m.setHeartbeatActive!="undefined"){m.setHeartbeatActive(this.heartbeatActive);m.setHeartbeatFails(this.heartbeatFails);m.setHeartbeatTime(this.heartbeatTime)}else{if(this.heartbeatActive){b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}m.setAnnouncementSubChannel(this.announcementSubChannel);!this.isCluster?m.setUrl(this.url):m.setClusterUrl(this.url);m.onConnected=n(function(t){for(var r in this.channels){var q=this.channels[r];if(q.subscribe){t.subscribe(q.name,q.subscribeOnReconnect,l)}}this.fire({connect:{}})},this);m.onDisconnected=n(function(q){this.fire({disconnect:{}})},this);m.onSubscribed=n(function(r,q){this.channels[q].fire({subscribe:{}});this.fire({subscribe:{channel:q}})},this);m.onUnsubscribed=n(function(r,q){var t=this.channels[q];delete this.channels[q];t.fire({unsubscribe:{}});this.fire({unsubscribe:{channel:q}})},this);m.onException=n(function(r,q){this.fire({exception:{message:q}});b.Error.raise({code:b.Error.Codes.ORTC_EXCEPTION,target:this,info:{className:"ORTCClient",methodName:"onException",message:q}})},this);m.onReconnected=n(function(q){this.connectionAttemptsCounter=0;this.fire({reconnect:{}})},this);m.onReconnecting=n(function(q){if(this.connectionAttemptsCounter>=this.connectAttempts){q.disconnect()}else{this.connectionAttemptsCounter++;this.fire({reconnecting:{}})}},this);this.fire({create:{}});if(this.autoConnect){m.connect(this.appKey,this.authToken)}};var o=function(i,q){if(this.isCreated()&&this.isConnected()){this.send(i)}else{if(++q<=this.sendRetries){setTimeout(n(function(){n(o,this)(i,q)},this),this.sendInterval);b.Console.debug("Message "+i.content+" not sent to channel "+i.channel+". Retry "+q+"/"+this.sendRetries+" in "+this.sendInterval/1000+" seconds.")}else{b.Console.debug("Message "+i.content+" not sent to channel "+i.channel+". Discarding message.")}}};this.active=function(i){if(!i){return f}f=b.Common.Converter.toBoolean(i);return f};this.dispose=function(){if(this.isConnected()){this.disconnect()}this.fire({dispose:{}})};this.createChannel=function(i){i.attribute=function(r){return b.Common.Object.insensitiveGetter(this,r)};var q={connectionId:i.attribute("connectionId")||this.id,name:i.attribute("name"),subscribeOnReconnect:typeof i.attribute("subscribeOnReconnect")=="undefined"?true:b.Common.Converter.toBoolean(i.attribute("subscribeOnReconnect")),subscribe:typeof i.attribute("subscribe")=="undefined"?true:b.Common.Converter.toBoolean(i.attribute("subscribe")),messageAdapter:p(i.attribute("messageAdapter","message"))};b.Event.extend(q);q.bind({message:p(i.attribute("onMessage"),"e"),subscribe:p(i.attribute("onSubscribe"),"e"),unsubscribe:p(i.attribute("onUnsubscribe"),"e"),xrtmlMessage:p(i.attribute("onXrtmlMessage"),"e")});this.channels[i.name]=q;this.fire({channelCreate:{channel:q}});return q};this.process=function(q){var i=q.channel,r=q.message;if(r.substring(0,15)=="_X_SEND_ONLY_X_"){if(this.internalId==r.substring(15,51)){return}r=r.substring(54)}if(this.active()){b.Async.series([b.Common.Function.proxy(function(t){if(this.messageAdapter){try{r=this.messageAdapter(r)}catch(u){b.Error.raise({code:b.Error.Codes.CONNECTION_ADAPT,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"process",originalMessage:r,message:u.message}})}}t()},this),b.Common.Function.proxy(function(t){this.fire({message:{channel:i,message:r}});t()},this),b.Common.Function.proxy(function(t){if(b.MessageManager.isValid(r)){this.fire({xrtmlMessage:{message:b.MessageManager.toJson(r).xrtml,channel:i}})}t()},this)]);if(this.channels[i]){b.Async.series([b.Common.Function.proxy(function(t){if(this.channels[i].messageAdapter){try{r=this.channels[i].messageAdapter(r)}catch(u){b.Error.raise({code:b.Error.Codes.CONNECTION_ADAPT,target:this.channels[i],info:{className:"xRTML.ConnectionManager.Channel",methodName:"process",originalMessage:r,message:u.message}})}}t()},this),b.Common.Function.proxy(function(t){this.channels[i].fire({message:{message:r}});t()},this),b.Common.Function.proxy(function(t){if(b.MessageManager.isValid(r)){this.channels[i].fire({xrtmlMessage:{message:b.MessageManager.toJson(r).xrtml}})}t()},this)])}}else{b.Console.debug("Connection "+this.id+" : Not active. Message received wasn't processed.")}};this.send=function(i){var q=i.channel,r=i.content;if(this.isCreated()&&this.isConnected()){if(this.active()){var t=typeof r==="object"?r.stringify():r;if(i.sendOnly){t="_X_SEND_ONLY_X_"+this.internalId+"_X_"+t}m.send(q,t);b.Console.debug("Connection "+this.id+": Message sent to channel "+q);b.Console.debug(r)}else{b.Console.debug("Connection "+this.id+": Not active. Message not sent to channel "+q);b.Console.debug(r)}}else{setTimeout(n(function(){n(o,this)(i,0)},this),this.sendInterval);b.Console.debug("Connection "+this.id+": Not ready. Message not sent to channel "+q+". Retrying in "+this.sendInterval/1000+" seconds.");b.Console.debug(r)}return};this.connect=function(i){if(this.isCreated()){if(i){this.appKey=i.appKey;this.authToken=i.authToken}m.connect(this.appKey,this.authToken)}else{b.Error.raise({code:b.Error.Codes.ORTC_UNAVAILABLE,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"connect"}})}};this.disconnect=function(){this.isConnected()?m.disconnect():b.Error.raise({code:b.Error.Codes.ORTC_DISCONNECTED,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"disconnect"}})};this.subscribe=function(i){if(!this.channels[i.name]){i=this.createChannel(i)}m.subscribe(this.channels[i.name].name,this.channels[i.name].subscribeOnReconnect,l)};this.unsubscribe=function(i){m.unsubscribe(i)};this.isCreated=function(){return m!=null};this.isConnected=function(){return this.isCreated()?m.getIsConnected():false};this.isSubscribed=function(i){return this.isConnected()?m.isSubscribed(i):false};this.getMetadata=function(){if(this.isCreated()){try{return b.JSON.parse(m.getConnectionMetadata())}catch(i){return m.getConnectionMetadata()}}else{b.Error.raise({code:b.Error.Codes.ORTC_UNAVAILABLE,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"getMetadata"}})}};this.setMetadata=function(i){return this.isCreated()?m.setConnectionMetadata(typeof i=="object"?b.JSON.stringify(i):i):b.Error.raise({code:b.Error.Codes.ORTC_UNAVAILABLE,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"setMetadata"}})};this.getAnnouncementSubChannel=function(){return this.isCreated()?m.getAnnouncementSubChannel():b.Error.raise({code:b.Error.Codes.ORTC_UNAVAILABLE,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"getAnnouncementSubChannel"}})};this.getProtocol=function(){return this.isConnected()?m.getProtocol():b.Error.raise({code:b.Error.Codes.ORTC_UNAVAILABLE,target:this,info:{className:"xRTML.ConnectionManager.Connection",methodName:"getProtocol"}})};this.setProtocol=function(i){if(this.isCreated()){m.setProtocol(i)}};if(typeof loadOrtcFactory!="undefined"){loadOrtcFactory(this.serverType,n(k,this))}else{b.bind({ready:n(function(){n(loadOrtcFactory,this)(this.serverType,n(k,this))},this)})}this.getHeartbeatActive=function(){if(this.isCreated()){if(typeof m.getHeartbeatActive!="undefined"){return m.getHeartbeatActive()}else{b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}};this.getHeartbeatFails=function(){if(this.isCreated()){if(typeof m.getHeartbeatFails!="undefined"){return m.getHeartbeatFails()}else{b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}};this.getHeartbeatTime=function(){if(this.isCreated()){if(typeof m.getHeartbeatTime!="undefined"){return m.getHeartbeatTime()}else{b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}};this.setHeartbeatActive=function(i){if(this.isCreated()){if(typeof m.setHeartbeatActive!="undefined"){m.setHeartbeatActive(i)}else{b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}};this.setHeartbeatFails=function(i){if(this.isCreated()){if(typeof m.setHeartbeatFails!="undefined"){m.setHeartbeatFails(i)}else{b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}};this.setHeartbeatTime=function(i){if(this.isCreated()){if(typeof m.setHeartbeatTime!="undefined"){m.setHeartbeatTime(i)}else{b.Console.warn("The heartbeat feature is not available for the ORTC version loaded.")}}};if(g.attribute("channels")){var h=g.attribute("channels");for(var j=0;j<h.length;++j){this.createChannel(h[j])}}}})(b.ConnectionManager=b.ConnectionManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(d,g){var f={},c=function(h){for(var i in f){if(f[i].id===h){return f[i]}}b.Console.warn("Storage with id: "+h+" was not found.");return g};d.create=function(h){try{var k=new d[h.type||"KeyValuePairStorage"](),j=d.BaseStorage.extend(k);h.attribute=function(l){return b.Common.Object.insensitiveGetter(h,l)};j=new j(h);j.bind({dispose:function(m){var n=m.target.internalId,l=f[n];f[n]=null;delete f[n];d.fire({storagedispose:{storage:m.target}})}});f[j.internalId]=j;d.fire({storagecreate:{storage:j}});return j}catch(i){b.Error.raise({code:b.Error.Codes.UNEXPECTED,info:{message:i.message,className:"xRTML.StorageManager",methodName:"create"}})}};d.getById=function(h){return f[h]||c(h)};b.Event.extend(d)})(b.StorageManager=b.StorageManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(d,f){var c=function(){this.init=function(h){b.Event.extend(this);this.internalId=b.Common.Util.guidGenerator();this.id=h.attribute("id")||this.internalId;this.type=h.attribute("type")||"KeyValuePairStorage";this.isReady=false;var g=h.attribute("autoConnect");this.autoConnect=typeof g!="undefined"?b.Common.Converter.toBoolean(g):true;this.dispose=function(){this.fire({dispose:{}})};this.bind({ready:b.Common.Function.parse(h.attribute("onready")),exception:b.Common.Function.parse(h.attribute("onexception"))})}};d.BaseStorage=b.Class.extend(new c())})(b.StorageManager=b.StorageManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(d,f){var c=function(){this.init=function(o){this._super(o);var n=o.attribute("baseUrl");this.baseUrl=!!n?(n[n.length-1]=="/"?n.substring(0,(n.length-1)):n):null;b.Common.Validator.validateRequired({target:this,prop:"baseUrl"});this.connectionId=o.attribute("connectionId");this.sessionId=o.attribute("sessionId");var p=o.attribute("operationsTimeout");this.operationsTimeout=!!p?p:2000;this.bind({session:b.Common.Function.parse(o.attribute("onsession"))});if(this.autoConnect){this.openConnection()}};var j={};var m=[];var g={get:"readRequestChannel",set:"writeRequestChannel",del:"writeRequestChannel",incr:"writeRequestChannel"};var h={readRequestChannel:f,readResponseChannel:f,writeRequestChannel:f,writeResponseChannel:f};var i;this.set=function(o,n){k.call(this,{data:o,action:"set",callback:n})};this.del=function(o,n){k.call(this,{data:o,action:"del",callback:n})};this.incr=function(o,n){k.call(this,{data:o,action:"incr",callback:n})};this.get=function(o,n){k.call(this,{data:o,action:"get",callback:n})};var k=function(q){if(this.isReady){var p=b.Common.Util.guidGenerator();j[p]={callback:q.callback,timeout:setTimeout(b.Common.Function.proxy(function(){b.Error.raise({code:b.Error.Codes.STORAGE_OPERATION_TIMEOUT,target:this,info:{opId:p,timeout:this.operationsTimeout,className:"xRTML.StorageManager.KeyValuePairStorage",methodName:"performRemoteDataOperation (internal method, no docs available)"}})},this),this.operationsTimeout)};var n=q.data;n.namespaceExpire=n.namespaceExpire||31556926;n.opId=p;var o=b.MessageManager.create({action:q.action,data:n,senderId:this.internalId});i.send({channel:h[g[q.action]],content:o})}else{m.push(q);b.Console.warn("Storage operation placed in buffer. Will only be called when the Storage is ready.")}};var l=function(q){var o=q.data;var p=o.opId;o.opId=null;delete o.opId;var n={success:q.success,data:q.success?o:null,error:!q.success?q.data.error:null};if(j[p]&&j[p].callback){j[p].callback(n)}clearTimeout(j[p].timeout);j[p]=null;delete j[p]};this.getSession=function(n){b.Common.Request.post({url:this.baseUrl+"/getStorageSession",data:n,crossDomain:true,success:b.Common.Function.proxy(function(q){var p;try{p=b.JSON.parse(q)}catch(o){b.Error.raise({code:b.Error.Codes.JSON_PARSE,target:this,info:{className:"xRTML.StorageManager.KeyValuePairStorage",methodName:"getSession",message:o.message}})}this.sessionId=p.sessionId;this.fire({session:{sessionId:this.sessionId}});if(n.autoConnect){this.openConnection()}},this),error:b.Common.Function.proxy(function(o){b.Error.raise({code:b.Error.Codes.STORAGE_SESSION,target:this,info:{className:"xRTML.StorageManager.KeyValuePairStorage",methodName:"getSession",message:o}})},this)})};this.openConnection=function(){if(this.sessionId){b.Common.Request.post({url:this.baseUrl+"/openStorageConnection",data:{sessionId:this.sessionId},crossDomain:true,success:b.Common.Function.proxy(function(u){var t;try{t=b.JSON.parse(u)}catch(r){b.Error.raise({code:b.Error.Codes.JSON_PARSE,target:this,info:{className:"xRTML.StorageManager.KeyValuePairStorage",methodName:"openConnection",message:r.message}})}h.readRequestChannel=t.channels.readRequestChannel;h.readResponseChannel=t.channels.readResponseChannel;h.writeRequestChannel=t.channels.writeRequestChannel;h.writeResponseChannel=t.channels.writeResponseChannel;if(!!this.connectionId){i=b.ConnectionManager.getById(this.connectionId)}else{var o={appKey:t.appKey,authToken:t.authToken,url:t.url,isCluster:t.isCluster,serverType:t.serverType};i=b.ConnectionManager.create(o)}function p(v){v.bind({xrtmlMessage:b.Common.Function.proxy(function(y){if(y.channel==h.readResponseChannel||y.channel==h.writeResponseChannel){var z=y.message;l.call(this,{success:z.action=="exception"?false:true,data:z.data})}},this)});var w=false;var x=false;v.bind({subscribe:b.Common.Function.proxy(function(y){if(y.channel==h.readResponseChannel){w=true}if(y.channel==h.writeResponseChannel){x=true}if(w&&x){this.isReady=true;for(var z=0,A=m.length;z<A;z++){k.call(this,m[z])}m=[];this.fire({ready:{}})}},this)});v.subscribe({name:h.readResponseChannel});v.subscribe({name:h.writeResponseChannel})}if(i.isConnected()){p.call(this,i)}else{if(i.autoConnect){i.bind({connect:b.Common.Function.proxy(function(v){p.call(this,v.target)},this)})}else{i.bind({connect:b.Common.Function.proxy(function(v){p.call(this,v.target)},this)});function q(v){if(!v.appKey&&!v.authToken){v.appKey=t.appKey;v.authToken=t.authToken}v.connect()}if(i.isCreated()){q.call(this,i)}else{i.bind({create:b.Common.Function.proxy(function(v){q.call(this,v.target)},this)})}}}},this),error:b.Common.Function.proxy(function(o){b.Error.raise({code:b.Error.Codes.REQUEST_FAILURE,target:this,info:{className:"xRTML.StorageManager.KeyValuePairStorage",methodName:"openConnection",message:o}})},this)})}else{i=b.ConnectionManager.getById(this.connectionId);if(!!i){var n={appKey:i.appKey,serverUrl:i.url,isCluster:i.isCluster,serverType:i.serverType,timeToLive:900,authenticate:false,autoConnect:true};this.getSession(n)}else{b.Error.raise({code:b.Error.Codes.STORAGE_CONNECTION_UNAVAILABLE,target:this,info:{connectionId:this.connectionId,className:"xRTML.StorageManager.KeyValuePairStorage",methodName:"openConnection"}})}}}};d.KeyValuePairStorage=c})(b.StorageManager=b.StorageManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(k,m){var j={},l={},d=null,g=function(n){for(var o in j){if(j[o].id===n){return j[o]}}b.Console.log("Tag with id: "+n+" was not found.");return m},f=function(o){if(o.base!="Tag"){var n=f(new l[o.base]());o=n.extend(o)}else{o=d.extend(o)}return o},c=function(n){return b.Common.Object.insensitiveGetter(this,n)},i=[];if(!b.domLoaded()){function h(){var n;for(var o=0;o<i.length;++o){n=i[o];b.Console.debug("TagManager: Creating a "+n.tagObject.name+" tag after the HTML page has been fully loaded.");b.TagManager.create(n.tagObject,n.fn)}i=[];b.Event.unbind(window,{load:h})}b.Event.bind(window,{load:h})}k.register=function(o){var n=o.name;if(n){if(n!="Tag"){if(!l[n]){if(!o.base){o.base="Tag"}l[n]=o.struct;l[n].prototype.base=o.base;l[n].prototype.name=o.name;l[n].prototype.decorators=o.decorators;l[n].prototype["abstract"]=o["abstract"]||false;l[n].prototype.resources=o.resources||{}}}else{d=o.struct}}else{b.Error.raise({code:b.Error.Codes.TAG_INVALID_CONFIG,target:this,info:{message:"Please provide the tag name.",className:"xRTML.TagManager",methodName:"register"}})}};k.create=function(q,o){try{if((q.target||q.template)&&!b.domLoaded()){i.push({tagObject:q,fn:o});b.Console.debug("TagManager: Creating a "+q.name+" tag was postponed until HTML page has been fully loaded.");return}q.attribute=c;if(!l[q.name]){throw b.Error.raise({code:b.Error.Codes.TAG_UNREGISTERED,info:{tagName:q.name,className:"xRTML.TagManager",methodName:"create"}})}var p=new l[q.name]();if(!!p["abstract"]){throw b.Error.raise({code:b.Error.Codes.TAG_ABSTRACT,target:this,info:{tag:p,className:"xRTML.TagManager",methodName:"create"}})}var r=p.base=="Tag"?d.extend(p):f(p);r=new r(q,function(t){j[t.internalId]=t;k.fire({tagCreate:{tag:t}});b.Async.series([function(u){t.fire({postInit:{}});t.bind({dispose:function(w){var x=w.target.internalId;var v=j[x];j[x]=null;delete j[x];k.fire({tagDispose:{tag:w.target}})}});u()},function(u){if(o){o(t);u()}}])})}catch(n){b.Error.raise({code:b.Error.Codes.TAG_NOT_CREATED,target:this,info:{id:q.id,className:"xRTML.TagManager."+q.name,methodName:"init",message:n.message,tagConfig:q}})}};k.getById=function(n){return j[n]||g(n)};k.getClasses=function(){var o=[];for(var n in l){o.push(n)}return o};b.Event.extend(k);b.DomParser.bind({tagsLoad:function(n){var p=n.tags;for(var o=0;o<p.length;++o){k.create(p[o])}}});k.registerResources=function(n){var p=l[n.tag];if(p){for(var o=0;o<n.resources.length;o++){p.prototype.resources[n.resources[o].name.toLowerCase()]=n.resources[o].src}}};k.unregisterResources=function(n){var p=l[n.tag];if(p){for(var o=0;o<n.resources.length;o++){if(p.prototype.resources[n.resources[o].name.toLowerCase()]){p.prototype.resources[n.resources[o].name.toLowerCase()]=null;delete p.prototype.resources[n.resources[o].name.toLowerCase()]}}}}})(b.TagManager=b.TagManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Tag","abstract":true,struct:b.Class.extend(new function(){this.init=function(f){b.Event.extend(this);var g=b.Common.Function.parse;this.bind({preInit:g(f.attribute("onPreInit")),postInit:g(f.attribute("onPostInit")),active:g(f.attribute("onActive")),preProcess:g(f.attribute("onPreProcess")),postProcess:g(f.attribute("onPostProcess")),dispose:g(f.attribute("onDispose"))});this.fire({preInit:{}});this.internalId=b.Common.Util.guidGenerator();this.id=f.attribute("id")||this.internalId;this.connections=f.attribute("connections")||[];this.channelId=f.attribute("channelId");this.triggers=f.attribute("triggers")||[];this.receiveOwnMessages=!!f.attribute("receiveOwnMessages");var d=f.attribute("resources")||[];for(var c=0;c<d.length;c++){this.resources[d[c].name.toLowerCase()]=d[c].src}this.target=(function(){var h=b.Sizzle(f.attribute("target"));if(h.length==0){h.push(document.body)}return h})();this.template=f.attribute("template");this.active=f.attribute("active")?b.Common.Converter.toBoolean(f.attribute("active")):true;this.storage=f.attribute("storage");if(!this.storage){this.storageId=f.attribute("storageId");this.storageKey=f.attribute("storageKey");if(this.storageId||this.storageKey){this.storage={id:this.storageId,key:this.storageKey||""}}}else{if(!this.storage.key){this.storage.key=""}this.storageId=this.storage.id;this.storageKey=this.storage.key}};this.activate=function(c){this.active=b.Common.Converter.toBoolean(c.active);this.fire({active:{value:this.active}})};this.process=function(c){};this.sendMessage=function(c){b.ConnectionManager.sendMessage({connections:c.connectionId?[c.connectionId]:this.connections,channel:c.channel||this.channelId,content:b.MessageManager.create({trigger:c.trigger?[c.trigger]:this.triggers,action:c.action,data:c.data,senderId:this.internalId})})};this.dispose=function(){this.target=null;this.fire({dispose:{}})};this.registerTrigger=function(c){b.MessageBroker.registerTrigger({name:c,tagId:this.internalId});this.triggers.push(c)};this.unregisterTrigger=function(d){b.MessageBroker.unregisterTrigger({name:d,tagId:this.internalId});for(var c=0;c<this.triggers.length;c++){if(this.triggers[c]==d){this.triggers.splice(c,1)}}};this.registerResources=function(c){for(var d=0;d<c.length;d++){this.resources[c[d].name.toLowerCase()]=c[d].src}};this.unregisterResources=function(c){for(var d=0;d<c.length;d++){if(this.resources[c[d].name.toLowerCase()]){this.resources[c[d].name.toLowerCase()]=null;delete this.resources[c[d].name.toLowerCase()]}}}})})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,i){var g={},f=function(p){if(g[p.name]){for(var o in g[p.name]){var n=b.TagManager.getById(o),m=p.message;if(n.active||m.data.action=="activate"){if(n.receiveOwnMessages||!m.senderId||n.internalId!==m.senderId){var l=m.data,k=m.action;b.Async.series([function(q){n.fire({preProcess:{data:l}});q()},function(q){if(k){if(n[k]){n[k].call(n,l);n.fire({process:{data:l,action:k}});return q()}else{b.Console.warn("Tried to perform an action "+k+" which is not defined on a "+n.name+" with id "+n.id+".")}}n.process(l);n.fire({process:{data:l}});q()},function(q){n.fire({postProcess:{data:l}});q()}])}}else{b.Error.raise({code:b.Error.Codes.TAG_INACTIVE,target:n,className:"xRTML.MessageBroker",methodName:"triggerCall (internal method, no docs available)"})}}}else{b.Console.log("Trigger "+p.name+" is not registered with any xRTML Tag.")}},d=function(k){var m=k.tag,n;for(var l=0;l<m.triggers.length;++l){n=m.triggers[l];c.registerTrigger({tagId:m.internalId,name:n})}},j=function(k){var m=k.tag,n;for(var l=0;l<m.triggers.length;++l){n=m.triggers[l];c.unregisterTrigger({tagId:m.internalId,name:n})}},h=function(k){var m=k.message.trigger;if(typeof m=="string"){f({name:m,message:k.message})}else{if(m instanceof Array){for(var l=0;l<m.length;++l){k.message.trigger=m[l];f({name:m[l],message:k.message})}}}};c.registerTrigger=function(k){if(!g[k.name]){g[k.name]={}}g[k.name][k.tagId]=i;c.fire({triggerRegister:{trigger:k}})};c.unregisterTrigger=function(l){var k=g[l.name];if(!k){b.Console.warn("The trigger "+l.name+" is not registered.");return}if(k.hasOwnProperty(l.tagId)){delete g[l.name][l.tagId];if(!b.Common.Object.keys(k).length){delete g[l.name]}c.fire({triggerUnregister:{trigger:l}})}else{b.Console.warn("The tag "+l.tagId+" is not listening to messages with the trigger "+l.name+".")}};b.Event.extend(c);b.TagManager.bind({tagCreate:d,tagDispose:j});b.ConnectionManager.bind({xrtmlMessage:h})})(b.MessageBroker=b.MessageBroker||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(c,d){c.isValid=function(h){try{if(typeof h==="string"){var g=h.substring(h.indexOf('"'),h.indexOf('"',h.indexOf('"')+1)+1);if('"xrtml"'!=b.Common.String.trim(g)){return false}b.JSON.parse(h);return true}if((typeof h==="object")&&h.xrtml){return true}return false}catch(f){b.Error.raise({code:b.Error.Codes.INVALID_MESSAGE,target:this,message:f.message,info:{className:"xRTML.MessageManager",methodName:"isValid"}})}};c.toJson=function(g){if(typeof g==="string"&&c.isValid(g)){var f=b.JSON.parse(g).xrtml;var h={xrtml:{senderId:f.s,trigger:f.t,action:f.a,data:f.d}};return h}return g};c.stringify=function(f){var g={xrtml:{s:f.senderId,t:f.trigger,a:f.action,d:f.data&&typeof f.data!="object"?b.JSON.parse(f.data):f.data}};return b.JSON.stringify(g)};c.create=function(f){f.data=f.data&&typeof f.data!="object"?b.JSON.parse(f.data):f.data;f.stringify=function(){return c.stringify(this)};return f}})(b.MessageManager=b.MessageManager||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(f,g){var d=function(j,k){if(b.Config.remoteTrace){var h=null;try{h=b.JSON.stringify(k)}catch(i){}var l=b.MessageManager.create({data:{message:j,content:h}});b.ConnectionManager.sendMessage(b.TraceMonitor.channelId,l)}};f.channelId="trace";b.Console.bind({error:function(h){d("Error",h.error)}});b.ConnectionManager.bind({connectionCreate:function(i){var h=i.connection;d("Connection found: \n AppKey: "+h.appKey+" \n AuthToken: "+h.authToken+" \n Url: "+h.url,h);h.bind({create:function(j){var k="Connection "+j.target.id+" created. "+(j.target.autoConnect?"Connecting...":"Waiting for explicit connect...");b.Console.debug(k);d(k,j.target)},connect:function(j){var k="Connection "+j.target.id+" established. Using "+j.target.getProtocol()+" protocol.";b.Console.debug(k);d(k,j.target)},disconnect:function(j){var k="Connection "+j.target.id+" closed.";b.Console.debug(k);d(k,j.target)},subscribe:function(j){var k="Connection "+j.target.id+": Channel "+j.channel+" subscribed.";b.Console.debug(k);d(k,j.target)},unsubscribe:function(j){var k="Connection "+j.target.id+": Channel "+j.channel+" unsubscribed.";b.Console.debug(k);d(k,j.target)},exception:function(j){var k="Connection "+j.target.id+" threw an exception: "+j.event;b.Console.debug(k);d(k,j.target)},reconnect:function(j){var k="Connection "+j.target.id+" is restored. Using "+j.target.getProtocol()+" protocol.";b.Console.debug(k);d(k,j.target)},reconnecting:function(j){var k="Connection "+j.target.id+" was lost. ";if(j.target.connectionAttemptsCounter>=j.target.connectAttempts){k+="Maximum number of attempts reached: "+j.target.connectAttempts+" Stop trying to reconnect."}else{k+="Trying to reconnect. Attempt "+j.target.connectionAttemptsCounter+" out of "+j.target.connectAttempts}b.Console.debug(k);d(k,j.target)},message:function(j){var l="Connection "+j.target.id+": Message received from channel "+j.channel,m;try{m=b.JSON.parse(j.message)}catch(k){m=j.message}b.Console.debug(l);b.Console.debug(m);d(m,j.target)},xrtmlMessage:function(j){var k="Connection "+j.target.id+": xRTML Message received from channel "+j.channel;b.Console.debug(k);b.Console.debug(j.message);d(j.message,j.target)}})}});var c=function(h){var i="Tag "+h.target.id+": "+h.type+" message";b.Console.debug(i);b.Console.debug(h.data);d(i,h.data)};b.TagManager.bind({tagCreate:function(h){var i=h.tag;b.Console.debug("Tag of type "+i.name+" created with id "+(i.id||i.internalId));b.Console.debug(i);i.bind({init:function(j){b.Console.debug("")},load:function(j){b.Console.debug("")},active:function(j){b.Console.debug("")},process:c,preProcess:c,postProcess:c})},tagDispose:function(h){var j=h.tag,i="Tag of type "+h.name+" with id "+(j.id||j.internalId)+" disposed.";b.Console.debug(i);d(i,h.tag)}});b.MessageBroker.bind({triggerRegister:function(h){var i="Tag "+h.trigger.tagId+" registered trigger: "+h.trigger.name;b.Console.debug(i);d(i,h.target)},triggerUnregister:function(h){var i="Tag "+h.trigger.tagId+" unregistered trigger: "+h.trigger.name;b.Console.debug(i);d(i,h.target)}});b.DomParser.bind({configLoad:function(h){b.Console.debug("DOM Parser: the following connections were read from DOM: ");b.Console.debug(h.config.connections);b.Console.debug("DOM Parser: the following storages were read from DOM: ");b.Console.debug(h.config.storages)},tagsLoad:function(h){b.Console.debug("DOM Parser: the following tags were read from DOM: ");b.Console.debug(h.tags)}})})(b.TraceMonitor=b.TraceMonitor||{})})(window.xRTML=window.xRTML||{});(function(d,c){var b=function(){d.isReady=true;d.fire({ready:{}})};(typeof loadOrtcFactory=="undefined")?d.Config.ortcLibrary(((document.location.protocol=="file:")?"http:":document.location.protocol)+"//dfdbz2tdq3k01.cloudfront.net/js/2.1.0/ortc.js",b):b();var a=function(){d.DomParser.read();if(d.isReady){d.isLoaded=true;d.fire({load:{}})}else{d.ready(function(){d.isLoaded=true;d.fire({load:{}})})}};d.domLoaded()?a():d.Event.bind(window,{load:a})})(window.xRTML=window.xRTML||{});(function(b,a){(function(f,g){var d=(typeof window.jQuery!="undefined"&&parseFloat(window.jQuery().jquery)<1.3)?g:window.jQuery;var c=g;(function(m,i,k,j,l){var h=true;!function(n){n(c={})}(function(v){var u=typeof v!=="undefined"?v:{};u.exportSymbol=function(E,F){var H=E.split(".");var G=u;for(var D=0;D<H.length-1;D++){G=G[H[D]]}G[H[H.length-1]]=F};u.exportProperty=function(E,F,D){E[F]=D};u.version="2.2.1";u.exportSymbol("version",u.version);u.utils=new (function(){var P=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;var M={},O={};var L=/Firefox\/2/i.test(k.userAgent)?"KeyboardEvent":"UIEvents";M[L]=["keyup","keydown","keypress"];M.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"];for(var E in M){var N=M[E];if(N.length){for(var F=0,K=N.length;F<K;F++){O[N[F]]=E}}}var D={propertychange:true};var G=(function(){var S=3,Q=i.createElement("div"),R=Q.getElementsByTagName("i");while(Q.innerHTML="<!--[if gt IE "+(++S)+"]><i></i><![endif]-->",R[0]){}return S>4?S:l}());var I=G===6,J=G===7;function H(Q,R){if((u.utils.tagNameLower(Q)!=="input")||!Q.type){return false}if(R.toLowerCase()!="click"){return false}var S=Q.type;return(S=="checkbox")||(S=="radio")}return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(R,Q){for(var S=0,T=R.length;S<T;S++){Q(R[S])}},arrayIndexOf:function(Q,S){if(typeof Array.prototype.indexOf=="function"){return Array.prototype.indexOf.call(Q,S)}for(var R=0,T=Q.length;R<T;R++){if(Q[R]===S){return R}}return -1},arrayFirst:function(Q,T,U){for(var R=0,S=Q.length;R<S;R++){if(T.call(U,Q[R])){return Q[R]}}return null},arrayRemoveItem:function(Q,S){var R=u.utils.arrayIndexOf(Q,S);if(R>=0){Q.splice(R,1)}},arrayGetDistinctValues:function(Q){Q=Q||[];var T=[];for(var R=0,S=Q.length;R<S;R++){if(u.utils.arrayIndexOf(T,Q[R])<0){T.push(Q[R])}}return T},arrayMap:function(Q,T){Q=Q||[];var U=[];for(var R=0,S=Q.length;R<S;R++){U.push(T(Q[R]))}return U},arrayFilter:function(Q,T){Q=Q||[];var U=[];for(var R=0,S=Q.length;R<S;R++){if(T(Q[R])){U.push(Q[R])}}return U},arrayPushAll:function(Q,T){if(T instanceof Array){Q.push.apply(Q,T)}else{for(var R=0,S=T.length;R<S;R++){Q.push(T[R])}}return Q},extend:function(S,R){if(R){for(var Q in R){if(R.hasOwnProperty(Q)){S[Q]=R[Q]}}}return S},emptyDomNode:function(Q){while(Q.firstChild){u.removeNode(Q.firstChild)}},moveCleanedNodesToContainerElement:function(T){var U=u.utils.makeArray(T);var Q=i.createElement("div");for(var R=0,S=U.length;R<S;R++){Q.appendChild(u.cleanNode(U[R]))}return Q},cloneNodes:function(U,V){for(var R=0,S=U.length,T=[];R<S;R++){var Q=U[R].cloneNode(true);T.push(V?u.cleanNode(Q):Q)}return T},setDomNodeChildren:function(R,Q){u.utils.emptyDomNode(R);if(Q){for(var S=0,T=Q.length;S<T;S++){R.appendChild(Q[S])}}},replaceDomNodes:function(V,T){var U=V.nodeType?[V]:V;if(U.length>0){var R=U[0];var W=R.parentNode;for(var Q=0,S=T.length;Q<S;Q++){W.insertBefore(T[Q],R)}for(var Q=0,S=U.length;Q<S;Q++){u.removeNode(U[Q])}}},setOptionNodeSelectionState:function(R,Q){if(G<7){R.setAttribute("selected",Q)}else{R.selected=Q}},stringTrim:function(Q){return(Q||"").replace(P,"")},stringTokenize:function(U,Q){var T=[];var V=(U||"").split(Q);for(var R=0,S=V.length;R<S;R++){var W=u.utils.stringTrim(V[R]);if(W!==""){T.push(W)}}return T},stringStartsWith:function(R,Q){R=R||"";if(Q.length>R.length){return false}return R.substring(0,Q.length)===Q},domNodeIsContainedBy:function(R,Q){if(Q.compareDocumentPosition){return(Q.compareDocumentPosition(R)&16)==16}while(R!=null){if(R==Q){return true}R=R.parentNode}return false},domNodeIsAttachedToDocument:function(Q){return u.utils.domNodeIsContainedBy(Q,Q.ownerDocument)},tagNameLower:function(Q){return Q&&Q.tagName&&Q.tagName.toLowerCase()},registerEventHandler:function(Q,R,S){var T=G&&D[R];if(!T&&typeof j!="undefined"){if(H(Q,R)){var U=S;S=function(V,W){var X=this.checked;if(W){this.checked=W.checkedStateBeforeEvent!==true}U.call(this,V);this.checked=X}}j(Q)["bind"](R,S)}else{if(!T&&typeof Q.addEventListener=="function"){Q.addEventListener(R,S,false)}else{if(typeof Q.attachEvent!="undefined"){Q.attachEvent("on"+R,function(V){S.call(Q,V)})}else{throw new Error("Browser doesn't support addEventListener or attachEvent")}}}},triggerEvent:function(Q,U){if(!(Q&&Q.nodeType)){throw new Error("element must be a DOM node when calling triggerEvent")}if(typeof j!="undefined"){var T=[];if(H(Q,U)){T.push({checkedStateBeforeEvent:Q.checked})}j(Q)["trigger"](U,T)}else{if(typeof i.createEvent=="function"){if(typeof Q.dispatchEvent=="function"){var S=O[U]||"HTMLEvents";var R=i.createEvent(S);R.initEvent(U,true,true,m,0,0,0,0,0,false,false,false,false,0,Q);Q.dispatchEvent(R)}else{throw new Error("The supplied element doesn't support dispatchEvent")}}else{if(typeof Q.fireEvent!="undefined"){if(H(Q,U)){Q.checked=Q.checked!==true}Q.fireEvent("on"+U)}else{throw new Error("Browser doesn't support triggering events")}}}},unwrapObservable:function(Q){return u.isObservable(Q)?Q():Q},peekObservable:function(Q){return u.isObservable(Q)?Q.peek():Q},toggleDomNodeCssClass:function(T,Q,U){if(Q){var R=/[\w-]+/g,S=T.className.match(R)||[];u.utils.arrayForEach(Q.match(R),function(V){var W=u.utils.arrayIndexOf(S,V);if(W>=0){if(!U){S.splice(W,1)}}else{if(U){S.push(V)}}});T.className=S.join(" ")}},setTextContent:function(Q,S){var T=u.utils.unwrapObservable(S);if((T===null)||(T===l)){T=""}if(Q.nodeType===3){Q.data=T}else{var R=u.virtualElements.firstChild(Q);if(!R||R.nodeType!=3||u.virtualElements.nextSibling(R)){u.virtualElements.setDomNodeChildren(Q,[i.createTextNode(T)])}else{R.data=T}u.utils.forceRefresh(Q)}},setElementName:function(R,S){R.name=S;if(G<=7){try{R.mergeAttributes(i.createElement("<input name='"+R.name+"'/>"),false)}catch(Q){}}},forceRefresh:function(R){if(G>=9){var Q=R.nodeType==1?R:R.parentNode;if(Q.style){Q.style.zoom=Q.style.zoom}}},ensureSelectElementIsRenderedCorrectly:function(R){if(G>=9){var Q=R.style.width;R.style.width=0;R.style.width=Q}},range:function(S,R){S=u.utils.unwrapObservable(S);R=u.utils.unwrapObservable(R);var T=[];for(var Q=S;Q<=R;Q++){T.push(Q)}return T},makeArray:function(Q){var T=[];for(var R=0,S=Q.length;R<S;R++){T.push(Q[R])}return T},isIe6:I,isIe7:J,ieVersion:G,getFormFields:function(S,Q){var R=u.utils.makeArray(S.getElementsByTagName("input")).concat(u.utils.makeArray(S.getElementsByTagName("textarea")));var U=(typeof Q=="string")?function(W){return W.name===Q}:function(W){return Q.test(W.name)};var V=[];for(var T=R.length-1;T>=0;T--){if(U(R[T])){V.push(R[T])}}return V},parseJson:function(Q){if(typeof Q=="string"){Q=u.utils.stringTrim(Q);if(Q){if(m.JSON&&m.JSON.parse){return m.JSON.parse(Q)}return(new Function("return "+Q))()}}return null},stringifyJson:function(Q,R,S){if((typeof JSON=="undefined")||(typeof JSON.stringify=="undefined")){throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js")}return JSON.stringify(u.utils.unwrapObservable(Q),R,S)},postJson:function(ac,Q,Y){Y=Y||{};var aa=Y.params||{};var U=Y.includeFields||this.fieldsIncludedWithJsonPost;var ab=ac;if((typeof ac=="object")&&(u.utils.tagNameLower(ac)==="form")){var Z=ac;ab=Z.action;for(var T=U.length-1;T>=0;T--){var R=u.utils.getFormFields(Z,U[T]);for(var W=R.length-1;W>=0;W--){aa[R[W].name]=R[W].value}}}Q=u.utils.unwrapObservable(Q);var S=i.createElement("form");S.style.display="none";S.action=ab;S.method="post";for(var X in Q){var V=i.createElement("input");V.name=X;V.value=u.utils.stringifyJson(u.utils.unwrapObservable(Q[X]));S.appendChild(V)}for(var X in aa){var V=i.createElement("input");V.name=X;V.value=aa[X];S.appendChild(V)}i.body.appendChild(S);Y.submitter?Y.submitter(S):S.submit();setTimeout(function(){S.parentNode.removeChild(S)},0)}}})();u.exportSymbol("utils",u.utils);u.exportSymbol("utils.arrayForEach",u.utils.arrayForEach);u.exportSymbol("utils.arrayFirst",u.utils.arrayFirst);u.exportSymbol("utils.arrayFilter",u.utils.arrayFilter);u.exportSymbol("utils.arrayGetDistinctValues",u.utils.arrayGetDistinctValues);u.exportSymbol("utils.arrayIndexOf",u.utils.arrayIndexOf);u.exportSymbol("utils.arrayMap",u.utils.arrayMap);u.exportSymbol("utils.arrayPushAll",u.utils.arrayPushAll);u.exportSymbol("utils.arrayRemoveItem",u.utils.arrayRemoveItem);u.exportSymbol("utils.extend",u.utils.extend);u.exportSymbol("utils.fieldsIncludedWithJsonPost",u.utils.fieldsIncludedWithJsonPost);u.exportSymbol("utils.getFormFields",u.utils.getFormFields);u.exportSymbol("utils.peekObservable",u.utils.peekObservable);u.exportSymbol("utils.postJson",u.utils.postJson);u.exportSymbol("utils.parseJson",u.utils.parseJson);u.exportSymbol("utils.registerEventHandler",u.utils.registerEventHandler);u.exportSymbol("utils.stringifyJson",u.utils.stringifyJson);u.exportSymbol("utils.range",u.utils.range);u.exportSymbol("utils.toggleDomNodeCssClass",u.utils.toggleDomNodeCssClass);u.exportSymbol("utils.triggerEvent",u.utils.triggerEvent);u.exportSymbol("utils.unwrapObservable",u.utils.unwrapObservable);if(!Function.prototype.bind){Function.prototype.bind=function(E){var F=this,D=Array.prototype.slice.call(arguments),E=D.shift();return function(){return F.apply(E,D.concat(Array.prototype.slice.call(arguments)))}}}u.utils.domData=new (function(){var F=0;var E="__ko__"+(new Date).getTime();var D={};return{get:function(I,H){var G=u.utils.domData.getAll(I,false);return G===l?l:G[H]},set:function(I,H,J){if(J===l){if(u.utils.domData.getAll(I,false)===l){return}}var G=u.utils.domData.getAll(I,true);G[H]=J},getAll:function(J,G){var H=J[E];var I=H&&(H!=="null")&&D[H];if(!I){if(!G){return l}H=J[E]="ko"+F++;D[H]={}}return D[H]},clear:function(H){var G=H[E];if(G){delete D[G];H[E]=null;return true}return false}}})();u.exportSymbol("utils.domData",u.utils.domData);u.exportSymbol("utils.domData.clear",u.utils.domData.clear);u.utils.domNodeDisposal=new (function(){var I="__ko_domNodeDisposal__"+(new Date).getTime();var D={1:true,8:true,9:true};var E={1:true,9:true};function J(M,L){var K=u.utils.domData.get(M,I);if((K===l)&&L){K=[];u.utils.domData.set(M,I,K)}return K}function H(K){u.utils.domData.set(K,I,l)}function G(M){var K=J(M,false);if(K){K=K.slice(0);for(var L=0;L<K.length;L++){K[L](M)}}u.utils.domData.clear(M);if((typeof j=="function")&&(typeof j.cleanData=="function")){j.cleanData([M])}if(E[M.nodeType]){F(M)}}function F(M){var K,L=M.firstChild;while(K=L){L=K.nextSibling;if(K.nodeType===8){G(K)}}}return{addDisposeCallback:function(L,K){if(typeof K!="function"){throw new Error("Callback must be a function")}J(L,true).push(K)},removeDisposeCallback:function(M,K){var L=J(M,false);if(L){u.utils.arrayRemoveItem(L,K);if(L.length==0){H(M)}}},cleanNode:function(N){if(D[N.nodeType]){G(N);if(E[N.nodeType]){var K=[];u.utils.arrayPushAll(K,N.getElementsByTagName("*"));for(var L=0,M=K.length;L<M;L++){G(K[L])}}}return N},removeNode:function(K){u.cleanNode(K);if(K.parentNode){K.parentNode.removeChild(K)}}}})();u.cleanNode=u.utils.domNodeDisposal.cleanNode;u.removeNode=u.utils.domNodeDisposal.removeNode;u.exportSymbol("cleanNode",u.cleanNode);u.exportSymbol("removeNode",u.removeNode);u.exportSymbol("utils.domNodeDisposal",u.utils.domNodeDisposal);u.exportSymbol("utils.domNodeDisposal.addDisposeCallback",u.utils.domNodeDisposal.addDisposeCallback);u.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",u.utils.domNodeDisposal.removeDisposeCallback);(function(){var E=/^(\s*)<!--(.*?)-->/;function F(H){var J=u.utils.stringTrim(H).toLowerCase(),G=i.createElement("div");var K=J.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!J.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!J.indexOf("<td")||!J.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""];var I="ignored<div>"+K[1]+H+K[2]+"</div>";if(typeof m.innerShiv=="function"){G.appendChild(m.innerShiv(I))}else{G.innerHTML=I}while(K[0]--){G=G.lastChild}return u.utils.makeArray(G.lastChild.childNodes)}function D(I){if(j.parseHTML){return j.parseHTML(I)}else{var H=j.clean([I]);if(H&&H[0]){var G=H[0];while(G.parentNode&&G.parentNode.nodeType!==11){G=G.parentNode}if(G.parentNode){G.parentNode.removeChild(G)}}return H}}u.utils.parseHtmlFragment=function(G){return typeof j!="undefined"?D(G):F(G)};u.utils.setHtml=function(I,G){u.utils.emptyDomNode(I);G=u.utils.unwrapObservable(G);if((G!==null)&&(G!==l)){if(typeof G!="string"){G=G.toString()}if(typeof j!="undefined"){j(I)["html"](G)}else{var J=u.utils.parseHtmlFragment(G);for(var H=0;H<J.length;H++){I.appendChild(J[H])}}}}})();u.exportSymbol("utils.parseHtmlFragment",u.utils.parseHtmlFragment);u.exportSymbol("utils.setHtml",u.utils.setHtml);u.memoization=(function(){var F={};function G(){return(((1+Math.random())*4294967296)|0).toString(16).substring(1)}function E(){return G()+G()}function D(M,H){if(!M){return}if(M.nodeType==8){var L=u.memoization.parseMemoText(M.nodeValue);if(L!=null){H.push({domNode:M,memoId:L})}}else{if(M.nodeType==1){for(var J=0,I=M.childNodes,K=I.length;J<K;J++){D(I[J],H)}}}}return{memoize:function(H){if(typeof H!="function"){throw new Error("You can only pass a function to ko.memoization.memoize()")}var I=E();F[I]=H;return"<!--[ko_memo:"+I+"]-->"},unmemoize:function(J,I){var H=F[J];if(H===l){throw new Error("Couldn't find any memo with ID "+J+". Perhaps it's already been unmemoized.")}try{H.apply(null,I||[]);return true}finally{delete F[J]}},unmemoizeDomNodeAndDescendants:function(I,J){var M=[];D(I,M);for(var K=0,L=M.length;K<L;K++){var N=M[K].domNode;var H=[N];if(J){u.utils.arrayPushAll(H,J)}u.memoization.unmemoize(M[K].memoId,H);N.nodeValue="";if(N.parentNode){N.parentNode.removeChild(N)}}},parseMemoText:function(I){var H=I.match(/^\[ko_memo\:(.*?)\]$/);return H?H[1]:null}}})();u.exportSymbol("memoization",u.memoization);u.exportSymbol("memoization.memoize",u.memoization.memoize);u.exportSymbol("memoization.unmemoize",u.memoization.unmemoize);u.exportSymbol("memoization.parseMemoText",u.memoization.parseMemoText);u.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",u.memoization.unmemoizeDomNodeAndDescendants);u.extenders={throttle:function(D,E){D.throttleEvaluation=E;var F=null;return u.dependentObservable({read:D,write:function(G){clearTimeout(F);F=setTimeout(function(){D(G)},E)}})},notify:function(E,D){E.equalityComparer=D=="always"?function(){return false}:u.observable.fn["equalityComparer"];return E}};function n(F){var G=this;if(F){for(var E in F){var D=u.extenders[E];if(typeof D=="function"){G=D(G,F[E])}}}return G}u.exportSymbol("extenders",u.extenders);u.subscription=function(F,D,E){this.target=F;this.callback=D;this.disposeCallback=E;u.exportProperty(this,"dispose",this.dispose)};u.subscription.prototype.dispose=function(){this.isDisposed=true;this.disposeCallback()};u.subscribable=function(){this._subscriptions={};u.utils.extend(this,u.subscribable.fn);u.exportProperty(this,"subscribe",this.subscribe);u.exportProperty(this,"extend",this.extend);u.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var q="change";u.subscribable.fn={subscribe:function(E,F,G){G=G||q;var D=F?E.bind(F):E;var H=new u.subscription(this,D,function(){u.utils.arrayRemoveItem(this._subscriptions[G],H)}.bind(this));if(!this._subscriptions[G]){this._subscriptions[G]=[]}this._subscriptions[G].push(H);return H},notifySubscribers:function(E,D){D=D||q;if(this._subscriptions[D]){u.dependencyDetection.ignore(function(){u.utils.arrayForEach(this._subscriptions[D].slice(0),function(F){if(F&&(F.isDisposed!==true)){F.callback(E)}})},this)}},getSubscriptionsCount:function(){var E=0;for(var D in this._subscriptions){if(this._subscriptions.hasOwnProperty(D)){E+=this._subscriptions[D].length}}return E},extend:n};u.isSubscribable=function(D){return typeof D.subscribe=="function"&&typeof D.notifySubscribers=="function"};u.exportSymbol("subscribable",u.subscribable);u.exportSymbol("isSubscribable",u.isSubscribable);u.dependencyDetection=(function(){var D=[];return{begin:function(E){D.push({callback:E,distinctDependencies:[]})},end:function(){D.pop()},registerDependency:function(E){if(!u.isSubscribable(E)){throw new Error("Only subscribable things can act as dependencies")}if(D.length>0){var F=D[D.length-1];if(!F||u.utils.arrayIndexOf(F.distinctDependencies,E)>=0){return}F.distinctDependencies.push(E);F.callback(E)}},ignore:function(E,G,F){try{D.push(null);return E.apply(G,F||[])}finally{D.pop()}}}})();var y={"undefined":true,"boolean":true,number:true,string:true};u.observable=function(E){var D=E;function F(){if(arguments.length>0){if((!F.equalityComparer)||!F.equalityComparer(D,arguments[0])){F.valueWillMutate();D=arguments[0];if(h){F._latestValue=D}F.valueHasMutated()}return this}else{u.dependencyDetection.registerDependency(F);return D}}if(h){F._latestValue=D}u.subscribable.call(F);F.peek=function(){return D};F.valueHasMutated=function(){F.notifySubscribers(D)};F.valueWillMutate=function(){F.notifySubscribers(D,"beforeChange")};u.utils.extend(F,u.observable.fn);u.exportProperty(F,"peek",F.peek);u.exportProperty(F,"valueHasMutated",F.valueHasMutated);u.exportProperty(F,"valueWillMutate",F.valueWillMutate);return F};u.observable.fn={equalityComparer:function B(D,E){var F=(D===null)||(typeof(D) in y);return F?(D===E):false}};var A=u.observable.protoProperty="__ko_proto__";u.observable.fn[A]=u.observable;u.hasPrototype=function(D,E){if((D===null)||(D===l)||(D[A]===l)){return false}if(D[A]===E){return true}return u.hasPrototype(D[A],E)};u.isObservable=function(D){return u.hasPrototype(D,u.observable)};u.isWriteableObservable=function(D){if((typeof D=="function")&&D[A]===u.observable){return true}if((typeof D=="function")&&(D[A]===u.dependentObservable)&&(D.hasWriteFunction)){return true}return false};u.exportSymbol("observable",u.observable);u.exportSymbol("isObservable",u.isObservable);u.exportSymbol("isWriteableObservable",u.isWriteableObservable);u.observableArray=function(D){if(arguments.length==0){D=[]}if((D!==null)&&(D!==l)&&!("length" in D)){throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")}var E=u.observable(D);u.utils.extend(E,u.observableArray.fn);return E};u.observableArray.fn={remove:function(I){var G=this.peek();var F=[];var E=typeof I=="function"?I:function(J){return J===I};for(var D=0;D<G.length;D++){var H=G[D];if(E(H)){if(F.length===0){this.valueWillMutate()}F.push(H);G.splice(D,1);D--}}if(F.length){this.valueHasMutated()}return F},removeAll:function(E){if(E===l){var F=this.peek();var D=F.slice(0);this.valueWillMutate();F.splice(0,F.length);this.valueHasMutated();return D}if(!E){return[]}return this["remove"](function(G){return u.utils.arrayIndexOf(E,G)>=0})},destroy:function(H){var F=this.peek();var E=typeof H=="function"?H:function(I){return I===H};this.valueWillMutate();for(var D=F.length-1;D>=0;D--){var G=F[D];if(E(G)){F[D]["_destroy"]=true}}this.valueHasMutated()},destroyAll:function(D){if(D===l){return this["destroy"](function(){return true})}if(!D){return[]}return this["destroy"](function(E){return u.utils.arrayIndexOf(D,E)>=0})},indexOf:function(D){var E=this();return u.utils.arrayIndexOf(E,D)},replace:function(F,E){var D=this["indexOf"](F);if(D>=0){this.valueWillMutate();this.peek()[D]=E;this.valueHasMutated()}}};u.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(D){u.observableArray.fn[D]=function(){var F=this.peek();this.valueWillMutate();var E=F[D].apply(F,arguments);this.valueHasMutated();return E}});u.utils.arrayForEach(["slice"],function(D){u.observableArray.fn[D]=function(){var E=this();return E[D].apply(E,arguments)}});u.exportSymbol("observableArray",u.observableArray);u.dependentObservable=function(Q,R,U){var F,D=false,E=false,W=Q;if(W&&typeof W=="object"){U=W;W=U.read}else{U=U||{};if(!W){W=U.read}}if(typeof W!="function"){throw new Error("Pass a function that returns the value of the ko.computed")}function H(Y){G.push(Y.subscribe(O))}function K(){u.utils.arrayForEach(G,function(Y){Y.dispose()});G=[]}function O(){var Y=I.throttleEvaluation;if(Y&&Y>=0){clearTimeout(P);P=setTimeout(N,Y)}else{N()}}function N(){if(E){return}if(D&&L()){J();return}E=true;try{var Y=u.utils.arrayMap(G,function(ab){return ab.target});u.dependencyDetection.begin(function(ac){var ab;if((ab=u.utils.arrayIndexOf(Y,ac))>=0){Y[ab]=l}else{H(ac)}});var aa=W.call(R);for(var Z=Y.length-1;Z>=0;Z--){if(Y[Z]){G.splice(Z,1)[0].dispose()}}D=true;I.notifySubscribers(F,"beforeChange");F=aa;if(h){I._latestValue=F}}finally{u.dependencyDetection.end()}I.notifySubscribers(F);E=false;if(!G.length){J()}}function I(){if(arguments.length>0){if(typeof X==="function"){X.apply(R,arguments)}else{throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")}return this}else{if(!D){N()}u.dependencyDetection.registerDependency(I);return F}}function V(){if(!D){N()}return F}function T(){return !D||G.length>0}var X=U.write,M=U.disposeWhenNodeIsRemoved||U.disposeWhenNodeIsRemoved||null,L=U.disposeWhen||U.disposeWhen||function(){return false},J=K,G=[],P=null;if(!R){R=U.owner}I.peek=V;I.getDependenciesCount=function(){return G.length};I.hasWriteFunction=typeof U.write==="function";I.dispose=function(){J()};I.isActive=T;u.subscribable.call(I);u.utils.extend(I,u.dependentObservable.fn);u.exportProperty(I,"peek",I.peek);u.exportProperty(I,"dispose",I.dispose);u.exportProperty(I,"isActive",I.isActive);u.exportProperty(I,"getDependenciesCount",I.getDependenciesCount);if(U.deferEvaluation!==true){N()}if(M&&T()){J=function(){u.utils.domNodeDisposal.removeDisposeCallback(M,arguments.callee);K()};u.utils.domNodeDisposal.addDisposeCallback(M,J);var S=L;L=function(){return !u.utils.domNodeIsAttachedToDocument(M)||S()}}return I};u.isComputed=function(D){return u.hasPrototype(D,u.dependentObservable)};var z=u.observable.protoProperty;u.dependentObservable[z]=u.observable;u.dependentObservable.fn={};u.dependentObservable.fn[z]=u.dependentObservable;u.exportSymbol("dependentObservable",u.dependentObservable);u.exportSymbol("computed",u.dependentObservable);u.exportSymbol("isComputed",u.isComputed);(function(){var E=10;u.toJS=function(H){if(arguments.length==0){throw new Error("When calling ko.toJS, pass the object you want to convert.")}return D(H,function(J){for(var I=0;u.isObservable(J)&&(I<E);I++){J=J()}return J})};u.toJSON=function(J,I,K){var H=u.toJS(J);return u.utils.stringifyJson(H,I,K)};function D(K,I,L){L=L||new F();K=I(K);var H=(typeof K=="object")&&(K!==null)&&(K!==l)&&(!(K instanceof Date));if(!H){return K}var J=K instanceof Array?[]:{};L.save(K,J);G(K,function(M){var O=I(K[M]);switch(typeof O){case"boolean":case"number":case"string":case"function":J[M]=O;break;case"object":case"undefined":var N=L.get(O);J[M]=(N!==l)?N:D(O,I,L);break}});return J}function G(J,K){if(J instanceof Array){for(var H=0;H<J.length;H++){K(H)}if(typeof J.toJSON=="function"){K("toJSON")}}else{for(var I in J){K(I)}}}function F(){var H=[];var I=[];this.save=function(K,L){var J=u.utils.arrayIndexOf(H,K);if(J>=0){I[J]=L}else{H.push(K);I.push(L)}};this.get=function(K){var J=u.utils.arrayIndexOf(H,K);return(J>=0)?I[J]:l}}})();u.exportSymbol("toJS",u.toJS);u.exportSymbol("toJSON",u.toJSON);(function(){var D="__ko__hasDomDataOptionValue__";u.selectExtensions={readValue:function(E){switch(u.utils.tagNameLower(E)){case"option":if(E[D]===true){return u.utils.domData.get(E,u.bindingHandlers.options.optionValueDomDataKey)}return u.utils.ieVersion<=7?(E.getAttributeNode("value").specified?E.value:E.text):E.value;case"select":return E.selectedIndex>=0?u.selectExtensions.readValue(E.options[E.selectedIndex]):l;default:return E.value}},writeValue:function(E,G){switch(u.utils.tagNameLower(E)){case"option":switch(typeof G){case"string":u.utils.domData.set(E,u.bindingHandlers.options.optionValueDomDataKey,l);if(D in E){delete E[D]}E.value=G;break;default:u.utils.domData.set(E,u.bindingHandlers.options.optionValueDomDataKey,G);E[D]=true;E.value=typeof G==="number"?G:"";break}break;case"select":for(var F=E.options.length-1;F>=0;F--){if(u.selectExtensions.readValue(E.options[F])==G){E.selectedIndex=F;break}}break;default:if((G===null)||(G===l)){G=""}E.value=G;break}}}})();u.exportSymbol("selectExtensions",u.selectExtensions);u.exportSymbol("selectExtensions.readValue",u.selectExtensions.readValue);u.exportSymbol("selectExtensions.writeValue",u.selectExtensions.writeValue);u.expressionRewriting=(function(){var H=/\@ko_token_(\d+)\@/g;var G=["true","false"];var F=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;function I(K,L){var J=null;while(K!=J){J=K;K=K.replace(H,function(M,N){return L[N]})}return K}function E(J){if(u.utils.arrayIndexOf(G,u.utils.stringTrim(J).toLowerCase())>=0){return false}var K=J.match(F);return K===null?false:K[1]?("Object("+K[1]+")"+K[2]):J}function D(J){var K=u.utils.stringTrim(J);switch(K.length&&K.charAt(0)){case"'":case'"':return J;default:return"'"+K+"'"}}return{bindingRewriteValidators:[],parseObjectLiteral:function(P){var U=u.utils.stringTrim(P);if(U.length<3){return[]}if(U.charAt(0)==="{"){U=U.substring(1,U.length-1)}var Y=[];var Z=null,X;for(var R=0;R<U.length;R++){var J=U.charAt(R);if(Z===null){switch(J){case'"':case"'":case"/":Z=R;X=J;break}}else{if((J==X)&&(U.charAt(R-1)!=="\\")){var V=U.substring(Z,R+1);Y.push(V);var S="@ko_token_"+(Y.length-1)+"@";U=U.substring(0,Z)+S+U.substring(R+1);R-=(V.length-S.length);Z=null}}}Z=null;X=null;var W=0,aa=null;for(var R=0;R<U.length;R++){var J=U.charAt(R);if(Z===null){switch(J){case"{":Z=R;aa=J;X="}";break;case"(":Z=R;aa=J;X=")";break;case"[":Z=R;aa=J;X="]";break}}if(J===aa){W++}else{if(J===X){W--;if(W===0){var V=U.substring(Z,R+1);Y.push(V);var S="@ko_token_"+(Y.length-1)+"@";U=U.substring(0,Z)+S+U.substring(R+1);R-=(V.length-S.length);Z=null}}}}var T=[];var O=U.split(",");for(var L=0,M=O.length;L<M;L++){var Q=O[L];var K=Q.indexOf(":");if((K>0)&&(K<Q.length-1)){var N=Q.substring(0,K);var ab=Q.substring(K+1);T.push({key:I(N,Y),value:I(ab,Y)})}else{T.push({unknown:I(Q,Y)})}}return T},preProcessBindings:function(O){var M=typeof O==="string"?u.expressionRewriting.parseObjectLiteral(O):O;var R=[],P=[];var N;for(var L=0;N=M[L];L++){if(R.length>0){R.push(",")}if(N.key){var Q=D(N.key),S=N.value;R.push(Q);R.push(":");R.push(S);if(S=E(u.utils.stringTrim(S))){if(P.length>0){P.push(", ")}P.push(Q+" : function(__ko_value) { "+S+" = __ko_value; }")}}else{if(N.unknown){R.push(N.unknown)}}}var K=R.join("");if(P.length>0){var J=P.join("");K=K+", '_ko_property_writers' : { "+J+" } "}return K},keyValueArrayContainsKey:function(L,K){for(var J=0;J<L.length;J++){if(u.utils.stringTrim(L[J]["key"])==K){return true}}return false},writeValueToProperty:function(M,J,L,O,K){if(!M||!u.isWriteableObservable(M)){var N=J()["_ko_property_writers"];if(N&&N[L]){N[L](O)}}else{if(!K||M.peek()!==O){M(O)}}}}})();u.exportSymbol("expressionRewriting",u.expressionRewriting);u.exportSymbol("expressionRewriting.bindingRewriteValidators",u.expressionRewriting.bindingRewriteValidators);u.exportSymbol("expressionRewriting.parseObjectLiteral",u.expressionRewriting.parseObjectLiteral);u.exportSymbol("expressionRewriting.preProcessBindings",u.expressionRewriting.preProcessBindings);u.exportSymbol("jsonExpressionRewriting",u.expressionRewriting);u.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",u.expressionRewriting.preProcessBindings);(function(){var D=i.createComment("test").text==="<!--test-->";var L=D?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/;var E=D?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/;var I={ul:true,ol:true};function K(M){return(M.nodeType==8)&&(D?M.text:M.nodeValue).match(L)}function J(M){return(M.nodeType==8)&&(D?M.text:M.nodeValue).match(E)}function H(Q,M){var O=Q;var P=1;var N=[];while(O=O.nextSibling){if(J(O)){P--;if(P===0){return N}}N.push(O);if(K(O)){P++}}if(!M){throw new Error("Cannot find closing comment tag to match: "+Q.nodeValue)}return null}function F(O,M){var N=H(O,M);if(N){if(N.length>0){return N[N.length-1].nextSibling}return O.nextSibling}else{return null}}function G(P){var N=P.firstChild,M=null;if(N){do{if(M){M.push(N)}else{if(K(N)){var O=F(N,true);if(O){N=O}else{M=[N]}}else{if(J(N)){M=[N]}}}}while(N=N.nextSibling)}return M}u.virtualElements={allowedBindings:{},childNodes:function(M){return K(M)?H(M):M.childNodes},emptyNode:function(O){if(!K(O)){u.utils.emptyDomNode(O)}else{var P=u.virtualElements.childNodes(O);for(var M=0,N=P.length;M<N;M++){u.removeNode(P[M])}}},setDomNodeChildren:function(Q,M){if(!K(Q)){u.utils.setDomNodeChildren(Q,M)}else{u.virtualElements.emptyNode(Q);var N=Q.nextSibling;for(var O=0,P=M.length;O<P;O++){N.parentNode.insertBefore(M[O],N)}}},prepend:function(M,N){if(!K(M)){if(M.firstChild){M.insertBefore(N,M.firstChild)}else{M.appendChild(N)}}else{M.parentNode.insertBefore(N,M.nextSibling)}},insertAfter:function(M,O,N){if(!N){u.virtualElements.prepend(M,O)}else{if(!K(M)){if(N.nextSibling){M.insertBefore(O,N.nextSibling)}else{M.appendChild(O)}}else{M.parentNode.insertBefore(O,N.nextSibling)}}},firstChild:function(M){if(!K(M)){return M.firstChild}if(!M.nextSibling||J(M.nextSibling)){return null}return M.nextSibling},nextSibling:function(M){if(K(M)){M=F(M)}if(M.nextSibling&&J(M.nextSibling)){return null}return M.nextSibling},virtualNodeBindingValue:function(M){var N=K(M);return N?N[1]:null},normaliseVirtualElementDomStructure:function(N){if(!I[u.utils.tagNameLower(N)]){return}var M=N.firstChild;if(M){do{if(M.nodeType===1){var Q=G(M);if(Q){var P=M.nextSibling;for(var O=0;O<Q.length;O++){if(P){N.insertBefore(Q[O],P)}else{N.appendChild(Q[O])}}}}}while(M=M.nextSibling)}}}})();u.exportSymbol("virtualElements",u.virtualElements);u.exportSymbol("virtualElements.allowedBindings",u.virtualElements.allowedBindings);u.exportSymbol("virtualElements.emptyNode",u.virtualElements.emptyNode);u.exportSymbol("virtualElements.insertAfter",u.virtualElements.insertAfter);u.exportSymbol("virtualElements.prepend",u.virtualElements.prepend);u.exportSymbol("virtualElements.setDomNodeChildren",u.virtualElements.setDomNodeChildren);(function(){var F="data-bind";u.bindingProvider=function(){this.bindingCache={}};u.utils.extend(u.bindingProvider.prototype,{nodeHasBindings:function(G){switch(G.nodeType){case 1:return G.getAttribute(F)!=null;case 8:return u.virtualElements.virtualNodeBindingValue(G)!=null;default:return false}},getBindings:function(I,G){var H=this["getBindingsString"](I,G);return H?this["parseBindingsString"](H,G,I):null},getBindingsString:function(H,G){switch(H.nodeType){case 1:return H.getAttribute(F);case 8:return u.virtualElements.virtualNodeBindingValue(H);default:return null}},parseBindingsString:function(I,G,K){try{var H=E(I,this.bindingCache);return H(G,K)}catch(J){throw new Error("Unable to parse bindings.\nMessage: "+J+";\nBindings value: "+I)}}});u.bindingProvider.instance=new u.bindingProvider();function E(G,H){var I=G;return H[I]||(H[I]=D(G))}function D(G){var I=u.expressionRewriting.preProcessBindings(G),H="with($context){with($data||{}){return{"+I+"}}}";return new Function("$context","$element",H)}})();u.exportSymbol("bindingProvider",u.bindingProvider);(function(){u.bindingHandlers={};u.bindingContext=function(I,K,J){if(K){u.utils.extend(this,K);this["$parentContext"]=K;this["$parent"]=K["$data"];this["$parents"]=(K["$parents"]||[]).slice(0);this["$parents"].unshift(this["$parent"])}else{this["$parents"]=[];this["$root"]=I;this["ko"]=u}this["$data"]=I;if(J){this[J]=I}};u.bindingContext.prototype.createChildContext=function(I,J){return new u.bindingContext(I,this,J)};u.bindingContext.prototype.extend=function(J){var I=u.utils.extend(new u.bindingContext(),this);return u.utils.extend(I,J)};function H(I){var J=u.virtualElements.allowedBindings[I];if(!J){throw new Error("The binding '"+I+"' cannot be used with virtual elements")}}function D(M,K,I){var J,L=u.virtualElements.firstChild(K);while(J=L){L=u.virtualElements.nextSibling(J);E(M,J,I)}}function E(N,K,I){var M=true;var J=(K.nodeType===1);if(J){u.virtualElements.normaliseVirtualElementDomStructure(K)}var L=(J&&I)||u.bindingProvider.instance["nodeHasBindings"](K);if(L){M=F(K,null,N,I).shouldBindDescendants}if(M){D(N,K,!J)}}function F(N,K,Q,I){var L=0;var O;function M(R){return function(){return O[R]}}function P(){return O}var J;u.dependentObservable(function(){var S=Q&&(Q instanceof u.bindingContext)?Q:new u.bindingContext(u.utils.unwrapObservable(Q));var Y=S["$data"];if(I){u.storedBindingContextForNode(N,S)}var U=(typeof K=="function")?K(S,N):K;O=U||u.bindingProvider.instance["getBindings"](N,S);if(O){if(L===0){L=1;for(var T in O){var R=u.bindingHandlers[T];if(R&&N.nodeType===8){H(T)}if(R&&typeof R.init=="function"){var V=R.init;var X=V(N,M(T),P,Y,S);if(X&&X.controlsDescendantBindings){if(J!==l){throw new Error("Multiple bindings ("+J+" and "+T+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.")}J=T}}}L=2}if(L===2){for(var T in O){var R=u.bindingHandlers[T];if(R&&typeof R.update=="function"){var W=R.update;W(N,M(T),P,Y,S)}}}}},null,{disposeWhenNodeIsRemoved:N});return{shouldBindDescendants:J===l}}var G="__ko_bindingContext__";u.storedBindingContextForNode=function(J,I){if(arguments.length==2){u.utils.domData.set(J,G,I)}else{return u.utils.domData.get(J,G)}};u.applyBindingsToNode=function(J,I,K){if(J.nodeType===1){u.virtualElements.normaliseVirtualElementDomStructure(J)}return F(J,I,K,true)};u.applyBindingsToDescendants=function(J,I){if(I.nodeType===1||I.nodeType===8){D(J,I,true)}};u.applyBindings=function(J,I){if(I&&(I.nodeType!==1)&&(I.nodeType!==8)){throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node")}I=I||m.document.body;E(J,I,true)};u.contextFor=function(J){switch(J.nodeType){case 1:case 8:var I=u.storedBindingContextForNode(J);if(I){return I}if(J.parentNode){return u.contextFor(J.parentNode)}break}return l};u.dataFor=function(J){var I=u.contextFor(J);return I?I["$data"]:l};u.exportSymbol("bindingHandlers",u.bindingHandlers);u.exportSymbol("applyBindings",u.applyBindings);u.exportSymbol("applyBindingsToDescendants",u.applyBindingsToDescendants);u.exportSymbol("applyBindingsToNode",u.applyBindingsToNode);u.exportSymbol("contextFor",u.contextFor);u.exportSymbol("dataFor",u.dataFor)})();var o={"class":"className","for":"htmlFor"};u.bindingHandlers.attr={update:function(G,J,D){var I=u.utils.unwrapObservable(J())||{};for(var E in I){if(typeof E=="string"){var F=u.utils.unwrapObservable(I[E]);var H=(F===false)||(F===null)||(F===l);if(H){G.removeAttribute(E)}if(u.utils.ieVersion<=8&&E in o){E=o[E];if(H){G.removeAttribute(E)}else{G[E]=F}}else{if(!H){G.setAttribute(E,F.toString())}}if(E==="name"){u.utils.setElementName(G,H?"":F.toString())}}}}};u.bindingHandlers.checked={init:function(E,G,D){var F=function(){var K;if(E.type=="checkbox"){K=E.checked}else{if((E.type=="radio")&&(E.checked)){K=E.value}else{return}}var I=G(),J=u.utils.unwrapObservable(I);if((E.type=="checkbox")&&(J instanceof Array)){var H=u.utils.arrayIndexOf(J,E.value);if(E.checked&&(H<0)){I.push(E.value)}else{if((!E.checked)&&(H>=0)){I.splice(H,1)}}}else{u.expressionRewriting.writeValueToProperty(I,D,"checked",K,true)}};u.utils.registerEventHandler(E,"click",F);if((E.type=="radio")&&!E.name){u.bindingHandlers.uniqueName["init"](E,function(){return true})}},update:function(D,F){var E=u.utils.unwrapObservable(F());if(D.type=="checkbox"){if(E instanceof Array){D.checked=u.utils.arrayIndexOf(E,D.value)>=0}else{D.checked=E}}else{if(D.type=="radio"){D.checked=(D.value==E)}}}};var p="__ko__cssValue";u.bindingHandlers.css={update:function(E,H){var G=u.utils.unwrapObservable(H());if(typeof G=="object"){for(var D in G){var F=u.utils.unwrapObservable(G[D]);u.utils.toggleDomNodeCssClass(E,D,F)}}else{G=String(G||"");u.utils.toggleDomNodeCssClass(E,E[p],false);E[p]=G;u.utils.toggleDomNodeCssClass(E,G,true)}}};u.bindingHandlers.enable={update:function(D,F){var E=u.utils.unwrapObservable(F());if(E&&D.disabled){D.removeAttribute("disabled")}else{if((!E)&&(!D.disabled)){D.disabled=true}}}};u.bindingHandlers.disable={update:function(D,E){u.bindingHandlers.enable["update"](D,function(){return !u.utils.unwrapObservable(E())})}};function w(D){u.bindingHandlers[D]={init:function(F,H,E,I){var G=function(){var J={};J[D]=H();return J};return u.bindingHandlers.event["init"].call(this,F,G,E,I)}}}u.bindingHandlers.event={init:function(E,H,D,I){var G=H()||{};for(var F in G){(function(){var J=F;if(typeof J=="string"){u.utils.registerEventHandler(E,J,function(N){var P;var O=H()[J];if(!O){return}var K=D();try{var L=u.utils.makeArray(arguments);L.unshift(I);P=O.apply(I,L)}finally{if(P!==true){if(N.preventDefault){N.preventDefault()}else{N.returnValue=false}}}var M=K[J+"Bubble"]!==false;if(!M){N.cancelBubble=true;if(N.stopPropagation){N.stopPropagation()}}})}})()}}};u.bindingHandlers.foreach={makeTemplateValueAccessor:function(D){return function(){var E=D(),F=u.utils.peekObservable(E);if((!F)||typeof F.length=="number"){return{foreach:E,templateEngine:u.nativeTemplateEngine.instance}}u.utils.unwrapObservable(E);return{foreach:F.data,as:F.as,includeDestroyed:F.includeDestroyed,afterAdd:F.afterAdd,beforeRemove:F.beforeRemove,afterRender:F.afterRender,beforeMove:F.beforeMove,afterMove:F.afterMove,templateEngine:u.nativeTemplateEngine.instance}}},init:function(F,G,D,H,E){return u.bindingHandlers.template["init"](F,u.bindingHandlers.foreach.makeTemplateValueAccessor(G))},update:function(F,G,D,H,E){return u.bindingHandlers.template["update"](F,u.bindingHandlers.foreach.makeTemplateValueAccessor(G),D,H,E)}};u.expressionRewriting.bindingRewriteValidators.foreach=false;u.virtualElements.allowedBindings.foreach=true;var t="__ko_hasfocusUpdating";u.bindingHandlers.hasfocus={init:function(E,I,D){var F=function(J){E[t]=true;var L=E.ownerDocument;if("activeElement" in L){J=(L.activeElement===E)}var K=I();u.expressionRewriting.writeValueToProperty(K,D,"hasfocus",J,true);E[t]=false};var G=F.bind(null,true);var H=F.bind(null,false);u.utils.registerEventHandler(E,"focus",G);u.utils.registerEventHandler(E,"focusin",G);u.utils.registerEventHandler(E,"blur",H);u.utils.registerEventHandler(E,"focusout",H)},update:function(D,F){var E=u.utils.unwrapObservable(F());if(!D[t]){E?D.focus():D.blur();u.dependencyDetection.ignore(u.utils.triggerEvent,null,[D,E?"focusin":"focusout"])}}};u.bindingHandlers.html={init:function(){return{controlsDescendantBindings:true}},update:function(D,E){u.utils.setHtml(D,E())}};var C="__ko_withIfBindingData";function x(D,F,E,G){u.bindingHandlers[D]={init:function(J,K,H,L,I){u.utils.domData.set(J,C,{});return{controlsDescendantBindings:true}},update:function(K,O,H,P,I){var Q=u.utils.domData.get(K,C),J=u.utils.unwrapObservable(O()),N=!E!==!J,L=!Q.savedNodes,M=L||F||(N!==Q.didDisplayOnLastUpdate);if(M){if(L){Q.savedNodes=u.utils.cloneNodes(u.virtualElements.childNodes(K),true)}if(N){if(!L){u.virtualElements.setDomNodeChildren(K,u.utils.cloneNodes(Q.savedNodes))}u.applyBindingsToDescendants(G?G(I,J):I,K)}else{u.virtualElements.emptyNode(K)}Q.didDisplayOnLastUpdate=N}}};u.expressionRewriting.bindingRewriteValidators[D]=false;u.virtualElements.allowedBindings[D]=true}x("if");x("ifnot",false,true);x("with",true,false,function(D,E){return D.createChildContext(E)});function r(D,E,F){if(F){if(E!==u.selectExtensions.readValue(D)){u.selectExtensions.writeValue(D,E)}}if(E!==u.selectExtensions.readValue(D)){u.dependencyDetection.ignore(u.utils.triggerEvent,null,[D,"change"])}}u.bindingHandlers.options={update:function(I,V,E){if(u.utils.tagNameLower(I)!=="select"){throw new Error("options binding applies only to SELECT elements")}var T=I.length==0;var R=u.utils.arrayMap(u.utils.arrayFilter(I.childNodes,function(W){return W.tagName&&(u.utils.tagNameLower(W)==="option")&&W.selected}),function(W){return u.selectExtensions.readValue(W)||W.innerText||W.textContent});var Q=I.scrollTop;var U=u.utils.unwrapObservable(V());var S=I.value;while(I.length>0){u.cleanNode(I.options[0]);I.remove(0)}if(U){var D=E(),K=D.optionsIncludeDestroyed;if(typeof U.length!="number"){U=[U]}if(D.optionsCaption){var N=i.createElement("option");u.utils.setHtml(N,D.optionsCaption);u.selectExtensions.writeValue(N,l);I.appendChild(N)}for(var J=0,L=U.length;J<L;J++){var G=U[J];if(G&&G._destroy&&!K){continue}var N=i.createElement("option");function F(X,Y,W){var Z=typeof Y;if(Z=="function"){return Y(X)}else{if(Z=="string"){return X[Y]}else{return W}}}var P=F(G,D.optionsValue,G);u.selectExtensions.writeValue(N,u.utils.unwrapObservable(P));var O=F(G,D.optionsText,P);u.utils.setTextContent(N,O);I.appendChild(N)}var M=I.getElementsByTagName("option");var H=0;for(var J=0,L=M.length;J<L;J++){if(u.utils.arrayIndexOf(R,u.selectExtensions.readValue(M[J]))>=0){u.utils.setOptionNodeSelectionState(M[J],true);H++}}I.scrollTop=Q;if(T&&("value" in D)){r(I,u.utils.peekObservable(D.value),true)}u.utils.ensureSelectElementIsRenderedCorrectly(I)}}};u.bindingHandlers.options.optionValueDomDataKey="__ko.optionValueDomData__";u.bindingHandlers.selectedOptions={init:function(E,F,D){u.utils.registerEventHandler(E,"change",function(){var G=F(),H=[];u.utils.arrayForEach(E.getElementsByTagName("option"),function(I){if(I.selected){H.push(u.selectExtensions.readValue(I))}});u.expressionRewriting.writeValueToProperty(G,D,"value",H)})},update:function(D,F){if(u.utils.tagNameLower(D)!="select"){throw new Error("values binding applies only to SELECT elements")}var E=u.utils.unwrapObservable(F());if(E&&typeof E.length=="number"){u.utils.arrayForEach(D.getElementsByTagName("option"),function(H){var G=u.utils.arrayIndexOf(E,u.selectExtensions.readValue(H))>=0;u.utils.setOptionNodeSelectionState(H,G)})}}};u.bindingHandlers.style={update:function(D,H){var G=u.utils.unwrapObservable(H()||{});for(var E in G){if(typeof E=="string"){var F=u.utils.unwrapObservable(G[E]);D.style[E]=F||""}}}};u.bindingHandlers.submit={init:function(E,F,D,G){if(typeof F()!="function"){throw new Error("The value for a submit binding must be a function")}u.utils.registerEventHandler(E,"submit",function(H){var I;var J=F();try{I=J.call(G,E)}finally{if(I!==true){if(H.preventDefault){H.preventDefault()}else{H.returnValue=false}}}})}};u.bindingHandlers.text={update:function(D,E){u.utils.setTextContent(D,E())}};u.virtualElements.allowedBindings.text=true;u.bindingHandlers.uniqueName={init:function(D,F){if(F()){var E="ko_unique_"+(++u.bindingHandlers.uniqueName.currentIndex);u.utils.setElementName(D,E)}}};u.bindingHandlers.uniqueName.currentIndex=0;u.bindingHandlers.value={init:function(E,J,D){var F=["change"];var I=D()["valueUpdate"];var H=false;if(I){if(typeof I=="string"){I=[I]}u.utils.arrayPushAll(F,I);F=u.utils.arrayGetDistinctValues(F)}var K=function(){H=false;var M=J();var L=u.selectExtensions.readValue(E);u.expressionRewriting.writeValueToProperty(M,D,"value",L)};var G=u.utils.ieVersion&&E.tagName.toLowerCase()=="input"&&E.type=="text"&&E.autocomplete!="off"&&(!E.form||E.form.autocomplete!="off");if(G&&u.utils.arrayIndexOf(F,"propertychange")==-1){u.utils.registerEventHandler(E,"propertychange",function(){H=true});u.utils.registerEventHandler(E,"blur",function(){if(H){K()}})}u.utils.arrayForEach(F,function(L){var M=K;if(u.utils.stringStartsWith(L,"after")){M=function(){setTimeout(K,0)};L=L.substring("after".length)}u.utils.registerEventHandler(E,L,M)})},update:function(F,I){var K=u.utils.tagNameLower(F)==="select";var H=u.utils.unwrapObservable(I());var G=u.selectExtensions.readValue(F);var J=(H!=G);if((H===0)&&(G!==0)&&(G!=="0")){J=true}if(J){var E=function(){u.selectExtensions.writeValue(F,H)};E();var D=K;if(D){setTimeout(E,0)}}if(K&&(F.length>0)){r(F,H,false)}}};u.bindingHandlers.visible={update:function(D,G){var F=u.utils.unwrapObservable(G());var E=!(D.style.display=="none");if(F&&!E){D.style.display=""}else{if((!F)&&E){D.style.display="none"}}}};w("click");u.templateEngine=function(){};u.templateEngine.prototype.renderTemplateSource=function(F,D,E){throw new Error("Override renderTemplateSource")};u.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(D){throw new Error("Override createJavaScriptEvaluatorBlock")};u.templateEngine.prototype.makeTemplateSource=function(E,F){if(typeof E=="string"){F=F||i;var D=F.getElementById(E);if(!D){throw new Error("Cannot find template with ID "+E)}return new u.templateSources.domElement(D)}else{if((E.nodeType==1)||(E.nodeType==8)){return new u.templateSources.anonymousTemplate(E)}else{throw new Error("Unknown template type: "+E)}}};u.templateEngine.prototype.renderTemplate=function(F,D,E,G){var H=this["makeTemplateSource"](F,G);return this["renderTemplateSource"](H,D,E)};u.templateEngine.prototype.isTemplateRewritten=function(D,E){if(this["allowTemplateRewriting"]===false){return true}return this["makeTemplateSource"](D,E)["data"]("isRewritten")};u.templateEngine.prototype.rewriteTemplate=function(F,D,G){var H=this["makeTemplateSource"](F,G);var E=D(H.text());H.text(E);H.data("isRewritten",true)};u.exportSymbol("templateEngine",u.templateEngine);u.templateRewriting=(function(){var E=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi;var F=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;function G(K){var H=u.expressionRewriting.bindingRewriteValidators;for(var I=0;I<K.length;I++){var J=K[I]["key"];if(H.hasOwnProperty(J)){var M=H[J];if(typeof M==="function"){var L=M(K[I]["value"]);if(L){throw new Error(L)}}else{if(!M){throw new Error("This template engine does not support the '"+J+"' binding within its templates")}}}}}function D(I,L,M){var J=u.expressionRewriting.parseObjectLiteral(I);G(J);var K=u.expressionRewriting.preProcessBindings(J);var H="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+K+" } })()})";return M.createJavaScriptEvaluatorBlock(H)+L}return{ensureTemplateIsRewritten:function(H,J,I){if(!J.isTemplateRewritten(H,I)){J.rewriteTemplate(H,function(K){return u.templateRewriting.memoizeBindingAttributeSyntax(K,J)},I)}},memoizeBindingAttributeSyntax:function(H,I){return H.replace(E,function(){return D(arguments[6],arguments[1],I)}).replace(F,function(){return D(arguments[1],"<!-- ko -->",I)})},applyMemoizedBindingsToNextSibling:function(H){return u.memoization.memoize(function(J,I){if(J.nextSibling){u.applyBindingsToNode(J.nextSibling,H,I)}})}}})();u.exportSymbol("__tr_ambtns",u.templateRewriting.applyMemoizedBindingsToNextSibling);(function(){u.templateSources={};u.templateSources.domElement=function(E){this.domElement=E};u.templateSources.domElement.prototype.text=function(){var F=u.utils.tagNameLower(this.domElement),E=F==="script"?"text":F==="textarea"?"value":"innerHTML";if(arguments.length==0){return this.domElement[E]}else{var G=arguments[0];if(E==="innerHTML"){u.utils.setHtml(this.domElement,G)}else{this.domElement[E]=G}}};u.templateSources.domElement.prototype.data=function(E){if(arguments.length===1){return u.utils.domData.get(this.domElement,"templateSourceData_"+E)}else{u.utils.domData.set(this.domElement,"templateSourceData_"+E,arguments[1])}};var D="__ko_anon_template__";u.templateSources.anonymousTemplate=function(E){this.domElement=E};u.templateSources.anonymousTemplate.prototype=new u.templateSources.domElement();u.templateSources.anonymousTemplate.prototype.text=function(){if(arguments.length==0){var E=u.utils.domData.get(this.domElement,D)||{};if(E.textData===l&&E.containerData){E.textData=E.containerData.innerHTML}return E.textData}else{var F=arguments[0];u.utils.domData.set(this.domElement,D,{textData:F})}};u.templateSources.domElement.prototype.nodes=function(){if(arguments.length==0){var E=u.utils.domData.get(this.domElement,D)||{};return E.containerData}else{var F=arguments[0];u.utils.domData.set(this.domElement,D,{containerData:F})}};u.exportSymbol("templateSources",u.templateSources);u.exportSymbol("templateSources.domElement",u.templateSources.domElement);u.exportSymbol("templateSources.anonymousTemplate",u.templateSources.anonymousTemplate)})();(function(){var D;u.setTemplateEngine=function(K){if((K!=l)&&!(K instanceof u.templateEngine)){throw new Error("templateEngine must inherit from ko.templateEngine")}D=K};function I(L,N,K){var P,O=L,M=u.virtualElements.nextSibling(N);while(O&&((P=O)!==M)){O=u.virtualElements.nextSibling(P);if(P.nodeType===1||P.nodeType===8){K(P)}}}function E(L,K){if(L.length){var M=L[0],N=L[L.length-1];I(M,N,function(O){u.applyBindings(K,O)});I(M,N,function(O){u.memoization.unmemoizeDomNodeAndDescendants(O,[K])})}}function H(K){return K.nodeType?K:K.length>0?K[0]:null}function G(Q,P,R,K,N){N=N||{};var L=Q&&H(Q);var S=L&&L.ownerDocument;var T=(N.templateEngine||D);u.templateRewriting.ensureTemplateIsRewritten(R,T,S);var O=T.renderTemplate(R,K,N,S);if((typeof O.length!="number")||(O.length>0&&typeof O[0].nodeType!="number")){throw new Error("Template engine must return an array of DOM nodes")}var M=false;switch(P){case"replaceChildren":u.virtualElements.setDomNodeChildren(Q,O);M=true;break;case"replaceNode":u.utils.replaceDomNodes(Q,O);M=true;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+P)}if(M){E(O,K);if(N.afterRender){u.dependencyDetection.ignore(N.afterRender,null,[O,K["$data"]])}}return O}u.renderTemplate=function(Q,L,N,P,O){N=N||{};if((N.templateEngine||D)==l){throw new Error("Set a template engine before calling renderTemplate")}O=O||"replaceChildren";if(P){var M=H(P);var R=function(){return(!M)||!u.utils.domNodeIsAttachedToDocument(M)};var K=(M&&O=="replaceNode")?M.parentNode:M;return u.dependentObservable(function(){var S=(L&&(L instanceof u.bindingContext))?L:new u.bindingContext(u.utils.unwrapObservable(L));var U=typeof(Q)=="function"?Q(S["$data"],S):Q;var T=G(P,O,U,S,N);if(O=="replaceNode"){P=T;M=H(P)}},null,{disposeWhen:R,disposeWhenNodeIsRemoved:K})}else{return u.memoization.memoize(function(S){u.renderTemplate(Q,L,N,S,"replaceNode")})}};u.renderTemplateForEach=function(R,M,O,Q,P){var L;var N=function(S,T){L=P.createChildContext(u.utils.unwrapObservable(S),O.as);L["$index"]=T;var U=typeof(R)=="function"?R(S,L):R;return G(null,"ignoreTargetNode",U,L,O)};var K=function(T,S,U){E(S,L);if(O.afterRender){O.afterRender(S,T)}};return u.dependentObservable(function(){var T=u.utils.unwrapObservable(M)||[];if(typeof T.length=="undefined"){T=[T]}var S=u.utils.arrayFilter(T,function(U){return O.includeDestroyed||U===l||U===null||!u.utils.unwrapObservable(U._destroy)});u.dependencyDetection.ignore(u.utils.setDomNodeChildrenFromArrayMapping,null,[Q,S,N,O,K])},null,{disposeWhenNodeIsRemoved:Q})};var J="__ko__templateComputedDomDataKey__";function F(K,L){var M=u.utils.domData.get(K,J);if(M&&(typeof(M.dispose)=="function")){M.dispose()}u.utils.domData.set(K,J,(L&&L.isActive())?L:l)}u.bindingHandlers.template={init:function(M,O){var K=u.utils.unwrapObservable(O());if((typeof K!="string")&&(!K.name)&&(M.nodeType==1||M.nodeType==8)){var N=M.nodeType==1?M.childNodes:u.virtualElements.childNodes(M),L=u.utils.moveCleanedNodesToContainerElement(N);new u.templateSources.anonymousTemplate(M)["nodes"](L)}return{controlsDescendantBindings:true}},update:function(O,U,K,V,L){var T=u.utils.unwrapObservable(U()),Q={},R=true,N,S=null;if(typeof T!="string"){Q=T;T=Q.name;if("if" in Q){R=u.utils.unwrapObservable(Q["if"])}if(R&&"ifnot" in Q){R=!u.utils.unwrapObservable(Q.ifnot)}N=u.utils.unwrapObservable(Q.data)}if("foreach" in Q){var M=(R&&Q.foreach)||[];S=u.renderTemplateForEach(T||O,M,Q,O,L)}else{if(!R){u.virtualElements.emptyNode(O)}else{var P=("data" in Q)?L.createChildContext(N,Q.as):L;S=u.renderTemplate(T||O,P,Q,O)}}F(O,S)}};u.expressionRewriting.bindingRewriteValidators.template=function(K){var L=u.expressionRewriting.parseObjectLiteral(K);if((L.length==1)&&L[0]["unknown"]){return null}if(u.expressionRewriting.keyValueArrayContainsKey(L,"name")){return null}return"This template engine does not support anonymous templates nested within its templates"};u.virtualElements.allowedBindings.template=true})();u.exportSymbol("setTemplateEngine",u.setTemplateEngine);u.exportSymbol("renderTemplate",u.renderTemplate);u.utils.compareArrays=(function(){var G="added",F="deleted";function D(J,I,H){J=J||[];I=I||[];if(J.length<=I.length){return E(J,I,G,F,H)}else{return E(I,J,F,G,H)}}function E(ae,I,ai,ah,P){var Y=Math.min,X=Math.max,Q=[],af,ag=ae.length,J,K=I.length,N=(K-ag)||1,V=ag+K+1,aj,T,L,M;for(af=0;af<=ag;af++){T=aj;Q.push(aj=[]);L=Y(K,af+N);M=X(0,af-1);for(J=M;J<=L;J++){if(!J){aj[J]=af+1}else{if(!af){aj[J]=J+1}else{if(ae[af-1]===I[J-1]){aj[J]=T[J-1]}else{var Z=T[J]||V;var ak=aj[J-1]||V;aj[J]=Y(Z,ak)+1}}}}}var R=[],W,ac=[],aa=[];for(af=ag,J=K;af||J;){W=Q[af][J]-1;if(J&&W===Q[af][J-1]){ac.push(R[R.length]={status:ai,value:I[--J],index:J})}else{if(af&&W===Q[af-1][J]){aa.push(R[R.length]={status:ah,value:ae[--af],index:af})}else{R.push({status:"retained",value:I[--J]});--af}}}if(ac.length&&aa.length){var U=ag*10,S,H,O,ad,ab;for(S=H=0;(P||S<U)&&(ad=ac[H]);H++){for(O=0;ab=aa[O];O++){if(ad.value===ab.value){ad.moved=ab.index;ab.moved=ad.index;aa.splice(O,1);S=O=0;break}}S+=O}}return R.reverse()}return D})();u.exportSymbol("utils.compareArrays",u.utils.compareArrays);(function(){function D(G){while(G.length&&!u.utils.domNodeIsAttachedToDocument(G[0])){G.splice(0,1)}if(G.length>1){var H=G[0],I=G[G.length-1],J=[H];while(H!==I){H=H.nextSibling;if(!H){return}J.push(H)}Array.prototype.splice.apply(G,[0,G.length].concat(J))}return G}function F(H,L,M,G,J){var K=[];var I=u.dependentObservable(function(){var N=L(M,J)||[];if(K.length>0){u.utils.replaceDomNodes(D(K),N);if(G){u.dependencyDetection.ignore(G,null,[M,N,J])}}K.splice(0,K.length);u.utils.arrayPushAll(K,N)},null,{disposeWhenNodeIsRemoved:H,disposeWhen:function(){return(K.length==0)||!u.utils.domNodeIsAttachedToDocument(K[0])}});return{mappedNodes:K,dependentObservable:(I.isActive()?I:l)}}var E="setDomNodeChildrenFromArrayMapping_lastMappingResult";u.utils.setDomNodeChildrenFromArrayMapping=function(J,G,Z,ag,H){G=G||[];ag=ag||{};var N=u.utils.domData.get(J,E)===l;var V=u.utils.domData.get(J,E)||[];var U=u.utils.arrayMap(V,function(ah){return ah.arrayEntry});var K=u.utils.compareArrays(U,G);var ab=[];var W=0;var ac=0;var af=[];var S=[];var Q=[];var R=[];var P=[];var Y;function O(ah,ai){Y=V[ai];if(ac!==ai){R[ah]=Y}Y.indexObservable(ac++);D(Y.mappedNodes);ab.push(Y);S.push(Y)}function I(ah,aj){if(ah){for(var ai=0,ak=aj.length;ai<ak;ai++){if(aj[ai]){u.utils.arrayForEach(aj[ai].mappedNodes,function(al){ah(al,ai,aj[ai].arrayEntry)})}}}}for(var M=0,L,aa;L=K[M];M++){aa=L.moved;switch(L.status){case"deleted":if(aa===l){Y=V[W];if(Y.dependentObservable){Y.dependentObservable.dispose()}af.push.apply(af,D(Y.mappedNodes));if(ag.beforeRemove){Q[M]=Y;S.push(Y)}}W++;break;case"retained":O(M,W++);break;case"added":if(aa!==l){O(M,aa)}else{Y={arrayEntry:L.value,indexObservable:u.observable(ac++)};ab.push(Y);S.push(Y);if(!N){P[M]=Y}}break}}I(ag.beforeMove,R);u.utils.arrayForEach(af,ag.beforeRemove?u.cleanNode:u.removeNode);for(var M=0,ad=u.virtualElements.firstChild(J),X,ae;Y=S[M];M++){if(!Y.mappedNodes){u.utils.extend(Y,F(J,Z,Y.arrayEntry,H,Y.indexObservable))}for(var T=0;ae=Y.mappedNodes[T];ad=ae.nextSibling,X=ae,T++){if(ae!==ad){u.virtualElements.insertAfter(J,ae,X)}}if(!Y.initialized&&H){H(Y.arrayEntry,Y.mappedNodes,Y.indexObservable);Y.initialized=true}}I(ag.beforeRemove,Q);I(ag.afterMove,R);I(ag.afterAdd,P);u.utils.domData.set(J,E,ab)}})();u.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",u.utils.setDomNodeChildrenFromArrayMapping);u.nativeTemplateEngine=function(){this["allowTemplateRewriting"]=false};u.nativeTemplateEngine.prototype=new u.templateEngine();u.nativeTemplateEngine.prototype.renderTemplateSource=function(H,D,E){var J=!(u.utils.ieVersion<9),G=J?H.nodes:null,F=G?H.nodes():null;if(F){return u.utils.makeArray(F.cloneNode(true).childNodes)}else{var I=H.text();return u.utils.parseHtmlFragment(I)}};u.nativeTemplateEngine.instance=new u.nativeTemplateEngine();u.setTemplateEngine(u.nativeTemplateEngine.instance);u.exportSymbol("nativeTemplateEngine",u.nativeTemplateEngine);(function(){u.jqueryTmplTemplateEngine=function(){var G=this.jQueryTmplVersion=(function(){if((typeof(j)=="undefined")||!(j.tmpl)){return 0}try{if(j.tmpl["tag"]["tmpl"]["open"].toString().indexOf("__")>=0){return 2}}catch(H){}return 1})();function E(){if(G<2){throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}}function F(H,I,J){return j.tmpl(H,I,J)}this["renderTemplateSource"]=function(N,H,K){K=K||{};E();var L=N.data("precompiled");if(!L){var O=N.text()||"";O="{{ko_with $item.koBindingContext}}"+O+"{{/ko_with}}";L=j.template(null,O);N.data("precompiled",L)}var I=[H["$data"]];var J=j.extend({koBindingContext:H},K.templateOptions);var M=F(L,I,J);M.appendTo(i.createElement("div"));j.fragments={};return M};this["createJavaScriptEvaluatorBlock"]=function(H){return"{{ko_code ((function() { return "+H+" })()) }}"};this["addTemplate"]=function(I,H){i.write("<script type='text/html' id='"+I+"'>"+H+"</script>")};if(G>0){j.tmpl["tag"]["ko_code"]={open:"__.push($1 || '');"};j.tmpl["tag"]["ko_with"]={open:"with($1) {",close:"} "}}};u.jqueryTmplTemplateEngine.prototype=new u.templateEngine();var D=new u.jqueryTmplTemplateEngine();if(D.jQueryTmplVersion>0){u.setTemplateEngine(D)}u.exportSymbol("jqueryTmplTemplateEngine",u.jqueryTmplTemplateEngine)})()})})(window,document,navigator,d);f.observable=function(h){if(typeof(h)==="object"&&h.constructor==Array){return c.observableArray(h)}if(typeof(h)==="function"){return c.computed(h)}return c.observable(h)};f.applyBindings=function(h){if(!h.node){h.node=window.document.body}if(h.binding){c.applyBindingsToNode(h.node,h.binding,h.viewModel)}else{c.applyBindings(h.viewModel,h.node)}};f.inject=function(h){var k='<script id="'+h.id+'" type="text/html">';k+=h.content;k+="</script>";if(typeof h.target=="undefined"||h.target.toLowerCase()=="body"){var i=document.createElement("div");i.setAttribute("style","display:none;");document.body.appendChild(i);c.utils.setHtml(i,k)}else{var j=b.Sizzle(h.target)[0];c.utils.setHtml(j,k)}};f.clearNode=function(h){c.cleanNode(h)};c.bindingHandlers.cssClass={update:function(h,j){var i=c.utils.unwrapObservable(j());h.className=i}};f.bindingHandlers=c.bindingHandlers})(b.Templating=b.Templating||{})})(window.xRTML=window.xRTML||{});(function(b,a){(function(n,r){var l=b.Common.Util.guidGenerator;var p=function(C){var B=this;var y=C.name||"";var z=C.namespace||"";var u=C.description||"";var A=C.properties||r;var w=C.methods||r;var v=C.events||r;var t=C.classes||r;var x=C.modules||r;this.Name=(function(){return y})();this.Namespace=(function(){return z})();this.Description=(function(){return u})();this.Properties=(function(){return A})();this.Methods=(function(){return w})();this.Events=(function(){return v})();this.Classes=(function(){return t})();this.Modules=(function(){return x})()};var h=function(D){var B=this;var y=D.name||"";var z=D.namespace||"";var t=D.base||r;var C=D.subclasses||r;var u=D.constructors||r;var v=D.description||"";var A=D.properties||r;var x=D.methods||r;var w=D.events||r;this.Name=(function(){return y})();this.Namespace=(function(){return z})();this.Base=(function(){return t})();this.Subclasses=(function(){return C})();this.Constructors=(function(){return u})();this.Description=(function(){return v})();this.Properties=(function(){return A})();this.Methods=(function(){return x})();this.Events=(function(){return w})();this.toString=function(){return(this.Namespace.length>0)?this.Namespace+"."+this.Name:this.Name};this.typeOf=D.typeOf||function(){return B.toString()}};var q=function(x){var v=x.name||"";var t=x.description||"";var u=x.mandatory||false;var w=x.type||r;this.Name=(function(){return v})();this.Description=(function(){return t})();this.Mandatory=(function(){return u})();this.Type=(function(){return w})()};var o=function(y){var w=y.name||"";var u=y.description||"";var t=y.arguments||"";var x=y["return"]||r;var v=y.exceptions||"";this.Name=(function(){return w})();this.Description=(function(){return u})();this.Arguments=(function(){return t})();this.Return=(function(){return x})();this.Exceptions=(function(){return v})()};var g=function(x){var v=x.name||"";var t=x.description||"";var u=x.mandatory||false;var w=x.type||r;this.Name=(function(){return v})();this.Description=(function(){return t})();this.Mandatory=(function(){return u})();this.Type=(function(){return w})()};var i=function(v){var u=v.name||"";var t=v.handler||r;this.Name=(function(){return u})();this.Handler=(function(){return t})()};var m=function(x){var v=x.name||"";var w=x.namespace||"";var u=x.description||"";var t=x.arguments||r;this.Name=(function(){return v})();this.Namespace=(function(){return w})();this.Description=(function(){return u})();this.Arguments=(function(){return t})()};var c={root:new p({name:"root",classes:{String:new h({name:"String",typeOf:function(){return"String"}}),Number:new h({name:"String",typeOf:function(){return"Number"}}),Boolean:new h({name:"String",typeOf:function(){return"Boolean"}}),Function:new h({name:"String",typeOf:function(){return"Function"}}),Array:new h({name:"String",typeOf:function(){return"Array"}}),Function:new h({name:"String",typeOf:function(){return"Function"}}),Date:new h({name:"String",typeOf:function(){return"Date"}}),Object:new h({name:"String",typeOf:function(){return"Object"}}),RegExp:new h({name:"String",typeOf:function(){return"RegExp"}}),Error:new h({name:"String",typeOf:function(){return"Error"}})},modules:{xRTML:new p({name:"xRTML",modules:{Tags:new p({name:"Tags",classes:new Object()})}}),Anonymous:new p({name:"Anonymous"})}})};var d={};var f=function(v,u,t){if(!d[v]){d[v]=new Array()}d[v].push({reference:u,propertyName:t})};n.fixUnresolvedTypes=function(){for(var v in d){var t=j(v);if(t){for(var u=0;u<d[v].length;u++){d[v][u].reference[d[v][u].propertyName]=t}delete d[v]}}for(var v in d){console.warn(v+" -> "+d[v].length)}};var k=function(x){if(x==r||x.length==0){return c.root}var v,t,w=x.lastIndexOf(".");if(w===-1){t=x}else{v=x.substring(0,w);t=x.substring(w+1)}var u=c.root;if(v!=r){u=k(v)}return u.Modules[t]};var j=function(x){var v,t,w=x.lastIndexOf(".");if(w===-1){t=x}else{v=x.substring(0,w);t=x.substring(w+1)}var u=c.root;if(v!=r){u=k(v)}return(u)?u.Classes[t]:r};n.registerModule=function(L){var F,E,J=L.name.lastIndexOf(".");if(J!=-1){L.namespace=L.name.substring(0,J);L.name=L.name.substring(J+1)}var K=new p({name:L.name,namespace:L.namespace,description:L.description});var E=k(L.namespace);if(!E.Modules){E.Modules={}}E.Modules[L.name]=K;for(var M=0;M<L.classes.length;M++){this.registerClass(L.classes[M])}var G={};for(var H in L.properties){var I=r;if(L.properties[H].type instanceof String||typeof(L.properties[H].type)=="string"){I=j(L.properties[H].type)}else{I=this.registerClass(L.properties[H].type)}G[H]=new q({name:H,description:L.properties[H].description,mandatory:L.properties[H].mandatory,type:I});if(!G[H].Type){f(L.properties[H],G[H],"Type")}}var D={};for(var C in L.methods){var v={};for(var t in L.methods[C].arguments){var u=r;if(L.methods[C].arguments[t].type instanceof String||typeof(L.methods[C].arguments[t].type)=="string"){u=j(L.methods[C].arguments[t].type)}else{u=this.registerClass(L.methods[C].arguments[t].type)}v[t]=new g({name:t,description:L.methods[C].arguments[t].description,mandatory:L.methods[C].arguments[t].mandatory,type:u});if(!v[t].Type){f(L.methods[C].arguments[t],v[t],"Type")}}var A={};for(var M=0;M<L.methods[C].exceptions.length;M++){if(L.methods[C].exceptions[M] instanceof String||typeof(L.methods[C].exceptions[M])=="string"){var z=j(L.methods[C].exceptions[M]);if(z!=r){A[z.toString()]=z}else{throw"Type "+L.methods[C].exceptions[M]+" is not defined"}}else{var z=this.registerClass(L.methods[C].exceptions[M]);A[z.toString()]=z}}var B={name:C,description:L.methods[C].description,arguments:v,exceptions:A};if(L.methods[C]["return"]){if(L.methods[C]["return"] instanceof String||typeof(L.methods[C]["return"])=="string"){B["return"]=j(L.methods[C]["return"])}else{B["return"]=this.registerClass(L.methods[C]["return"])}}D[C]=new o(B);if(L.methods[C]["return"]&&!D[C].Return){f(L.methods[C]["return"],D[C],"Return")}}var y={};for(var x in L.events){var w=r;if(L.events[x].type instanceof String||typeof(L.events[x].type)=="string"){w=j(L.events[x].handler)}else{w=this.registerHandler(L.events[x].handler)}y[x]=new i({name:x,description:L.events[x].description,handler:w})}K.Properties=G;K.Methods=D;K.Events=y;return K};n.registerClass=function(L){if(L.name==r){L.name=l()}if(L.namespace==r){L.namespace="Anonymous"}var w=r;if(L["extends"]){w=j(L["extends"])}var N=function(Q){var P={};for(var O in Q){P[O]=Q[O]}return P};var H=(w)?N(w.Properties):{};for(var I in L.properties){var J=r;if(L.properties[I].type instanceof String||typeof(L.properties[I].type)=="string"){J=j(L.properties[I].type)}else{J=this.registerClass(L.properties[I].type)}H[I]=new q({name:I,description:L.properties[I].description,mandatory:L.properties[I].mandatory,type:J});if(!H[I].Type){f(L.properties[I].type,H[I],"Type")}}var x=(w)?N(w.constructors):{};for(var E in L.constructors){var v={};for(var t in L.constructors[E].arguments){var u=r;if(L.constructors[E].arguments[t].type instanceof String||typeof(L.constructors[E].arguments[t].type)=="string"){u=j(L.constructors[E].arguments[t].type)}else{u=this.registerClass(L.constructors[E].arguments[t].type)}v[t]=new g({name:t,description:L.constructors[E].arguments[t].description,mandatory:L.constructors[E].arguments[t].mandatory,type:u});if(!v[t].Type){f(L.constructors[E].arguments[t].type,v[t],"Type")}}var C={};for(var M=0;M<L.constructors[E].exceptions.length;M++){if(L.constructors[E].exceptions[M] instanceof String||typeof(L.constructors[E].exceptions[M])=="string"){var B=j(L.constructors[E].exceptions[M]);C[B.toString()]=B;if(!C[B.toString()]){f(L.constructors[E].exceptions[M],C,B.toString())}}else{var B=this.registerClass(L.constructors[E].exceptions[M]);C[B.toString()]=B}}var D={name:E,description:L.constructors[E].description,arguments:v,exceptions:C};if(L.constructors[E]["return"]){if(L.constructors[E]["return"] instanceof String||typeof(L.constructors[E]["return"])=="string"){D["return"]=j(L.constructors[E]["return"])}else{D["return"]=this.registerClass(L.constructors[E]["return"])}}x[E]=new o(D);if(L.constructors[E]["return"]&&!x[E].Return){f(L.constructors[E]["return"],x[E],"Return")}}var F=(w)?N(w.Methods):{};for(var E in L.methods){var v={};for(var t in L.methods[E].arguments){var u=r;if(L.methods[E].arguments[t].type instanceof String||typeof(L.methods[E].arguments[t].type)=="string"){u=j(L.methods[E].arguments[t].type)}else{u=this.registerClass(L.methods[E].arguments[t].type)}v[t]=new g({name:t,description:L.methods[E].arguments[t].description,mandatory:L.methods[E].arguments[t].mandatory,type:u});if(!v[t].Type){f(L.methods[E].arguments[t].type,v[t],"Type")}}var C={};for(var M=0;M<L.methods[E].exceptions.length;M++){if(L.methods[E].exceptions[M] instanceof String||typeof(L.methods[E].exceptions[M])=="string"){var B=j(L.methods[E].exceptions[M]);C[B.toString()]=B;if(!C[B.toString()]){f(L.methods[E].exceptions[M],C,B.toString())}}else{var B=this.registerClass(L.methods[E].exceptions[M]);C[B.toString()]=B}}var D={name:E,description:L.methods[E].description,arguments:v,exceptions:C};if(L.methods[E]["return"]){if(L.methods[E]["return"] instanceof String||typeof(L.methods[E]["return"])=="string"){D["return"]=j(L.methods[E]["return"])}else{D["return"]=this.registerClass(L.methods[E]["return"])}}F[E]=new o(D);if(L.methods[E]["return"]&&!F[E].Return){f(L.methods[E]["return"],F[E],"Return")}}var A=(w)?N(w.Events):{};for(var z in L.events){var y=r;if(L.events[z].type instanceof String||typeof(L.events[z].type)=="string"){y=j(L.events[z].handler)}else{y=this.registerHandler(L.events[z].handler)}A[z]=new i({name:z,description:L.events[z].description,handler:y})}var K=new h({name:L.name,namespace:L.namespace,base:w,description:L.description,properties:H,constructors:x,methods:F,events:A});if(L["extends"]&&!K.Base){f(L["extends"],K,"Base")}var G=k(L.namespace);if(!G.Classes){G.Classes={}}G.Classes[L.name]=K;if(w){if(typeof w.Subclasses=="undefined"){w.Subclasses=new Object()}w.Subclasses[K.toString()]=K}return K};n.registerHandler=function(y){if(y.name==r){y.name=l()}if(y.namespace==r){y.namespace="Anonymous"}var v={};for(var t in y.arguments){var u=r;if(y.arguments[t].type instanceof String||typeof(y.arguments[t].type)=="string"){u=j(y.arguments[t].type)}else{u=this.registerClass(y.arguments[t].type)}v[t]=new g({name:t,description:y.arguments[t].description,mandatory:y.arguments[t].mandatory,type:u});if(!v[t].Type){f(y.arguments[t].type,v[t],"Type")}}var w=new m({name:y.name,namespace:y.namespace,description:y.description,arguments:v});var x=k(y.namespace);if(!x.Classes){x.Classes={}}x.Classes[y.name]=w;return w};n.getClass=function(t){return j(t)};n.getModule=function(t){return(t)?k(t):c.root};n.validateProperties=function(w,u){var t=(w instanceof String||typeof(w)=="string")?j(w):w;for(var v in t.Properties){if(t.Properties[v].Mandatory==true&&u[v]===r){return false}if(t.Properties[v].Mandatory==false&&u[v]===r){continue}if(t.Properties[v].Type==n.get("Object")&&typeof(u[v])=="object"){continue}if(t.Properties[v].Type==n.get("String")){if(u[v] instanceof String||typeof(u[v])=="string"){continue}else{return false}}if(t.Properties[v].Type==n.get("Number")){if(!isNaN(parseFloat(u[v]))&&isFinite(u[v])){continue}else{return false}}if(t.Properties[v].Type==n.get("Boolean")){if(u[v] instanceof Boolean||typeof(u[v])=="boolean"){continue}else{return false}}if(t.Properties[v].Type==n.get("Array")){if(typeof(u[v])==="object"&&u[v].constructor==Array){continue}else{return false}}if(t.Properties[v].Type==n.get("Function")){if(u[v] instanceof Function){continue}else{return false}}if(n.validateProperties(t.Properties[v].Type,u[v])){continue}return false}return true}})(b.Metadata=b.Metadata||{})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Media","abstract":true,struct:function(){var c=b.Common.Function.proxy(function(){if(this.autoPlay&&this.sources.next()){this.play(this.sources.current())}},this);var d=b.Common.Function.proxy(function(){if(this.autoPlay&&this.sources.current()){this.player.play(this.sources.current())}this.bind({ended:d});this.bind({ended:c})},this);this.init=function(i){this._super(i);this.target=this.target[0];this.width=b.Common.Converter.toNumber(i.attribute("width"))||null;this.height=b.Common.Converter.toNumber(i.attribute("height"))||null;this.autoPlay=typeof i.attribute("autoPlay")=="undefined"?true:b.Common.Converter.toBoolean(i.attribute("autoPlay"));this.loop=typeof i.attribute("loop")=="undefined"?true:b.Common.Converter.toBoolean(i.attribute("loop"));this.controlsBar=b.Common.Converter.toBoolean(i.attribute("controlsBar"))||false;this.muted=b.Common.Converter.toBoolean(i.attribute("muted"))||false;this.loadStatus=0;this.sources=(function(){var j=[],k=-1;return{current:function(){return(j.length&&k!=-1)!=0?j[k]:null},currentIndex:function(){return k},next:function(){k=(++k)<j.length?k:0;return j.length!=0?j[k]:null},previous:function(){k=--k<0?(j.length-1):k;return j.length!=0?j[k]:null},insert:function(n,m){if(n&&m>0&&m<(j.length+1)){if(!(n instanceof Array)){n=[n]}for(var l=n.length-1;l>=0;--l){j.splice(m,0,n[l])}if(k!=-1&&m<k){k+=n.length}}},push:function(l){if(l){if(!(l instanceof Array)){l=[l]}j.push.apply(j,l)}},removeAt:function(m){var l=null;if(m>=0&&m<j.length){l=j.splice(m,1);if(k>j.length||m<k){--k}}return l},remove:function(p){for(var n=0;n<j.length;++n){var l=j[n],o=true;for(var m in p){if(!b.Common.Object.equals(p[m],l[m])){o=false;break}}if(o){return this.removeAt(n)}}return null},pop:function(){return this.removeAt(j.length-1)},purge:function(){j=[];k=-1},length:function(){return j.length}}})();var h=this;if(!this.resources.swfobject){this.registerResources([{name:"swfobject",src:window.location.protocol+"//code.xrtml.org/plugins/swfobject.js"}])}this.players={};this.players.swf=function(j){b.Event.extend(this);this.id="FLVplayer_"+b.Common.Util.idGenerator();this.isReady=false;b.Common.DOM.loadScripts(h.resources.swfobject,b.Common.Function.proxy(function(){if(swfobject.getFlashPlayerVersion().major==0){if(b.Sizzle("#"+this.id,h.target).length==0){var l=document.createElement("a");l.setAttribute("id","flashnotavailable");l.setAttribute("href",window.location.protocol+"//www.adobe.com/go/getflashplayer");l.setAttribute("target","_blank");var m=document.createElement("img");m.setAttribute("src",window.location.protocol+"//www.adobe.com/images/shared/download_buttons/get_flash_player.gif");m.setAttribute("alt","Get Adobe Flash player");l.appendChild(m);h.target.appendChild(l);return}}this.isReady=true;this.fire({ready:{}})},this));this.target=j.target;this.width=j.width;this.height=j.height;this.supportedMedia={swf:this.canPlayType("swf")};function k(l){h.fire({loadedmetadata:{event:l,target:h}})}this.bind({loadedmetadata:k})};this.players.swf.prototype={play:function(p){if(!this.isReady){this.bind({ready:b.Common.Function.proxy(function(){this.play(p)},this)});return}var k=p.files.swf;if(k){if(b.Sizzle(this.id+" object").length>0){this.stop()}var m=document.createElement("span");m.id=this.id;this.target.appendChild(m);var l={},o={allowScriptAccess:"always",play:"true",loop:"true"},j={align:"middle"},n=b.Common.Function.proxy(function(q){this.fire({loadedmetadata:q})},this);swfobject.embedSWF(k,this.id,!!this.width?this.width:"425",!!this.height?this.height:"356","8",null,{allowScriptAccess:"always",play:"true"},null,n);this.restart=function(){this.stop();this.play(p)}}},isPlaying:function(){return b.Sizzle("#"+this.id).length>0},stop:function(){if(typeof swfobject!="undefined"){swfobject.removeSWF(this.id)}},pause:function(){},restart:function(){},skip:function(){},mute:function(){},volume:function(){},canPlayExtension:function(j){var k=this.supportedMedia[j];if(typeof k==="undefined"){return false}return this.canPlayType(k)},canPlayType:function(j){return j==="swf"},time:function(){return{current:0,duration:0}}};var g=function(k){this.id=b.Common.Util.idGenerator();var q=document.createElement(k.type);q.id=this.id;q.width=k.width;q.height=k.height;q.poster=k.poster;q.autoplay=k.autoPlay;q.loop=k.loop;q.muted=k.muted;q.controls=k.controls;this.addPlayerDOM=function(){h.target.appendChild(q);b.Event.bind(q,{progress:u});b.Event.bind(q,{loadedmetadata:n});b.Event.bind(q,{timeupdate:v});b.Event.bind(q,{play:r});b.Event.bind(q,{playing:t});b.Event.bind(q,{pause:p});b.Event.bind(q,{ended:l})};this.fallback=typeof h.players.swf==="function"?new h.players.swf(k):h.players.swf;this.supportedMedia={};for(var j in k.formats){this.supportedMedia[j]=q.canPlayType(k.formats[j])=="maybe"||q.canPlayType(k.formats[j])=="probably"}var o=this;function u(w){var x=w.target.buffered.length!=0?w.target.buffered.end(0):0;o.loadStatus=parseInt(((x/w.target.duration)*100))}b.Event.bind(q,{progress:u});function n(w){h.duration=w.target.duration;h.currentTime=w.target.currentTime;if(k.keepRatio){w.target.height=w.target.videoHeight;w.target.width=w.target.videoWidth}if(q.paused){q.play()}h.fire({loadedmetadata:{event:w,target:h}})}b.Event.bind(q,{loadedmetadata:n});function v(w){h.currentTime=w.target.currentTime}b.Event.bind(q,{timeupdate:v});function r(w){}b.Event.bind(q,{play:r});function t(w){}b.Event.bind(q,{playing:t});function p(w){}b.Event.bind(q,{pause:p});function l(w){h.fire("ended",{file:w})}b.Event.bind(q,{ended:l});function m(w){if(w.target.error!==null){var x="";switch(w.target.error.code){case w.target.error.MEDIA_ERR_ABORTED:x="You aborted the media playback.";break;case w.target.error.MEDIA_ERR_NETWORK:x="A network error caused the media download to fail part-way.";break;case w.target.error.MEDIA_ERR_DECODE:x="The media playback was aborted due to a corruption problem or because the media used features your browser did not support.";break;case w.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:x="The media could not be loaded, either because the server or network failed or because the format is not supported.";break;default:x="An unknown error occurred.";break}b.Error.raise({code:b.Error.Codes.UNEXPECTEDMEDIA,target:h,message:x,info:{className:"xRTML.TagManager.Media",methodName:"errorHandler (internal method, no docs available)"}})}}b.Event.bind(q,{error:m});this.isReady=true};g.prototype={loadStatus:0,play:function(l){for(var j in l.files){if(this.supportedMedia[j]===true){var k=document.getElementById(this.id);if(!k){this.addPlayerDOM();k=document.getElementById(this.id)}k.autoplay=l.autoPlay===k.autoplay?k.autoplay:l.autoPlay;k.loop=l.loop===k.loop?k.loop:l.loop;k.src=l.files[j];k.load();k.play();b.Console.debug("Playing file: "+l.files[j]);if(l.offset){this.offset(l.offset.start,l.offset.end)}return}}if(this.fallback&&l.files.swf){this.fallback.play(l)}else{document.getElementById(this.id).innerHTML="Your browser cannot play these movie types."}},stop:function(){var j=document.getElementById(this.id);j.currentTime=j.duration},pause:function(){var j=document.getElementById(this.id);j.paused?j.play():j.pause()},restart:function(){var j=document.getElementById(this.id);j.currentTime=0},skip:function(k){var j=document.getElementById(this.id);if(j.readyState>=j.HAVE_METADATA){j.currentTime=k}else{b.Event.bind(j,{loadedmetadata:function(l){l.target.currentTime=k}})}},mute:function(){var j=document.getElementById(this.id);j.muted=!j.muted},volume:function(j){var k=document.getElementById(this.id);k.volume=j/100},isPlaying:function(){return document.getElementById(this.id).currentTime!=0},canPlayExtension:function(j){var k=this.supportedMedia[j];if(typeof k==="undefined"){return false}return this.canPlayType(k)},canPlayType:function(l){var k=document.getElementById(this.id),j=k.canPlayType(l);return((j=="maybe")||(j=="probably"))},time:function(){var j=document.getElementById(this.id);return{current:j.currentTime,duration:j.duration}},offset:function(m,j){var k=document.getElementById(this.id),l=function(o){k.currentTime=m;var n=function(){if(k.currentTime>=j){k.pause();b.Event.unbind(k,{timeupdate:n})}};b.Event.unbind(k,{timeupdate:n})};if(k.readyState>=k.HAVE_METADATA){l()}else{b.Event.bind(k,{loadedmetadata:l})}}};this.bind({ended:c});var f={type:i.attribute("type")||{},formats:i.attribute("formats")||{},target:this.target,width:this.width,height:this.height,poster:this.poster,autoPlay:this.autoPlay,loop:this.loop,controls:this.controlsBar,muted:this.muted,keepRatio:this.keepRatio};b.Common.Function.proxy(function(){if(document.createElement(f.type).canPlayType){var l=document.createElement(f.type),j;for(var k in f.formats){j=l.canPlayType(f.formats[k]);if((j=="maybe")||(j=="probably")){this.players[k]=g}}}},this)();this.players.get=function(k){for(var j in k){if(this[j]){if(typeof this[j]==="function"){this[j]=new this[j](f)}return this[j]}}}};this.play=function(f){if(this.target.hasChildNodes()){if(this.player){if(this.player.supportedMedia.swf){swfobject.removeSWF(this.player.id)}else{if(this.player.supportedMedia.yt){swfobject.removeSWF(this.player.id)}else{this.target.removeChild(this.target.lastChild)}}}}var g=null;if(f){g=f;this.player=this.players.get(f.files);this.player.play(f);this.unbind({ended:c});this.bind({ended:d})}else{g=(this.sources.current()==null&&this.sources.length()!=0)?this.sources.next():this.sources.current();this.player=this.players.get(g.files);this.player.play(g)}this.fire({play:{source:g}})};this.stop=function(){this.player.stop();this.fire({stop:{}})};this.pause=function(){this.player.pause();this.fire({pause:{}})};this.restart=function(){this.player.restart();this.fire({restart:{}})};this.mute=function(){this.player.mute();this.fire({mute:{}})};this.volume=function(f){if(f&&f.volume){var g=typeof f.volume==="string"?parseInt(f.volume):f.volume;if(g>100){g=100}else{if(g<0){g=0}}this.player.volume(g);this.fire({volume:{volume:g}})}};this.skip=function(f){if(f&&f.skip){var g=typeof f.skip==="string"?parseInt(f.skip):f.skip;this.player.skip(g);this.fire({skip:{skip:g}})}};this.queue=function(f){if(f){this.sources.push(f);this.fire({queue:{sources:f}});if(this.autoPlay&&!this.isPlaying()){this.play()}}};this.unqueue=function(f){if(f){this.sources.remove(f);this.fire({unqueue:{source:f}})}};this.next=function(){var f=this.sources.next();this.play(f);this.fire({next:{source:f}})};this.previous=function(){var f=this.sources.previous();this.play(f);this.fire({previous:{source:f}})};this.time=function(){return{duration:this.duration,currentTime:this.currentTime}};this.isPlaying=function(){return !!this.player&&this.player.isPlaying()}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Audio",base:"Media",struct:function(){this.init=function(d,c){d.type="audio";d.muted=false;d.formats={mp3:"audio/mpeg",ogg:"audio/ogg",aac:"audio/mp4",wav:"audio/wav",pcm:"audio/webm"};this._super(d);if(typeof c!="undefined"&&d.name=="Audio"){c(this)}}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Poll",struct:function(){var m=function(p){var t=p.userId,r=p.key,q=p.id?b.StorageManager.getById(p.id):null,o="Polls";this.saveVote=function(v,u){q.incr({namespace:o,pair:{k:r+"#items#"+v+"#data",v:1}},function(w){if(!w.success){b.Console.error("There was an error while trying to increment the vote in the Storage.")}});q.incr({namespace:o,pair:{k:r+"#user#"+t,v:1}},function(w){if(!w.success){b.Console.error("There was an error while trying to increment the vote in the Storage.")}});k(t,f(t)+1)};this.getUserVotes=function(u){q.get({namespace:o,k:r+"#user#"+t},function(v){if(v.success){u(v.data.resultData?parseInt(v.data.resultData):0)}})};this.saveVoteItems=function(u){q.set({namespace:o,pair:{k:r+"#itemCount",v:u.length}},function(x){if(x.success){var w=[];for(var v=0;v<u.length;++v){w.push({k:r+"#items#"+v+"#id",v:u[v].id||v});w.push({k:r+"#items#"+v+"#name",v:u[v].name});w.push({k:r+"#items#"+v+"#data",v:u[v].data});if(typeof u[v].metadata!="undefined"){w.push({k:r+"#items#"+v+"#metadata",v:(typeof u[v].metadata=="object")?b.JSON.stringify(u[v].metadata):u[v].metadata})}}q.set({namespace:o,pairs:w},function(y){if(!y.success){b.Console.error("There was an error while trying to save the votes in the Storage.")}})}})};this.getVoteItems=function(u){q.get({namespace:o,k:r+"#itemCount"},function(y){var z=[];if(y.success){if(y.data.resultData!=null){var v=parseInt(y.data.resultData),x=[];for(var w=0;w<v;w++){x.push(r+"#items#"+w+"#id");x.push(r+"#items#"+w+"#name");x.push(r+"#items#"+w+"#data");x.push(r+"#items#"+w+"#metadata")}q.get({namespace:o,ks:x},function(D){if(D.success&&D.data.resultData!=null){if(D.data.resultData[0]!=null){for(var B=0;B<D.data.resultData.length;B=B+4){var C=(D.data.resultData[B+3]===null||typeof D.data.resultData[B+3]==="undefined")?a:D.data.resultData[B+3];try{C=b.JSON.parse(C)}catch(A){}z.push({id:D.data.resultData[B],name:D.data.resultData[B+1],data:parseInt(D.data.resultData[B+2]),metadata:C})}}u(z)}})}else{u(z)}}})}},l,j,n=function(o){this.id=o.id||0;this.name=o.name||"";this.data=b.Templating.observable(o.data||0);this.metadata=o.metadata||{}},i=function(o){b.Event.extend(this);var r=o.userId;var v=o.votesAllowed?b.Common.Converter.toNumber(o.votesAllowed):1;var t=b.Templating.observable(!!o.userVotes?Number(o.userVotes):0);this.canVote=b.Templating.observable(function(){return v>t()});var q=b.Common.Function.proxy(function(w){if(this.canVote()){t(t()+1);w.data(w.data()+1);j({action:"vote",data:{i:w.id}});if(l){l.saveVote(w.id)}else{k(r,t())}if(d){d.increment({index:w.id,incrementBy:1})}this.fire({ownervote:{item:w,allowed:this.canVote(),index:w.id}})}},this);this.voteValidation=b.Common.Function.parse(o.voteValidation);this.voteClick=b.Common.Function.proxy(function(x){if(this.voteValidation){var w=function(y){if(y){q(x)}};this.voteValidation({userId:r,item:{id:x.id,name:x.name}},w)}else{q(x)}},this);this.voteItems=new Array();for(var p=0;p<o.voteItems.length;++p){var u=o.voteItems[p];u.id=parseInt(p);if(typeof u.data==="undefined"||isNaN(u.data)){u.data=0}this.voteItems.push(new n(o.voteItems[p]))}this.vote=function(w){this.voteItems[w].data(this.voteItems[w].data()+1);if(d){d.increment({index:w,incrementBy:1})}this.fire({vote:{item:this.voteItems[w],allowed:true,index:w}})}},h,c=function(o){if(o.chartSettings){o.chartSettings.series=[];for(var r=0;r<h.voteItems.length;r++){o.chartSettings.series.push({name:h.voteItems[r].name,data:[h.voteItems[r].data()],metadata:h.voteItems[r].metadata})}b.TagManager.create({name:"Chart",type:"column",settings:o.chartSettings,chartingplatform:o.chartSettings.chartingPlatform?o.chartSettings.chartingPlatform:"highcharts"},b.Common.Function.proxy(function(u){d=u},this));if(typeof o.buttonsTemplate=="undefined"){var q=' <div class="xrtml-poll-buttons-container" data-bind="foreach: voteItems, visible: canVote()">';q+='        <a class="xrtml-poll-button" href="javascript:return false;" data-bind="click: $parent.voteClick">Vote</a>';q+="    </div>";q+='    <div class="xrtml-poll-buttons-container" data-bind="visible: !canVote()">';q+='        <span class="xrtml-poll-message">Cannot vote again.</span>';q+="    </div>";o.buttonsTemplate="xrtml-poll-buttons-template";b.Templating.inject({id:o.buttonsTemplate,content:q})}var p=document.createElement("div");p.setAttribute("class","xRTML-Poll-Buttons-Container-Target");o.targetNode.appendChild(p);b.Templating.applyBindings({node:p,binding:{template:{name:o.buttonsTemplate,data:o.model}}})}else{if(typeof o.template=="undefined"){var q='<div class="xrtml-poll" id="xRTML-Poll_'+this.id+'">';q+='    <div class="xrtml-poll-values-container">';q+='        <div class="graph" data-bind="foreach: voteItems">';q+='            <span class="xRTML-Poll-Value" data-bind="text: data"></span>';q+="        </div>";q+="    </div>";q+='    <div class="xrtml-poll-labels-container" data-bind="foreach: voteItems">';q+='        <label class="xrtml-poll-label"data-bind="text: name"></label>';q+="    </div>";q+='    <div class="xrtml-poll-buttons-container" data-bind="foreach: voteItems, visible: canVote()">';q+='        <a class="xrtml-poll-button" href="javascript:return false;" data-bind="click: $parent.voteClick">Vote</a>';q+="    </div>";q+='    <div class="xrtml-poll-buttons-container" data-bind="visible: !canVote()">';q+='        <span class="xrtml-poll-message">Cannot vote again.</span>';q+="    </div>";q+="</div>";o.template="xrtml-poll-template";b.Templating.inject({id:o.template,content:q})}b.Templating.applyBindings({node:o.targetNode,binding:{template:{name:o.template,data:o.model,afterRender:b.Common.Function.proxy(function(){this.fire({render:{}})},this)}}})}h.bind({vote:b.Common.Function.parse(o.onVote),ownervote:b.Common.Function.parse(o.onOwnerVote),render:b.Common.Function.parse(o.onRender)});h.bind({vote:b.Common.Function.proxy(function(t){this.fire({vote:t})},this),ownervote:b.Common.Function.proxy(function(t){this.fire({ownervote:t})},this),render:b.Common.Function.proxy(function(t){this.fire({render:t})},this)})},g=function(o){var p;if(localStorage&&(window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf("ipad")<0)){p=localStorage.getItem("d734h89nU_"+o)||(localStorage.setItem("d734h89nU_"+o,b.Common.Util.idGenerator(),localStorage.getItem("d734h89nU_"+o)))}else{p=b.Common.Cookie.getCookie({name:"d734h89nU_"+o})||(b.Common.Cookie.setCookie({name:"d734h89nU_"+o,expiry:new Date(new Date().getTime()+315576000000)}),b.Common.Cookie.getCookie({name:"d734h89nU_"+o}))}return p},f=function(o){var p;if(localStorage&&(window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf("ipad")<0)){p=localStorage.getItem("d734h89nV_"+o)||0}else{p=b.Common.Cookie.getCookie({name:"d734h89nV_"+o})||0}return p},k=function(p,o){if(localStorage&&(window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf("ipad")<0)){localStorage.setItem("d734h89nV_"+p,o)}else{b.Common.Cookie.setCookie({name:"d734h89nV_"+p,value:o})}},d;this.init=function(q,o){this._super(q);if(this.storage){this.storage.userId=(q.attribute("userId")||g(this.id));l=new m(this.storage)}var u=this.template=q.attribute("template"),r=this.target[0];if(!r){if(typeof u!="undefined"){var t=b.Sizzle("#"+u)[0];r=t.parentNode.insertBefore(document.createElement("div"),t)}else{b.Error.raise({code:b.Error.Codes.TAG_INVALID_CONFIG,target:this,info:{message:"Either a target or a template must be defined."}})}}this.votesAllowed=q.attribute("votesAllowed")||1;var v=q.attribute("voteItems");var p=q.attribute("chartSettings");if(l){l.getUserVotes(b.Common.Function.proxy(function(w){l.getVoteItems(b.Common.Function.proxy(function(x){h=this.model=new i({voteItems:(x&&x.length>0)?x:(l.saveVoteItems(v),v),votesAllowed:this.votesAllowed,userVotes:w,userId:g(this.id),voteValidation:q.attribute("voteValidation")});c.call(this,{targetNode:r,model:h,template:u,buttonsTemplate:q.attribute("buttonsTemplate"),onVote:q.attribute("onVote"),onOwnerVote:q.attribute("onOwnerVote"),onRendered:q.attribute("onRendered"),chartSettings:p})},this))},this))}else{h=this.model=new i({voteItems:v,votesAllowed:this.votesAllowed,userVotes:f(q.attribute("userId")||g(this.id)),userId:g(this.id),voteValidation:q.attribute("voteValidation")});c.call(this,{targetNode:r,model:h,template:u,buttonsTemplate:q.attribute("buttonsTemplate"),onVote:q.attribute("onVote"),onOwnerVote:q.attribute("onOwnerVote"),onRendered:q.attribute("onRendered"),chartSettings:p})}j=b.Common.Function.proxy(function(w){this.sendMessage(w)},this);if(typeof o!="undefined"&&q.name=="Poll"){o(this)}};this.vote=function(o){h.vote(o.i)}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Shoutbox",struct:function(){var j=function(l){if(typeof l!="undefined"){this.id=l.id?l.id:b.Common.Util.guidGenerator();this.name=typeof l.name!="undefined"&&l.name!=""?b.Templating.observable(l.name):b.Templating.observable("Write a username...");this.logged=typeof l.logged!="undefined"?b.Templating.observable(l.logged):b.Templating.observable(false)}else{this.id=b.Common.Util.guidGenerator();this.name=b.Templating.observable("Write a username...");this.logged=b.Templating.observable(false)}this.isTyping=b.Templating.observable(false)};var g=function(l){this.content=l.content;this.name=l.name;this.date=l.date?new Date(l.date):new Date().toString()};var i=function(l){b.Event.extend(this);this.shoutboxContainer=l.shoutboxContainer;var m=b.Common.DOM.getStyle({element:this.shoutboxContainer,rule:"display"});this.owner=new j();this.messages=b.Templating.observable([]);this.users=b.Templating.observable([]);if(l.userData){this.owner.id=l.userData.id;this.owner.name(l.userData.name);this.owner.logged(true);this.users.push(this.owner);this.fire({sendMessage:{action:"userLogin",data:{id:this.owner.id,name:this.owner.name(),logged:true,isTyping:false}}});this.fire({userLogin:{user:{id:this.owner.id,name:this.owner.name(),logged:true,isTyping:false}}})}this.messageContent=b.Templating.observable("");this.logIn=function(){if(this.owner.name()!=""&&this.owner.name()!="Write a username..."){var o=b.Common.Util.guidGenerator();this.owner.id=o;this.owner.logged(true);this.users.push(this.owner);b.Common.Cookie.setCookie({name:c,value:b.JSON.stringify({id:this.owner.id,name:this.owner.name()})});if(f){f.fire({userLogin:{user:{id:this.owner.id,name:this.owner.name(),logged:true,isTyping:false}}})}this.fire({userLogin:{user:{id:this.owner.id,name:this.owner.name(),logged:true,isTyping:false}}});this.fire({sendMessage:{action:"userLogin",data:{id:this.owner.id,name:this.owner.name(),logged:true}}})}return true};this.logOut=function(){this.owner.logged(false);b.Common.Cookie.deleteCookie({name:c});if(f){f.fire({userLogout:{user:{id:this.owner.id,name:this.owner.name(),logged:true,isTyping:false}}})}this.fire({userLogout:{user:{id:this.owner.id,name:this.owner.name(),logged:false,isTyping:false}}});this.fire({sendMessage:{action:"userLogout",data:{id:this.owner.id,name:this.owner.name(),logged:false,isTyping:false}}});this.owner.name("Write a username...");return true};this.getUserById=function(p){var q=this.users();for(var o=0;o<q.length;++o){if(q[o].id==p){return q[o]}}return null};this.newUser=function(o){var p=this.getUserById(o.id);if(p!=null){p=new j(o)}else{this.users.push(new j(o))}};this.removeUser=function(o){this.users.remove(function(p){return p.id==o})};this.usersTyping=b.Templating.observable(b.Common.Function.proxy(function(){var r="";var q=this.users();if(q.length==0){return""}for(var o=0;o<q.length;o++){var p=q[o];if(p.id!=this.owner.id&&p.isTyping()){r+=p.name()+", "}}return r!=""?r.slice(0,r.length-2):""},this));this.newMessage=function(o){this.messages.push(o);if(b.Common.DOM.getStyle({element:this.shoutboxContainer,rule:"display"})=="none"){this.show()}};this.sendMessage=function(o){if(this.messageContent().length>0){var p=new g({name:o.name||this.owner.name(),content:o.content||this.messageContent()});this.newMessage(p);this.fire({sendMessage:{action:"post",data:p}});if(f){f.fire({messagePost:{message:p}})}this.fire({messagePost:{message:p}});this.messageContent("")}};var n=false;this.sendTypingMessage=function(){if(n!=this.owner.isTyping()){n=!n;this.fire({sendMessage:{action:"typing",data:{id:this.owner.id,name:this.owner.name(),logged:true,typing:this.owner.isTyping()}}});this.fire({userTyping:{user:{id:this.owner.id,name:this.owner.name(),logged:true,typing:this.owner.isTyping()}}})}};this.getUserIndexById=function(p){var q=this.users();for(var o=0;o<q.length;++o){if(q[o].id==p){return o}}};this.setUserTyping=function(o){var p=this.getUserById(o.id);if(p){p.isTyping(o.typing);this.fire({userTyping:{user:{id:p.id,name:p.name(),logged:true,typing:p.isTyping()}}})}};this.close=function(){this.shoutboxContainer.style.display="none";this.fire({close:{}});return true};this.show=function(){this.shoutboxContainer.style.display=m;this.fire({show:{}})};this.initialData=l.initialData};var k=function(){var m;var n;var o=null;var l;return{init:function(r,t,p,u,q){n=parseInt(t());m=u.owner;l=u;b.Event.bind(r,{keypress:function(v){var w=v?v:event;var x=w.keyCode?w.keyCode:w.which?w.which:w.charCode;if(x==13&&!w.shiftKey){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}l.sendMessage({name:m.name(),content:l.messageContent()});m.isTyping(false);clearTimeout(o);l.sendTypingMessage();return true}m.isTyping(true);if(o!=null){clearTimeout(o)}o=setTimeout(function(){m.isTyping(false);o=null;l.sendTypingMessage()},n);return true},keydown:function(v){var w=v?v:event;var x=w.keyCode?w.keyCode:w.which?w.which:w.charCode;if(x==8||x==46){m.isTyping(l.messageContent().length>0);if(o!=null){clearTimeout(o)}o=setTimeout(function(){m.isTyping(false);o=null},n);if(x==13&&!w.shiftKey){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}}}return true},keyup:function(v){var x=v?v:event;var y=x.keyCode?x.keyCode:x.which?x.which:x.charCode;var w=x.srcElement?x.srcElement:x.target;if(y==13&&!x.shiftKey){w.value=""}l.messageContent(w.value);if(y==8||y==46){m.isTyping(l.messageContent().length>0);if(o!=null){clearTimeout(o);o=null}o=setTimeout(function(){m.isTyping(false);o=null},n)}l.sendTypingMessage();return true}})}}};var d=function(l){b.Event.extend(this);var m=b.StorageManager.getById(l.id),n=l.key;this.getAndUpdateUsers=function(){m.get({namespace:"Shoutbox",k:n+"#usersCount"},function(q){if(Number(q.data.resultData)){var p=[];for(var o=1;o<=Number(q.data.resultData);o++){p.push(n+"#users#"+o)}m.get({namespace:"Shoutbox",ks:p},function(u){if(u.data.resultData){for(var r=0,t=u.data.resultData.length;r<t;r++){if(u.data.resultData[r]!=null){h.newUser(b.JSON.parse(u.data.resultData[r]))}}}})}})};this.getAndUpdateMessages=function(){m.get({namespace:"Shoutbox",k:n+"#messagesCount"},function(t){if(t.data.resultData){var q=[];for(var o=1;o<=Number(t.data.resultData);o++){q.push(n+"#messages#"+o)}m.get({namespace:"Shoutbox",ks:q},function(w){if(w.data.resultData){for(var u=0,v=w.data.resultData.length;u<v;u++){h.newMessage(new g(b.JSON.parse(w.data.resultData[u])))}}})}else{if(b.Common.Array.isArray(h.initialData)){for(var o=0;o<h.initialData.length;++o){var p=h.initialData[o];var r=new g({name:p.name,content:p.content,data:p.data});h.newMessage(r);f.addMessage(r)}}}})};this.addUser=function(o){m.incr({namespace:"Shoutbox",pair:{k:n+"#usersCount",v:1}},function(p){m.set({namespace:"Shoutbox",pair:{k:n+"#users#"+p.data.resultData,v:b.JSON.stringify(o)}},function(q){})})};this.removeUser=function(o){m.get({namespace:"Shoutbox",k:n+"#usersCount"},function(p){m.del({namespace:"Shoutbox",k:n+"#users#"+(h.getUserIndexById(o)+1)},function(q){});m.incr({namespace:"Shoutbox",pair:{k:n+"#usersCount",v:-1}},function(q){})})};this.addMessage=function(o){m.incr({namespace:"Shoutbox",pair:{k:n+"#messagesCount",v:1}},function(p){m.set({namespace:"Shoutbox",pair:{k:n+"#messages#"+p.data.resultData,v:b.JSON.stringify(o)}},function(q){})})}};var h;var c;var f;this.init=function(q,m){this._super(q);b.Templating.bindingHandlers.userTypingBinding=new k();this.template=q.attribute("template");if(!this.template){var o=' <div class="xrtml-shoutbox">';o+='        <div class="xrtml-shoutbox-close" data-bind="click: close">X</div>';o+='        <div class="xrtml-shoutbox-notificationcontainer" data-bind="visible: usersTyping().length > 0">';o+='            <span class="xrtml-shoutbox-notificationcontainer-userstypinglabel">Users typing: </span>';o+='            <span class="xRTML-Shoutbox-NotificationContainer-UsersTyping" data-bind="text: usersTyping()"></span>';o+="        </div>";o+='        <div class="xrtml-shoutbox-shoutscontainer" data-bind="template: { name: \'xrtml-shouts-template\', foreach: messages }"></div>';o+='        <div class="xrtml-shoutbox-loginform" data-bind="visible: !owner.logged()">';o+='            <input class="xrtml-shoutbox-loginform-username" type="text" data-bind="value: owner.name"></input>';o+='            <input class="xrtml-shoutbox-loginform-login" type="button" value="Log In" data-bind="click: logIn"></input>';o+="        </div>";o+='        <div class="xrtml-shoutbox-shoutform" data-bind="visible: owner.logged()">';o+='            <label class="xrtml-shoutbox-shoutform-usernamelabel" data-bind="text: owner.name()"></label>';o+='            <textarea class="xrtml-shoutbox-shoutform-shoutcontent" data-bind="value: messageContent, userTypingBinding: 3000 " rows="1" cols="50"></textarea>';o+='            <input class="xrtml-shoutbox-shoutform-send" type="button" value="Send" data-bind="click: sendMessage"></input>';o+='            <input class="xrtml-shoutbox-shoutform-logout" type="button" value="Log Out" data-bind="click: logOut"></input>';o+="        </div>";o+="    </div>";this.template="xrtml-shoutbox-template";b.Templating.inject({id:this.template,content:o})}this.initialData=q.attribute("initialData");if(this.storage){f=new d(this.storage);f.bind({requestData:function(){f.getAndUpdateUsers();f.getAndUpdateMessages()},messagePost:b.Common.Function.proxy(function(t){f.addMessage(t.message)},this),userLogin:function(t){f.addUser(t.user)},userLogout:function(t){f.removeUser(t.user.id)}});this.bind({postInit:function(){f.fire({requestData:{}})}})}else{b.Console.debug("Tag "+this.name+" "+this.id+": Storage was not configured. The data will not be persistent.")}var r=b.Common.Function.parse;this.bind({message:r(q.attribute("onMessage")),messagePost:r(q.attribute("onMessagePost")),userLogin:r(q.attribute("onUserLogin")),userLogout:r(q.attribute("onUserLogout")),userTyping:r(q.attribute("onUserTyping")),close:r(q.attribute("onClose")),show:r(q.attribute("onShow"))});c="xRTMLShoutbox-"+this.id;var n=b.Common.Cookie.getCookie({name:c});var l={shoutboxContainer:this.target[0],initialData:this.initialData};if(n){l.userData=b.JSON.parse(n)}h=this.model=new i(l);h.bind({sendMessage:b.Common.Function.proxy(function(t){this.sendMessage(t)},this),messagePost:b.Common.Function.proxy(function(t){this.fire({messagePost:{message:t.message}})},this),userLogin:b.Common.Function.proxy(function(t){this.fire({userLogin:{user:t.user}})},this),userLogout:b.Common.Function.proxy(function(t){this.fire({userLogout:{user:t.user}})},this),userTyping:b.Common.Function.proxy(function(t){this.fire({userTyping:{user:t.user}})},this),close:b.Common.Function.proxy(function(t){this.fire({close:{}})},this),show:b.Common.Function.proxy(function(t){this.fire({show:{}})},this)});try{b.Templating.applyBindings({node:this.target[0],binding:{template:{name:this.template,data:h}}})}catch(p){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:p.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}if(typeof m!="undefined"&&q.name=="Shoutbox"){m(this)}};this.post=function(l){try{h.newMessage(new g(l))}catch(m){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:m.message,className:"xRTML.Tags."+this.name,methodName:"post"}})}this.fire({message:{message:l}})};this.userLogin=function(l){var n=new j(l);try{h.newUser(n)}catch(m){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:m.message,className:"xRTML.Tags."+this.name,methodName:"login"}})}this.fire({userLogin:{user:{id:n.id,isTyping:n.isTyping(),logged:n.logged(),name:n.name(),isTyping:false}}})};this.userLogout=function(m){var n=h.getUserById(m.id);try{h.removeUser(m.id)}catch(l){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:l.message,className:"xRTML.Tags."+this.name,methodName:"logout"}})}if(n!=null){this.fire({userLogout:{user:{id:n.id,isTyping:n.isTyping(),logged:n.logged(),name:n.name(),isTyping:false}}})}};this.typing=function(m){var n=h.getUserById(m.id);if(n==null){h.newUser({id:m.id,name:m.name,logged:true})}try{h.setUserTyping(m)}catch(l){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:l.message,className:"xRTML.Tags."+this.name,methodName:"typing"}})}var n=h.getUserById(m.id)};this.login=function(l){if(!h.owner||(h.owner&&h.owner.logged())){return}h.owner.id=l.id;h.owner.name(l.name);h.owner.logged(true);h.users.push(h.owner);b.Common.Cookie.setCookie({name:c,value:b.JSON.stringify({id:h.owner.id,name:h.owner.name()})});h.fire({sendMessage:{action:"userLogin",data:{id:h.owner.id,name:h.owner.name(),logged:true,isTyping:false}}});this.fire({userLogin:{user:{id:h.owner.id,name:h.owner.name(),logged:true,isTyping:false}}});return};this.logout=function(){if(!h.owner||(h.owner&&!h.owner.logged())){return}h.owner.logged(false);b.Common.Cookie.deleteCookie({name:c});if(f){f.fire({userLogout:{user:h.owner}})}h.fire({sendMessage:{action:"userLogout",data:{id:h.owner.id}}});h.owner.name("Write a username...");return};this.show=function(){h.show()};this.close=function(){h.close()};this.dispose=function(){b.Common.Cookie.deleteCookie({name:c});while(this.target[0].firstChild){this.target[0].removeChild(this.target[0].firstChild)}this._super()}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Video",base:"Media",struct:function(){this.init=function(d,c){this.poster=d.attribute("poster")||null;this.keepRatio=typeof d.attribute("keepRatio")=="undefined"?true:b.Common.Converter.toBoolean(d.attribute("keepRatio"));d.type="video";d.formats={mp4:"video/mp4",ogg:"video/ogg",webm:"video/webm",avi:"video/divx"};d.keepRatio=this.keepRatio;d.poster=this.poster;this._super(d);var f=this;this.players.yt=function(g){b.Event.extend(this);this.id="ytplayer"+b.Common.Util.idGenerator();this.config=g;this.supportedMedia={yt:true};this.player=null;var i=this;window.onYouTubePlayerReady=function(j){i.player=document.getElementById(j);i.player.addEventListener("onStateChange","onYouTubePlayerStateChange");f.dispatchEvent("onYouTubePlayerReady",{playerId:j})};function h(j){f.fire({loadedmetadata:{event:j,target:i}})}this.bind({loadedmetadata:h,flashNotAvailable:function(){if(b.Sizzle("#flashnotavailable",f.target).length==0){var j=document.createElement("a");j.setAttribute("id","flashnotavailable");j.setAttribute("href",window.location.protocol+"//www.adobe.com/go/getflashplayer");j.setAttribute("target","_blank");var k=document.createElement("img");k.setAttribute("src",window.location.protocol+"//www.adobe.com/images/shared/download_buttons/get_flash_player.gif");k.setAttribute("alt","Get Adobe Flash player");j.appendChild(k);f.target.appendChild(j)}}});window.onYouTubePlayerStateChange=function(j){switch(j){case -1:f.dispatchEvent("unstarted");break;case 0:f.dispatchEvent("ended");break;case 1:f.dispatchEvent("playing");break;case 2:f.dispatchEvent("paused");break;case 3:f.dispatchEvent("buffering");break;case 5:f.dispatchEvent("videocued");break}}};this.players.yt.prototype={play:function(j){j.files.yt=j.files.yt.replace(/^[^v]+v.(.{11}).*/,"$1");var i="?autoplay=1";i+="&loop="+(!!this.config.loop||!!j.loop?"1":"0");i+="&controls="+(!!this.config.controls||!!j.controls?"1":"0");i+="&showinfo=0";i+="&enablejsapi=1&playerapiid="+this.id+"&version=3";if(typeof swfobject==="undefined"){b.Common.DOM.loadScripts(f.resources.swfobject,b.Common.Function.proxy(function(){if(swfobject.getFlashPlayerVersion().major==0){this.fire({flashNotAvailable:{}});return}var k=document.createElement("span");k.id=this.id;f.target.appendChild(k);var l=b.Common.Function.proxy(function(m){this.fire({loadedmetadata:m})},this);swfobject.embedSWF(window.location.protocol+"//www.youtube.com/v/"+j.files.yt+i,this.id,!!this.config.width?this.config.width:"425",!!this.config.height?this.config.height:"356","8",null,null,{allowScriptAccess:"always"},{allowfullscreen:"true"},l)},this))}else{if(swfobject.getFlashPlayerVersion().major==0){this.fire({flashNotAvailable:{}});return}var g=document.createElement("span");g.id=this.id;f.target.appendChild(g);var h=b.Common.Function.proxy(function(k){this.fire({loadedmetadata:k})},this);swfobject.embedSWF(window.location.protocol+"//www.youtube.com/v/"+j.files.yt+i,this.id,!!this.config.width?this.config.width:"425",!!this.config.height?this.config.height:"356","8",null,null,{allowScriptAccess:"always"},{allowfullscreen:"true"},h)}},stop:function(){if(!this.isPlaying()){return}this.player.stopVideo()},pause:function(){this.isPlaying()?this.player.pauseVideo():this.player.playVideo()},restart:function(){this.player.seekTo(0)},skip:function(g){this.player.seekTo(g,true)},mute:function(){this.player.isMuted()?this.player.unMute():this.player.mute()},volume:function(g){this.player.setVolume(g)},isPlaying:function(){if(this.player.getPlayerState){return this.player!=null&&this.player.getPlayerState()==1}return true},canPlayExtension:function(){},canPlayType:function(g){return g==="yt"},time:function(){return{current:this.player.getCurrentTime(),duration:this.player.getDuration()}},offset:function(){}};if(typeof c!="undefined"&&d.name=="Video"){c(this)}}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Execute",struct:function(){this.init=function(d,c){this._super(d);this.callback=b.Common.Function.parse(d.attribute("callback"),"message");if(typeof c!="undefined"&&d.name=="Execute"){c(this)}};this.process=function(d){var c=typeof d!="undefined"&&d.callback?b.Common.Function.parse(d.callback,"data"):this.callback;(typeof c=="function")?c(d):b.Error.raise({code:b.Error.Codes.TAG_PROCESS,target:this,info:{message:'The property "callback" is not defined in the Tag nor in the message.',className:"xRTML.Tags."+this.name,methodName:"process"}})}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Toast",struct:function(){var f=function(h){var g=(function(){var k={};k.box=function(){var o,q,l,n,t,r=0;return{show:function(m){t={opacity:70,close:1,animate:1,fixed:1,mask:1,maskid:"",boxid:"",topsplit:2,url:0,post:0,height:0,width:0,html:0,iframe:0};for(s in m){t[s]=m[s]}if(!r){o=document.createElement("div");o.className="xrtml-toast-banner";r=document.createElement("div");r.className="xrtml-toast-banner-loading";l=document.createElement("div");l.className=m.bannerContentClass;q=document.createElement("div");q.className="xrtml-toast-banner-mask";n=document.createElement("div");n.className="xrtml-toast-banner-close";n.v=0;document.body.appendChild(q);document.body.appendChild(o);o.appendChild(r);r.appendChild(l);q.onclick=n.onclick=function(){k.box.hide("CloseBanner")};window.onresize=k.box.resize}else{o.style.display="none";clearTimeout(r.ah);if(n.v){r.removeChild(n);n.v=0}}r.id=t.boxid;q.id=t.maskid;o.style.position=t.fixed?"fixed":"absolute";if(t.html&&!t.animate){r.style.backgroundImage="none";l.innerHTML=t.html;l.style.display="";r.style.width=t.width?t.width+"px":"auto";r.style.height=t.height?t.height+"px":"auto"}else{l.style.display="none";if(!t.animate&&t.width&&t.height){r.style.width=t.width+"px";r.style.height=t.height+"px"}else{r.style.width=r.style.height="100px"}}if(t.mask){this.mask();this.alpha(q,1,t.opacity)}else{this.alpha(o,1,100)}if(t.autohide){r.ah=setTimeout(function(){k.box.hide("TimeOut")},1000*t.autohide)}else{document.onkeyup=k.box.esc}},fill:function(p,A,z,m,B,v){if(A){if(t.image){var y=new Image();y.onload=function(){B=B||y.width;v=v||y.height;k.box.psh(y,m,B,v)};y.src=t.image}else{if(t.iframe){this.psh('<iframe src="'+t.iframe+'" width="'+t.width+'" frameborder="0" height="'+t.height+'"></iframe>',m,B,v)}else{var C=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");C.onreadystatechange=function(){if(C.readyState==4&&C.status==200){r.style.backgroundImage="";k.box.psh(C.responseText,m,B,v)}};if(z){C.open("POST",p,true);C.setRequestHeader("Content-type","application/x-www-form-urlencoded");C.send(z)}else{C.open("GET",p,true);C.send(null)}}}}else{this.psh(p,m,B,v)}},psh:function(p,m,v,u){if(typeof p=="object"){l.appendChild(p)}else{l.innerHTML=p}var z=r.style.width,A=r.style.height;if(!v||!u){r.style.width=v?v+"px":"";r.style.height=u?u+"px":"";l.style.display="";if(!u){u=parseInt(l.offsetHeight)}if(!v){v=parseInt(l.offsetWidth)}l.style.display="none"}r.style.width=z;r.style.height=A;this.size(v,u,m)},esc:function(m){m=m||window.event;if(m.keyCode==27){k.box.hide("CloseBanner")}},hide:function(m){if(b.Sizzle("#xrtml-video-ytplayer").length>0){swfobject.removeSWF("xrtml-video-ytplayer")}clearTimeout(r.ah);k.box.alpha(o,-1,0,3);document.onkeypress=null;if(t.closejs){t.closejs(m)}b.Sizzle(".xrtml-toast-banner")[0].parentNode.removeChild(b.Sizzle(".xrtml-toast-banner")[0]);b.Sizzle(".xrtml-toast-banner-mask")[0].parentNode.removeChild(b.Sizzle(".xrtml-toast-banner-mask")[0])},resize:function(){k.box.pos();k.box.mask()},mask:function(){q.style.height=this.total(1)+"px";q.style.width=this.total(0)+"px"},pos:function(){var m;if(typeof t.top!="undefined"){m=t.top}else{m=(this.height()/t.topsplit)-(o.offsetHeight/2);m=m<20?20:m}if(!t.fixed&&!t.top){m+=this.top()}o.style.top=m+"px";o.style.left=typeof t.left!="undefined"?t.left+"px":(this.width()/2)-(o.offsetWidth/2)+"px"},alpha:function(u,p,m){clearInterval(u.ai);if(p){u.style.opacity=0;u.style.filter="alpha(opacity=0)";u.style.display="block";k.box.pos()}u.ai=setInterval(function(){k.box.ta(u,m,p)},20)},ta:function(u,m,p){var w=Math.round(u.style.opacity*100);if(w==m){clearInterval(u.ai);if(p==-1){u.style.display="none";u==o?k.box.alpha(q,-1,0,2):l.innerHTML=r.style.backgroundImage=""}else{if(u==q){this.alpha(o,1,100)}else{o.style.filter="";k.box.fill(t.html||t.url,t.url||t.iframe||t.image,t.post,t.animate,t.width,t.height)}}}else{var v=m-Math.floor(Math.abs(m-w)*0.5)*p;u.style.opacity=v/100;u.style.filter="alpha(opacity="+v+")"}},size:function(v,p,m){if(m){clearInterval(r.si);var x=parseInt(r.style.width)>v?-1:1,u=parseInt(r.style.height)>p?-1:1;r.si=setInterval(function(){k.box.ts(v,x,p,u)},20)}else{r.style.backgroundImage="none";if(t.close){r.appendChild(n);n.v=1}r.style.width=v+"px";r.style.height=p+"px";l.style.display="";this.pos();if(t.openjs){t.openjs()}}},ts:function(x,y,u,v){var p=parseInt(r.style.width),m=parseInt(r.style.height);if(p==x&&m==u){clearInterval(r.si);r.style.backgroundImage="none";l.style.display="block";if(t.close){r.appendChild(n);n.v=1}if(t.openjs){t.openjs()}}else{if(p!=x){r.style.width=(x-Math.floor(Math.abs(x-p)*0.6)*y)+"px"}if(m!=u){r.style.height=(u-Math.floor(Math.abs(u-m)*0.6)*v)+"px"}this.pos()}},top:function(){return document.documentElement.scrollTop||document.body.scrollTop},width:function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},height:function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},total:function(p){var m=document.body,u=document.documentElement;return p?Math.max(Math.max(m.scrollHeight,u.scrollHeight),Math.max(m.clientHeight,u.clientHeight)):Math.max(Math.max(m.scrollWidth,u.scrollWidth),Math.max(m.clientWidth,u.clientWidth))}}}();b.Event.extend(this);var j=function(n){tyniboxObj={autohide:n.bannerAutoHide,animate:true,closejs:function(o){c.bannerActive=false;c.fire({bannerClose:{target:n,info:o}})},bannerContentClass:(function(o){return !o.destinationUrl?"xrtml-toast-banner-content":"xrtml-toast-banner-content-clickable"})(n)};if(n.bannerWidth){tyniboxObj.width=n.bannerWidth}if(n.bannerHeight){tyniboxObj.height=n.bannerHeight}switch(n.bannerType){default:case"image":tyniboxObj.image=n.bannerUrl;break;case"html":tyniboxObj.html=n.bannerContent;break;case"iframe":tyniboxObj.iframe=n.bannerUrl;case"flash":var l='<object type="application/x-shockwave-flash" data="'+n.bannerUrl+'"';if(n.bannerWidth){l+='width="'+n.bannerWidth+'"'}if(n.bannerHeight){l+='height="'+n.bannerHeight+'"'}l+='><param name="movie" value="'+n.bannerUrl+'" />';l+="</object>";tyniboxObj.html=l;break;case"video":if(typeof n.bannerSource!="undefined"){if(b.Common.Array.contains({items:b.TagManager.getClasses(),obj:"Video"})){var l='<div id="xrtml-toast-banner-videocontainer"';var m="";if(n.bannerWidth){m+="width:"+n.bannerWidth+"px;"}else{m+="width: 400px;"}if(n.bannerHeight){m+="height:"+n.bannerHeight+"px;"}else{m+="height: 400px;"}if(m!=""){l+='style="'+m+'"'}l+="></div>";tyniboxObj.html=l;tyniboxObj.openjs=b.Common.Function.proxy(function(){var p={name:"Video",id:"toast-video-tag",controlsBar:false,target:"#xrtml-toast-banner-videocontainer",width:this.bannerWidth||400,height:this.bannerHeight||400,keepRatio:false};b.TagManager.create(p);var o=b.TagManager.getById("toast-video-tag");o.play(n.bannerSource);c.fire({bannerDisplay:{target:n}})},n);tyniboxObj.closejs=b.Common.Function.proxy(function(){c.bannerActive=false;b.TagManager.getById("toast-video-tag").dispose();c.fire({bannerClose:{target:n}})},n)}else{b.Console.error("The xRTML video tag must be added in order to create video banners.")}}break}k.box.show(tyniboxObj)};var i=function(l){k.box.hide(l)};return{show:j,hide:i}})();this.id=b.Common.Util.idGenerator();this.title=h.title;this.text=h.text;this.displayToast=h.displayToast;this.displayBanner=h.displayBanner;this.timeToLive=h.timeToLive;this.bannerType=h.bannerType;this.bannerUrl=h.bannerUrl;this.bannerContent=h.bannerContent;this.bannerWidth=h.bannerWidth;this.bannerHeight=h.bannerHeight;this.bannerAutoHide=h.bannerAutoHide;this.destinationUrl=h.destinationUrl;this.bannerSource=h.bannerSource;this.metaData=h.metaData;this.close=function(i){if(typeof i!="string"){c.destroy(this,"CloseButton")}else{c.destroy(this,i)}clearTimeout(this.timeoutReference)};this.showBanner=function(){if(this.displayToast){this.close("ShowBanner")}if(this.displayBanner){c.bannerActive=true;g.show(this);c.fire({bannerDisplay:{target:this}});var l=b.Sizzle(".xrtml-toast-banner * :not(.xrtml-toast-banner-close)");var j=b.Common.Function.proxy(function(){g.hide("OpenUrl");this.openUrl();for(var m=0;m<l.length;m++){b.Event.unbind(l[m],{click:j})}},this);for(var k=0;k<l.length;k++){b.Event.bind(l[k],{click:j})}}else{this.openUrl()}};if(this.displayToast){this.timeoutReference=setTimeout(b.Common.Function.proxy(function(){this.close("TimeOut")},this),this.timeToLive)}this.openUrl=function(){if(this.destinationUrl){window.open(this.destinationUrl,"_blank");c.fire({urlOpen:{target:this}})}}};var d=function(){b.Event.extend(this);this.toasts=b.Templating.observable(new Array());this.create=function(g){var h=new f(g);if(g.displayToast){if(g.index=="end"){this.toasts.push(h)}else{this.toasts.splice(0,0,h)}this.fire({toastDisplay:{target:h}})}else{h.showBanner()}};this.destroy=function(h,g){this.toasts.remove(h);this.fire({toastClose:{target:h,info:g}})};this.bannerActive=false};var c=null;this.init=function(k,g){this._super(k);this.positionAt=k.attribute("positionAt");this.mediaUrls=k.attribute("mediaUrls");if(typeof this.mediaUrls!="undefined"){if(b.Common.Array.contains({items:b.TagManager.getClasses(),obj:"Audio"})){this.audioNotificationTag=b.TagManager.create({name:"Audio",controlsbar:false})}else{b.Console.error("The xRTML Audio tag must be added in order to play audio notifications.")}}this.effects=k.attribute("effects");b.Effect.extend(this);c=this.model=new d();this.toastContainer;if(this.target[0].tagName=="BODY"){this.toastContainer=document.createElement("div");this.toastContainer.setAttribute("id","xRTML-Toast-target");document.body.appendChild(this.toastContainer)}else{this.toastContainer=this.target[0]}this.template=k.attribute("template");if(!this.template){var h=' <div class="xrtml-toast" data-bind="attr: { id: id }">';h+='        <div class="xrtml-toast-close" data-bind="click: close">X</div>';h+="        <div data-bind=\"click: showBanner, css: { 'xrtml-toast-content': !destinationUrl && !displayBanner , 'xrtml-toast-content-clickable': !!destinationUrl || displayBanner }\">";h+='            <h3 class="xrtml-toast-content-title" data-bind="text: title"></h3>';h+='            <span class="xrtml-toast-content-message" data-bind="text: text"></span>';h+="        </div>";h+="    </div>";this.template="xRTML-Toast-Template";b.Templating.inject({id:this.template,content:h})}try{b.Templating.applyBindings({node:this.toastContainer,binding:{template:{name:this.template,foreach:c.toasts,afterRender:b.Common.Function.proxy(function(n,m){for(var o=0;o<n.length;o++){if(n[o].nodeName!="#text"){this.runEffects({element:n[o]})}}},this)}}})}catch(i){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:i.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}var j=(function(n){var m=n.toastContainer;m.style.position="fixed";switch(n.positionAt){case"topleft":m.style.top=15+"px";m.style.left=15+"px";break;case"topright":m.style.top=15+"px";m.style.right=15+"px";break;case"bottomleft":m.style.bottom=30+"px";m.style.left=15+"px";break;case"bottomright":default:m.style.bottom=30+"px";m.style.right=15+"px";break}})(this);var l=b.Common.Function.parse;this.bind({toastDisplay:l(k.attribute("onToastDisplay")),toastClose:l(k.attribute("onToastClose")),bannerDisplay:l(k.attribute("onBannerDisplay")),bannerClose:l(k.attribute("onBannerClose")),urlOpen:l(k.attribute("onUrlOpen"))});c.bind({toastDisplay:b.Common.Function.proxy(function(m){this.fire({toastDisplay:m})},this),toastClose:b.Common.Function.proxy(function(m){this.fire({toastClose:m})},this),bannerDisplay:b.Common.Function.proxy(function(m){this.fire({bannerDisplay:m})},this),bannerClose:b.Common.Function.proxy(function(m){this.fire({bannerClose:m})},this),urlOpen:b.Common.Function.proxy(function(m){this.fire({urlOpen:m})},this)});if(typeof g!="undefined"&&k.name=="Toast"){g(this)}};this.process=function(i){var g={title:typeof i.title!="undefined"?i.title:"",text:typeof i.text!="undefined"?i.text:"",destinationUrl:typeof i.destinationUrl!="undefined"?i.destinationUrl:false,timeToLive:i.timeToLive||10000,displayToast:typeof i.displayToast!="undefined"?i.displayToast:true,displayBanner:typeof i.displayBanner!="undefined"?i.displayBanner:true,metaData:i.metaData,bannerUrl:i.bannerUrl,bannerContent:i.bannerContent,bannerType:i.bannerType,bannerSource:i.bannerSource,bannerHeight:b.Common.Converter.toNumber(i.bannerHeight),bannerWidth:b.Common.Converter.toNumber(i.bannerWidth),bannerAutoHide:typeof i.bannerAutoHide!="undefined"?(b.Common.Converter.toNumber(i.bannerAutoHide)/1000):false};if(this.positionAt=="topleft"||this.positionAt=="topright"){g.index="begin"}else{g.index="end"}if(c.bannerActive){var h=b.Common.Function.proxy(function(){this.unbind({bannerClose:h});this.process(i)},this);this.bind({bannerClose:h})}else{try{c.create(g)}catch(j){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:j.message,className:"xRTML.Tags."+this.name,methodName:"process"}})}if(typeof this.audioNotificationTag!="undefined"){this.audioNotificationTag.play({source:this.mediaUrls})}}}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Broadcast",struct:function(){var c=function(d){b.Event.extend(this);var l,j=0;this.senderId=d.attribute("senderId");this.target=b.Sizzle(d.attribute("target"));this.event=d.attribute("event");this.xrtmlmessage=d.attribute("xrtmlmessage");this.callback=b.Common.Function.parse(d.attribute("callback"));this.interval=d.attribute("interval");this.limit=d.attribute("limit")||0;this.messageSource=b.Sizzle(d.attribute("messageSource"));this.messageAttribute=d.attribute("messageAttribute");var k=d.attribute("onMessage");if(k){this.bind({message:k})}this.dispatchMessage=function(){var q=[];if(this.messageSource.length>0){for(var p=0;p<this.messageSource.length;p++){var m={};if(typeof this.messageAttribute!="undefined"){m[this.messageAttribute]=b.Common.String.trim(this.messageSource[p][this.messageAttribute])}else{m.content=b.Common.String.trim(this.messageSource[0].value)}var r={trigger:"",action:"",data:m,senderId:this.senderId};q.push(b.MessageManager.create(r))}}if(this.callback!=null){try{var r=this.callback();if(typeof r=="undefined"||b.MessageManager.isValid(r)){b.Error.raise({code:b.Error.Codes.INVALID_MESSAGE,target:this,info:{message:"Callbak didn't return a xRTML message."}})}else{r.senderId=typeof r.senderId=="undefined"?this.senderId:r.senderId;q.push(r)}}catch(n){b.Error.raise({code:b.Error.Codes.UNEXPECTED,target:this,info:{message:n.toString()}})}}if(this.xrtmlmessage){try{var r=b.JSON.parse(this.xrtmlmessage).xrtml;q.push(b.MessageManager.create({trigger:r.trigger,action:r.action,data:r.data,senderId:this.id}))}catch(o){b.Error.raise({code:b.Error.Codes.JSON_PARSE,target:this,info:{className:"xRTML.Tags."+this.name,methodName:"dispatchMessage"}})}}for(var p=0;p<q.length;++p){if(j==this.limit&&this.limit>0){clearInterval(l);return}this.fire({message:q[p]});j++}};if(this.target&&this.event){try{var g={};g[this.event]=b.Common.Function.proxy(this.dispatchMessage,this);for(var h=0;h<this.target.length;h++){b.Event.bind(this.target[h],g)}}catch(f){b.Error.raise({code:b.Error.Codes.NON_EXISTING_ELEMENT,target:this,info:{className:"xRTML.Tags."+this.name,methodName:"dispatchMessage"}})}}else{if(this.interval>0){l=setInterval(b.Common.Function.proxy(this.dispatchMessage,this),this.interval)}else{this.dispatchMessage()}}};this.init=function(h,d){this._super(h);b.Common.Validator.validateRequired({target:this,prop:"channelId"});b.Common.Validator.validateRequired({target:this,prop:"connections"});this.receiveOwnMessages=false;var f=h.attribute("dispatchers");for(var g=0;g<f.length;++g){f[g].attribute=h.attribute;f[g].senderId=this.id;f[g].onMessage=b.Common.Function.proxy(this.sendMessage,this);new c(f[g])}if(typeof d!="undefined"&&h.name=="Broadcast"){d(this)}}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Placeholder",struct:function(){this.init=function(f,c){this._super(f);this.template=f.attribute("template");if(!this.template){b.Console.error("Placeholder tag requires one and only one xrtml:template tag.")}this.initialData=f.attribute("initialData");if(typeof this.initialData!="undefined"){try{b.Templating.applyBindings({node:this.target[0],binding:{template:{name:this.template,data:this.initialData}}})}catch(d){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:d.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}}if(typeof c!="undefined"&&f.name=="Placeholder"){c(this)}};this.insert=function(c){try{b.Templating.applyBindings({node:this.target[0],binding:{template:{name:this.template,data:c}}})}catch(d){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:d.message,className:"xRTML.Tags."+this.name,methodName:"insert"}})}}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Grid",struct:function(){var h=this.Slot=function(i){this.parent=i.parent;this.slotStates={empty:"empty",marked:"marked",disabled:"disabled"};this.index=i.index;this.row=i.row;this.column=i.column;this.owner=typeof i.owner=="undefined"?i.owner:null;this.metadata=typeof i.metadata!="undefined"?i.metadata:null;this.sizzleSelector=b.Templating.observable(b.Common.Function.proxy(function(){return"."+this.parent+"-slot-"+this.row+"-"+this.column},this));this.state=typeof i.state=="undefined"?this.slotStates.empty:this.slotStates[i.state];this.state=b.Templating.observable(this.state);this.slotClass=b.Templating.observable(b.Common.Function.proxy(function(){switch(this.state()){case"marked":var j=" marked";if(this.owner==f.owner){return j+" owned"}return j;case"disabled":return" disabled";case"empty":default:return""}},this));this.action=function(j){switch(this.state()){case"disabled":break;case"marked":f.cancel(this);break;case"empty":f.mark(this);break}return true}};var g=this.Model=function(i){var j=b.Common.Util.idGenerator();b.Event.extend(this);this.owner=i.owner;var k=0;var l=i.markingLimit;var m=false;this.enable=i.enable;this.allowCancel=i.allowCancel;this.initialData=i.initialData;this.slots=b.Templating.observable(new Array());this.mark=function(o){if(this.enable){if(b.Common.Array.isArray(o)){var p=[];for(var n=0;n<o.length;n++){var q=false;if(o[n].state()!=o[n].slotStates.disabled&&o[n].state()!=o[n].slotStates.marked){if((l==0||k<l)){k++;o[n].owner=this.owner;o[n].state(o[n].slotStates.marked);b.Sizzle(o[n].sizzleSelector())[0].className+=o[n].slotClass();if(d!=null){d.updateSlot(o[n])}q=true;p.push(o[n])}}f.fire({ownMark:{target:o[n],success:q}})}if(p.length>0){f.fire({sendMessage:{action:"mark",data:p,sendOnly:true}})}}else{var q=false;if(o.state()!=o.slotStates.disabled){if((l==0||k<l)){k++;o.owner=this.owner;o.state(o.slotStates.marked);b.Sizzle(o.sizzleSelector())[0].className+=o.slotClass();if(d!=null){d.updateSlot(o)}q=true;f.fire({sendMessage:{action:"mark",data:o,sendOnly:true}})}}f.fire({ownMark:{target:o,success:q}})}}};this.cancel=function(o){if(this.enable&&this.allowCancel){if(b.Common.Array.isArray(o)){var p=[];for(var n=0;n<o.length;n++){if(this.owner==o[n].owner){k--;o[n].state(o[n].slotStates.empty);o[n].owner=null;b.Sizzle(o[n].sizzleSelector())[0].className=b.Sizzle(o[n].sizzleSelector())[0].className.replace("marked","");b.Sizzle(o[n].sizzleSelector())[0].className=b.Sizzle(o[n].sizzleSelector())[0].className.replace("owned","");if(d!=null){d.updateSlot(o[n])}f.fire({ownCancel:{target:o[n],success:true}});p.push(o[n])}}if(p.length>0){f.fire({sendMessage:{action:"cancel",data:p,sendOnly:true}})}}else{var q=false;if(this.owner==o.owner){k--;o.state(o.slotStates.empty);o.owner=null;b.Sizzle(o.sizzleSelector())[0].className=b.Sizzle(o.sizzleSelector())[0].className.replace("marked","");b.Sizzle(o.sizzleSelector())[0].className=b.Sizzle(o.sizzleSelector())[0].className.replace("owned","");if(d!=null){d.updateSlot(o)}f.fire({sendMessage:{action:"cancel",data:o,sendOnly:true}});q=true}f.fire({ownCancel:{target:o,success:q}})}}};this.getSlot=function(n){return this.slots()[n.row][n.column]};this.getMarkCount=function(){return Number(k)};this.buildSlots=function(t,o){if(this.slots().length==0){var q=0;for(var p=0;p<t;p++){var n=new Array();for(var r=0;r<o;r++){n.push(new h({row:p,column:r,index:q,parent:j}));q++}this.slots.push(n)}}};this.populateInitialData=function(r){if(!m){for(var o=0,p=r.length;o<p;o++){var q=this.slots()[r[o].row][r[o].column];q.owner=r[o].owner;q.state(r[o].state);if(r[o].metadata){try{q.metadata=b.JSON.parse(r[o].metadata)}catch(n){q.metadata=r[o].metadata}}if(q.owner&&this.owner==q.owner){k++}b.Sizzle(q.sizzleSelector())[0].className+=q.slotClass()}if(d){d.markSlots(this.slots())}m=true}};this.populateStorageData=function(r){if(!m){for(var o=0,p=r.length;o<p;o++){var q=this.slots()[r[o].row][r[o].column];q.owner=r[o].owner;q.state(r[o].state);if(r[o].metadata){try{q.metadata=b.JSON.parse(r[o].metadata)}catch(n){q.metadata=r[o].metadata}}if(q.owner&&this.owner==q.owner){k++}b.Sizzle(q.sizzleSelector())[0].className+=q.slotClass()}m=true}};this.setMetadata=function(n){var o=this.getSlot(n);o.metadata=n.metadata;if(d!=null){d.updateSlot(o)}f.fire({sendMessage:{action:"updateMetadata",data:{row:o.row,column:o.column,metadata:o.metadata},sendOnly:true}});f.fire({ownUpdateMetadata:{target:o}})};this.init=function(){if(d!=null){d.getAll()}else{this.buildSlots(this.initialData.rows,this.initialData.columns);var n=this.initialData.data;this.populateInitialData(n)}}};var f;var d=null;var c=function(i){b.Event.extend(this);var j=b.StorageManager.getById(i.id);var k=i.key;this.markSlots=function(q){var n=[];var p=0;for(var l=0;l<q.length;l++){for(var m=0;m<q[l].length;m++){var o={row:q[l][m].row,column:q[l][m].column,owner:q[l][m].owner,state:q[l][m].state()};if(q[l][m].metadata){o.metadata=typeof q[l][m].metadata=="string"?q[l][m].metadata:b.JSON.stringify(q[l][m].metadata)}var r=b.JSON.stringify(o);n.push({k:k+"#markedSlots#"+q[l][m].index,v:r});p++}}j.incr({namespace:"Grid",pair:{k:k+"#markedSlotsCount",v:p}},function(t){});j.set({namespace:"Grid",pairs:n},function(t){if(!t.success){b.Console.error("There was an error while trying to save the slots in the Storage.")}})};this.updateSlot=function(m){var l={row:m.row,column:m.column,owner:m.owner,state:m.state()};if(m.metadata){l.metadata=typeof m.metadata=="string"?m.metadata:b.JSON.stringify(m.metadata)}var n=b.JSON.stringify(l);j.set({namespace:"Grid",pair:{k:k+"#markedSlots#"+m.index,v:n}},function(o){})};this.getAll=function(){var n=0;var l=0;var m=[k+"#rows",k+"#columns"];j.get({namespace:"Grid",ks:m},function(r){n=r.data.resultData[0]==null?null:Number(r.data.resultData[0]);l=r.data.resultData[1]==null?null:Number(r.data.resultData[1]);if(n==null||l==null){if(f.initialData&&f.initialData.rows&&f.initialData.columns){n=f.initialData.rows;l=f.initialData.columns;d.saveDimensions(n,l);f.buildSlots(n,l);f.populateInitialData(f.initialData.data)}else{b.Console.error("Could not find the dimensions of the Grid in the storage. Also the initialData does not contains the properties rows and columns.")}}else{f.buildSlots(n,l);var o=(n*l)-1;if((o+1)>100){j.get({namespace:"Grid",k:k+"#markedSlotsCount"},function(w){if(!Number(w.data.resultData)){return}else{var x=Number(w.data.resultData);var v=0;var u=0;var t=function(){var z=[];for(var y=u;y<=(u+100);y++){z.push(k+"#markedSlots#"+y)}j.get({namespace:"Grid",ks:z},function(C){if(C.data.resultData){var E=[];for(var A=0,B=C.data.resultData.length;A<B;A++){var D=b.JSON.parse(C.data.resultData[A]);if(D!=null){E.push(D);v++}}f.populateStorageData(E);if(v<x){u=u+100;t()}}})};t()}})}else{var q=[];for(var p=0;p<=o;p++){q.push(k+"#markedSlots#"+p)}j.get({namespace:"Grid",ks:q},function(v){if(v.data.resultData){var x=[];for(var t=0,u=v.data.resultData.length;t<u;t++){var w=b.JSON.parse(v.data.resultData[t]);if(w!=null){x.push(w)}}f.populateStorageData(x)}})}}})};this.saveDimensions=function(m,l){j.set({namespace:"Grid",pair:{k:k+"#rows",v:m}},function(n){});j.set({namespace:"Grid",pair:{k:k+"#columns",v:l}},function(n){})}};this.init=function(l,i){this._super(l);this.owner=l.attribute("owner");if(typeof this.owner=="undefined"){b.Error.raise({code:b.Error.Codes.TAG_INVALID_CONFIG,target:this,info:{message:"The tag requires a owner ID."}});return}this.markingLimit=l.attribute("markingLimit");this.markingLimit=(this.markingLimit==null||typeof this.markingLimit=="undefined")?0:Number(this.markingLimit);this.enable=typeof l.attribute("enable")!="undefined"?b.Common.Converter.toBoolean(l.attribute("enable")):true;this.allowCancel=typeof l.attribute("allowCancel")!="undefined"?b.Common.Converter.toBoolean(l.attribute("allowCancel")):true;this.template=l.attribute("template");b.Templating.bindingHandlers.slotClick={init:b.Common.Function.proxy(function(p,q,n,r,o){p.className+=" "+r.parent+"-slot-"+r.row+"-"+r.column;if(r.state()=="marked"||r.state()=="disabled"){p.className+=r.slotClass()}b.Event.bind(p,{click:function(){q().call(r,p)}})},this),update:function(p,q,n,r,o){}};if(!this.template){var j=' <div class="xrtml-grid-slots" data-bind="foreach: slots">';j+='        <div data-bind="foreach: $data">';j+='            <input class="xrtml-grid-slots-slot" type="button" data-bind="slotClick: action" />';j+="        </div>";j+="    </div>";this.template="xrtml-grid-template";b.Templating.inject({id:this.template,content:j})}this.initialData=l.attribute("initialData");if(this.storage){d=new c(this.storage)}this.Slot=h;this.model=f=new g({initialData:this.initialData,owner:this.owner,markingLimit:this.markingLimit,enable:this.enable,allowCancel:this.allowCancel});var m=b.Common.Function.parse;this.bind({ownCancel:m(l.attribute("onOwnCancel")),ownMark:m(l.attribute("onOwnMark")),cancel:m(l.attribute("onCancel")),mark:m(l.attribute("onMark")),updateMetadata:m(l.attribute("onUpdateMetadata")),ownUpdateMetadata:m(l.attribute("onOwnUpdateMetadata"))});this.model.bind({sendMessage:b.Common.Function.proxy(function(n){this.sendMessage(n)},this),ownCancel:b.Common.Function.proxy(function(n){this.fire({ownCancel:n})},this),ownMark:b.Common.Function.proxy(function(n){this.fire({ownMark:n})},this),cancel:b.Common.Function.proxy(function(n){this.fire({cancel:n})},this),mark:b.Common.Function.proxy(function(n){this.fire({mark:n})},this),ownUpdateMetadata:b.Common.Function.proxy(function(n){this.fire({ownUpdateMetadata:n})},this),updateMetadata:b.Common.Function.proxy(function(n){this.fire({updateMetadata:n})},this)});try{b.Templating.applyBindings({node:this.target[0],binding:{template:{name:this.template,data:this.model}}})}catch(k){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:k.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}this.model.init();if(typeof i!="undefined"&&l.name=="Grid"){i(this)}};this.mark=function(j){if(b.Common.Array.isArray(j)){for(var k=0;k<j.length;k++){var l=this.model.getSlot(j[k]);l.owner=j[k].owner;l.state(l.slotStates.marked);b.Sizzle(l.sizzleSelector())[0].className+=" marked";f.fire({mark:{target:l,success:true}})}}else{var l=this.model.getSlot(j);l.owner=j.owner;l.state(l.slotStates.marked);b.Sizzle(l.sizzleSelector())[0].className+=" marked";f.fire({mark:{target:l,success:true}})}};this.cancel=function(j){if(b.Common.Array.isArray(j)){for(var k=0;k<j.length;k++){var l=this.model.getSlot(j[k]);l.owner=null;l.state(l.slotStates.empty);b.Sizzle(l.sizzleSelector())[0].className=b.Sizzle(l.sizzleSelector())[0].className.replace("marked","");f.fire({cancel:{target:l,success:true}})}}else{var l=this.model.getSlot(j);l.owner=null;l.state(l.slotStates.empty);b.Sizzle(l.sizzleSelector())[0].className=b.Sizzle(l.sizzleSelector())[0].className.replace("marked","");f.fire({cancel:{target:l,success:true}})}};this.updateMetadata=function(j){if(b.Common.Array.isArray(j)){for(var k=0;k<j.length;k++){var l=this.getSlot(j[k]);l.metadata=j[k].metadata;f.fire({updateMetadata:{target:l}})}}else{var l=this.getSlot(j);l.metadata=j.metadata;f.fire({updateMetadata:{target:l}})}};this.getSlot=function(i){return f.getSlot(i)};this.markSlot=function(i){f.mark(i)};this.cancelSlot=function(i){f.cancel(i)};this.setMetadata=function(i){f.setMetadata(i)};this.markCount=function(){return f.getMarkCount()};this.dispose=function(){while(this.target[0].firstChild){this.target[0].removeChild(this.target[0].firstChild)}this._super()}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Chart",struct:function(){var h=function(l){try{b.Event.extend(this);this.title=l.title?l.title.text:null;this.subTitle=l.subTitle?l.subTitle.text:null;this.series=b.Templating.observable(new Array());this.dataValuesTotal=b.Templating.observable(b.Common.Function.proxy(function(){var o=0;for(var n=0;n<this.series().length;n++){o+=(this.series()[n].value()||this.series()[n].value()[0])}return o},this));this.updateSerie=function(n,o){this.series()[n].value(o);this.fire({serieUpdate:{serie:this.series()[n],index:n}})};this.updateSeries=function(o){this.series(new Array());for(var n=0;n<o.length;n++){this.series.push(new j({name:o[n].name,value:o[n].data[0]||o[n].data,type:o[n].type},this.dataValuesTotal))}this.fire({seriesUpdate:{series:this.series()}})};this.incrementSerie=function(o,n){var p=this.series()[o].value();b.Common.Array.isArray(p)?p[0]=(p[0]+n):p=p+n;this.series()[o].value(p);this.fire({serieUpdate:{serie:this.series()[o],index:o}})};if(l.series){this.updateSeries(l.series)}}catch(m){b.Error.raise({code:b.Error.Codes.UNEXPECTED,info:{className:"xRTML.Tags.Chart",methodName:"init",message:m.message}})}},j=function(l,m){this.name=l.name;this.value=b.Templating.observable(l.value);this.type=l.type;this.percentage=b.Templating.observable(b.Common.Function.proxy(function(){return this.value()/m()*100},this))},g,f={column:{update:function(l){d.series[l.index].data[0].update(parseInt(l.value()))},add:function(l){d.series.push(l.serie)}},pie:{update:function(l){d.series[0].data[l.index].update([l.name,l.value()])},add:function(l){d.series.push(l.serie)}}},d,i=function(n,p){g=this.model=new h(this.settings);if(this.chartingPlatform=="highcharts"){var q=b.Common.Function.proxy(function(){if(!this.settings.chart.events){this.settings.chart.events={}}this.settings.chart.events.load=b.Common.Function.proxy(function(){this.fire({rendered:{}})},this);d=new Highcharts.Chart(this.settings);var r=b.Sizzle('svg text tspan:contains("Highcharts") , svg text tspan:contains("Highstock")');if(r){for(var t=0,u=r.length;t<u;t++){r[t].style.display="none"}}this.bind({serieUpdate:b.Common.Function.proxy(function(v){f[this.type].update({index:v.index,name:v.serie.name,value:v.serie.value})},this),seriesUpdate:b.Common.Function.proxy(function(v){var x=[];for(var w=0;w<v.series.length;w++){x.push({type:v.series[w].type,name:v.series[w].name,data:[v.series[w].value()]})}this.settings.series=x;d=new Highcharts.Chart(this.settings)},this)});if(typeof n!="undefined"&&p=="Chart"){n(this)}},this);if(window.jQuery){if(window.Highcharts){q()}else{b.Common.DOM.loadScripts(this.resources.highcharts,function(){q()})}}else{if(!window.Highcharts){b.Common.DOM.loadScripts([this.resources.jquery,this.resources.highcharts],function(){q()})}else{b.Common.DOM.loadScripts(this.resources.jquery,function(){q()})}}}else{if(!this.template){var l=' <div class="xrtml-chart">';l+='        <h1 class="xrtml-chart-title" data-bind="text:title"></h1>';l+='        <h2 class="xrtml-chart-subtitle" data-bind="text:subTitle"></h2>';l+='        <div class="xrtml-chart-values">';l+='            <ul class="xrtml-chart-graph" data-bind="foreach: series">';l+="                <li><span data-bind=\"text:value, style:{ paddingTop: (percentage()*2)+'px' }\"></span></li>";l+="            </ul>";l+="        </div>";l+='        <div class="xrtml-chart-items">';l+='            <strong class="xrtml-chart-items-title">Items</strong>';l+='            <ul class="xrtml-chart-items-names" data-bind="foreach: series">';l+='                <li><span data-bind="text:name"></span></li>';l+="            </ul>";l+='            <ul class="xrtml-chart-items-percentages" data-bind="foreach: series">';l+="                <li><span data-bind=\"text:Math.round( percentage() * Math.pow(10,0))/Math.pow(10,0)+'%'\"></span></li>";l+="            </ul>";l+="        </div>";l+="    </div>";this.template="xrtml-chart-template";b.Templating.inject({id:"xrtml-chart-template",content:l});this.templates.push({name:"xrtml-chart-template",target:this.targetElement})}try{for(var o=0;o<this.templates.length;o++){b.Templating.applyBindings({node:typeof this.templates[o].target=="string"?b.Sizzle(this.templates[o].target)[0]:this.templates[o].target[0],binding:{template:{name:this.templates[o].name,data:g,afterRender:b.Common.Function.proxy(function(t,r){this.fire({rendered:{}})},this)}}})}}catch(m){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:m.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}this.bind({serieUpdate:b.Common.Function.proxy(function(r){this.runEffects({element:b.Sizzle(this.valuesTarget)[r.index]})},this)})}},c=function(l){g.bind({serieUpdate:b.Common.Function.proxy(function(m){this.fire({serieUpdate:m})},this),seriesUpdate:b.Common.Function.proxy(function(m){this.fire({seriesUpdate:m})},this)});g.bind({serieUpdate:b.Common.Function.parse(l.onSerieUpdate),seriesUpdate:b.Common.Function.parse(l.onSeriesUpdate),rendered:b.Common.Function.parse(l.onRendered)})},k;this.init=function(n,l){this._super(n);this.effects=n.attribute("effects");b.Effect.extend(this);this.settings=n.attribute("settings");this.targetElement=(this.settings&&this.settings.chart&&this.settings.chart.renderTo)?b.Sizzle("#"+this.settings.chart.renderTo)[0]:(!!n.attribute("target")?this.target[0]:b.Sizzle("#"+args.template)[0].parentNode.insertBefore(document.createElement("div"),b.Sizzle("#"+args.template)[0]));this.valuesTarget=n.attribute("valuesTarget")||".values li span";this.type=n.attribute("type")?n.attribute("type"):((this.settings&&this.settings.chart&&this.settings.chart.type)?this.settings.chart.type:((this.settings&&this.settings.series&&this.settings.series[0].type)?this.settings.series[0].type:null));this.chartingPlatform=typeof n.attribute("chartingPlatform")!="undefined"?n.attribute("chartingPlatform"):"htmlchart";this.template=n.attribute("template");if(this.storage){k=b.StorageManager.getById(this.storage.id)}var m={onSerieUpdate:n.attribute("onSerieUpdate"),onSeriesUpdate:n.attribute("onSeriesUpdate"),onRendered:n.attribute("onRendered")};if(!this.resources.jquery){this.registerResources([{name:"jquery",src:window.location.protocol+"//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"}])}if(!this.resources.highcharts){this.registerResources([{name:"highcharts",src:window.location.protocol+"//code.highcharts.com/2.1.6/highcharts.js"}])}if(k){k.get({namespace:"Charts",k:this.storage.key+"#settings"},b.Common.Function.proxy(function(o){if(o.success){this.settings=b.JSON.parse(o.data.resultData);i.call(this,l,n.name);c.call(this,m)}},this))}else{i.call(this,l,n.name);c.call(this,m)}};this.increment=function(l){g.incrementSerie(l.index,l.incrementBy)};this.update=function(l){g.updateSerie(l.index,l.value)};this.updateSeries=function(l){g.updateSeries(l.series)}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Repeater",struct:function(){var f=function(i,h){this.maxItems=i;if(h){this.Items=b.Templating.observable((new Array()).concat(h))}else{this.Items=b.Templating.observable(new Array())}this.add=function(j,k,l){if(this.Items().length==this.maxItems){this.remove((!l)?this.Items().length-1:l)}if(k===-1){this.Items.push(j)}else{this.Items.splice(k,0,j)}};this.update=function(j,k){if(k<this.Items().length){this.remove(k);this.add(j,k,-1)}};this.remove=function(j){if(j==-1||j>this.Items().length){j=this.Items().length-1}this.Items.splice(j,1)}};this.model=a;var g=function(h){if((!isNaN(parseInt(h)))&&isFinite(h)&&h>=0){return h}return a};var d=function(i,h){if((!isNaN(parseFloat(i)))&&isFinite(i)&&i>=0){return parseInt(i)}return h};var c=function(i,h){var k=d(i,a);if(k){return k}var j={begin:0,end:-1};return j.hasOwnProperty(i)?j[i]:h};this.init=function(j,h){this._super(j);this.template=j.attribute("template");b.Common.Validator.validateRequired({target:this,prop:"template"});this.effects=j.attribute("effects");b.Effect.extend(this);this.index=c(j.attribute("index"),0);this.removeIndex=c(j.attribute("removeIndex"),-1);this.maxItems=d(j.attribute("maxItems"),Number.POSITIVE_INFINITY);this.initialData=j.attribute("initialData");if(b.Common.Array.isArray(this.initialData)){this.model=new f(this.maxItems,this.initialData)}else{this.model=new f(this.maxItems)}try{b.Templating.applyBindings({node:this.target[0],binding:{template:{name:this.template,foreach:this.model.Items,afterRender:b.Common.Function.proxy(function(l,k){for(var m=0;m<l.length;m++){if(l[m].nodeName!="#text"){this.runEffects({element:l[m]})}}},this)}}})}catch(i){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:i.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}if(typeof h!="undefined"&&j.name=="Repeater"){h(this)}};this.insert=function(h){try{this.model.add(h.content,c(h.index,this.index),c(h.removeIndex,this.removeIndex))}catch(i){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:i.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}};this.update=function(h){try{this.model.update(h.content,c(h.index,this.index))}catch(i){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:i.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}};this.remove=function(h){try{this.model.remove(c(h.removeIndex,this.removeIndex))}catch(i){b.Error.raise({code:b.Error.Codes.TEMPLATING,target:this,info:{message:i.message,className:"xRTML.Tags."+this.name,methodName:"init"}})}}}})})(window.xRTML=window.xRTML||{});(function(b,a){b.TagManager.register({name:"Videochat",struct:function(){var h;var i=function(k){var A=function(C){this.camera=C.camera||{width:264,height:198};this.streamId=C.streamId;this.isConnected=b.Templating.observable(false)},n=b.Common.Cookie,t=b.Common.Function.proxy,o,v;this.hasSession=b.Templating.observable(false);this.apiKey=k.apiKey||b.Console.error("Tag Videochat "+this.id+": An api key is required for a TokBox provider.");this.token=k.token;this.sessionId=k.sessionId;this.timeToLive=k.timeToLive||3600000;this.role=k.role;this.owner=new A({camera:k.camera});this.users=b.Templating.observable([]);this.usersCount=0;this.scriptUrl=k.scriptUrl;if(k.role==g.moderator){this.serviceUrl=k.serviceUrl||b.Console.error("Tag Videochat "+this.id+": The service url is mandatory.")}function j(C){var D=new A({streamId:C.streamId,camera:k.camera});this.users.push(D);v.subscribe(C,C.streamId)}function u(D){var E=v.getSubscribersForStream(D);for(var C=0;C<E.length;C++){v.unsubscribe(E[C])}this.users.remove(function(F){return F.streamId==D.streamId})}function w(D){this.owner.isConnected(true);for(var E=0;E<D.streams.length;E++){j.call(this,D.streams[E])}var F=TB.initPublisher(this.apiKey,"opentok_publisher",this.owner.camera);F.addEventListener("accessAllowed",t(function(G){this.fire({accessAllowed:{}})},this));F.addEventListener("accessDenied",t(function(G){this.fire({accessDenied:{}})},this));v.publish(F);var C=b.JSON.parse(n.getCookie({name:c}));C.isConnected=this.owner.isConnected();n.setCookie({name:c,value:b.JSON.stringify(C)});this.fire({connect:{sessionId:this.sessionId,token:this.token}})}function x(D){D.preventDefault();v.cleanup();this.owner.isConnected(false);this.users.removeAll();var C=b.JSON.parse(n.getCookie({name:c}));C.isConnected=this.owner.isConnected();n.setCookie({name:c,value:b.JSON.stringify(C)});this.fire({disconnect:{sessionId:this.sessionId,token:this.token}})}function y(C){for(var D=0;D<C.streams.length;D++){if(C.streams[D].connection.connectionId!=C.target.connection.connectionId){j.call(this,C.streams[D]);this.fire({userPublish:{stream:C.streams[D]}})}}}function z(C){for(var D=0;D<C.streams.length;D++){u.call(this,C.streams[D]);this.fire({userUnpublish:{stream:C.streams[D]}})}}function l(C){this.usersCount+=C.connections.length}function m(C){this.usersCount-=C.connections.length}var p=function(C){b.Common.Request.get({url:this.serviceUrl+"/createsession",data:{timeToLive:this.timeToLive},success:t(function(E){var D=b.JSON.parse(E).CreateSessionResult;D.expireTime=new Date(D.expireTime);C(D)},this),crossDomain:true})};this.generateToken=function(C){if(this.hasSession()){var D=b.JSON.parse(n.getCookie({name:c})),E=new Date(D.expireTime);b.Common.Request.get({url:this.serviceUrl+"/generatetoken",data:{sessionId:this.sessionId,role:g.publisher,expireTime:E.toGMTString()},success:t(function(H){var G=b.JSON.parse(H).GenerateTokenResult;G.sessionId=this.sessionId;G.expireTime=D.expireTime;C(G)},this),crossDomain:true})}else{this.startSession();var F=t(function(G){this.generateToken(C);this.unbind({sessionStart:F})},this);this.bind({sessionStart:F})}};this.startSession=function(C){if(C&&C.sessionId&&C.token){v=TB.initSession(C.sessionId);v.addEventListener("sessionConnected",t(w,this));v.addEventListener("sessionDisconnected",t(x,this));v.addEventListener("streamCreated",t(y,this));v.addEventListener("streamDestroyed",t(z,this));v.addEventListener("connectionCreated",t(l,this));v.addEventListener("connectionDestroyed",t(m,this));this.sessionId=C.sessionId;this.token=C.token;this.usersCount=0;this.hasSession(true);this.fire({sessionStart:{sessionId:this.sessionId}})}else{if(this.role==g.publisher||this.role==g.subscriber){h.sendMessage({trigger:"vc_moderator_trigger",action:"connect",data:{id:h.internalId}})}else{p.call(this,(t(function(E){var D=E.expireTime;E.expireTime=E.expireTime.toGMTString();n.setCookie({name:c,value:b.JSON.stringify(E),expires:D});this.startSession(E)},this)))}}};this.endSession=function(){if(this.owner.isConnected()){var C=t(function(){this.endSession();this.unbind({disconnect:C})},this);this.bind({disconnect:C});v.disconnect()}else{this.sessionId=null;this.token=null;this.hasSession(false);v=null;n.deleteCookie({name:c});this.fire({sessionEnd:{sessionId:this.sessionId}})}};this.connect=function(C){if(!this.hasSession()){this.bind({sessionStart:this.connect});this.startSession(C)}else{v.connect(this.apiKey,this.token)}};this.disconnect=function(){v.disconnect()};var B=function(){return{init:function(){},update:function(E,H,C,I,D){var G=H();var F=document.createElement("div");F.setAttribute("id",G.streamId);E.appendChild(F)}}},r=function(){return{init:function(){},update:function(E,G,C,H,D){if(H.owner.isConnected()){var F=document.createElement("div");F.setAttribute("id","opentok_publisher");E.appendChild(F)}}}},q=function(){TB.addEventListener("exception",t(function(E){this.fire({exception:{code:E.code,message:E.message}})},this));if(TB.checkSystemRequirements()!=TB.HAS_REQUIREMENTS){b.Console.error("You don't have the minimum requirements to run this application. Please upgrade to the latest version of Flash.")}b.Templating.bindingHandlers.usersBinding=new B();b.Templating.bindingHandlers.ownerBinding=new r();var C=n.getCookie({name:c});if(C){var D=b.JSON.parse(C);if(new Date(D.expireTime)>new Date()){this.startSession(D);if(D.isConnected){this.connect()}}else{b.Console.log("Session "+D.sessionId+" has expired. Removing cookie.");n.deleteCookie({name:c})}}this.fire({ready:{}})};if(!window.TB){b.Console.debug("Tag Videochat: Loading provider API...");b.Common.DOM.loadScripts(this.scriptUrl,t(function(){b.Console.debug("Tag Videochat: Provider API has been loaded...");q.call(this)},this))}else{q.call(this)}},g={moderator:"moderator",publisher:"publisher",subscriber:"subscriber"},d={provider:{tokBox:i},create:function(j){if(!this.provider[j.name]){b.Console.error("Tag Videochat "+this.id+": Provider "+j.name+" not recognized.")}var k=new this.provider[j.name](j);b.Event.extend(k);return k}};var f=[],c="xRTML-Videochat";this.init=function(n,k){this._super(n);this.template=n.attribute("template");this.role=n.attribute("role")||g.publisher;var l=n.attribute("provider");l.camera=n.attribute("camera");l.role=this.role;if(!this.resources.opentok){this.registerResources([{name:"opentok",src:document.location.protocol=="https:"?"https://swww.tokbox.com/v1.1/js/TB.min.js":"http://static.opentok.com/v1.1/js/TB.min.js"}])}l.scriptUrl=this.resources.opentok;this.model=d.create(l);this.model.bind({ready:b.Common.Function.proxy(function(){if(typeof k!="undefined"&&n.name=="Videochat"){k(this)}},this)});if(this.role==g.moderator){this.maxUsers=n.attribute("maxUsers")||2;this.autoPublish=n.attribute("autoPublish");if(typeof this.autoPublish!="boolean"){this.autoPublish=true}this.registerTrigger("vc_moderator_trigger");this.connect=function(p){if(this.model.usersCount<this.maxUsers){this.model.generateToken(b.Common.Function.proxy(function(q){this.sendMessage({trigger:"vc_participant_trigger_"+p.id,action:"connect",data:q});if(this.autoPublish&&!this.model.owner.isConnected()){this.model.connect()}},this))}else{this.sendMessage({trigger:"vc_participant_trigger_"+p.id,action:"connect",data:{error:"User limit ("+this.maxUsers+") reached."}})}};this.model.bind({sessionEnd:b.Common.Function.proxy(function(p){this.sendMessage({action:"endSession",data:{}})},this)})}else{this.registerTrigger("vc_participant_trigger_"+this.internalId);this.connect=function(p){if(!p&&!this.model.sessionId&&!this.model.token){this.fire({error:{message:"Tag Videochat "+this.id+": credentials haven't been provided yet. Call 'startSession' from model object to perform this request to a moderator."}});return}if(!p.error){p.expireTime=new Date(p.expireTime);b.Common.Cookie.setCookie({name:c,value:b.JSON.stringify(p),expires:p.expireTime});this.model.startSession(p)}else{this.fire({error:{message:p.error}})}};this.disconnect=function(){b.Common.Cookie.deleteCookie({name:c});this.model.disconnect()};this.endSession=function(){this.model.endSession()}}var o=b.Common.Function.parse,m=b.Common.Function.proxy;this.model.bind({sessionStart:m(function(p){this.fire({sessionStart:p})},this),sessionEnd:m(function(p){this.fire({sessionEnd:p})},this),connect:m(function(p){this.fire({connect:p})},this),disconnect:m(function(p){this.fire({disconnect:p})},this),error:m(function(p){this.fire({error:p})},this),userPublish:m(function(p){this.fire({userPublish:p})},this),userUnpublish:m(function(p){this.fire({userUnpublish:p})},this)});this.bind({sessionStart:o(n.attribute("onSessionStart")),sessionEnd:o(n.attribute("onSessionEnd")),connect:o(n.attribute("onConnect")),disconnect:o(n.attribute("onDisconnect")),error:o(n.attribute("onError"))});if(!this.template){if(this.role=="moderator"){var j=' <div class="xrtml-videochat-container">';j+='        <h2 data-bind="text: role"></h2>';j+='        <div data-bind="visible: owner.isConnected()">';j+="            <h3>My camera</h3>";j+='            <div class="xrtml-videochat-owner" data-bind="ownerBinding: owner.isConnected()"></div>';j+="            <h3>Participants</h3>";j+='            <div class="xrtml-videochat-users" data-bind="foreach: users">';j+='                <div class="xrtml-videochat-user" data-bind="usersBinding: $data"></div> ';j+="            </div>";j+="        </div>";j+='        <div class="xrtml-videochat-controls">';j+='            <input type="button" value="Start Session" id ="startsession-moderator" data-bind="click: startSession, visible: !hasSession()" />';j+='            <input type="button" value="End Session" id ="endsession-moderator" data-bind="click: endSession, visible: hasSession()" />';j+='            <input type="button" value="Connect" id ="connect-moderator" data-bind="click: connect, visible: hasSession() && !owner.isConnected()" />';j+='            <input type="button" value="Disconnect" id ="disconnect-moderator" data-bind="click: disconnect, visible: hasSession() && owner.isConnected()" />';j+="        </div>";j+="    </div>";this.template="xrtml-videochat-template-moderator"}else{var j=' <div id="xrtml-videochat-container" class="xrtml-videochat-container">';j+='        <h2 data-bind="text: role"></h2>';j+='        <div data-bind="visible: owner.isConnected()">';j+="            <h3>My camera</h3>";j+='            <div class="xrtml-videochat-owner" data-bind="ownerBinding: owner.isConnected()"> Your camera </div>';j+="            <h3>Participants</h3>";j+='            <div class="xrtml-videochat-users" data-bind="foreach: users">';j+='                <div class="xrtml-videochat-user" data-bind="usersBinding: $data"></div> ';j+="            </div>";j+="        </div>";j+='        <div iclass="xrtml-videochat-controls">';j+='            <input type="button" value="Connect" id ="connect-publisher" data-bind="click: connect, visible: !owner.isConnected()" />';j+='            <input type="button" value="Disconnect" id ="disconnect-publisher" data-bind="click: disconnect, visible: owner.isConnected()" />';j+="        </div>";j+="    </div>";this.template="xrtml-videochat-template-publisher"}b.Templating.inject({id:this.template,content:j})}b.Templating.applyBindings({node:this.target[0],binding:{template:{name:this.template,data:this.model}}});h=this}}})})(window.xRTML=window.xRTML||{});(function(a){(function(c,b){c[xRTML.version]?xRTML=c[xRTML.version]:c[xRTML.version]=xRTML;c.current=c.current||xRTML.version;xRTML=c[c.current]})(a.xRTMLVersions=a.xRTMLVersions||{})})(window);